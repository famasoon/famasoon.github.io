<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Golang + Nuxt.js + Kubernetes でWebサービスを作る | x64.moe</title><meta name=keywords content><meta name=description content="Golang でAPIサーバを作る Golang + Nuxt.js + Kubernetes でWebサービスを作るシリーズ第一弾。 まずはGolangでシンプルなAPIサーバを作成してみる。
今回はGETリクエストで渡されたドメインのwhois情報を取得するAPIサーバを書く。
APIサーバのソースコードはGitHubにアップロード済み https://github.com/famasoon/webapp-api
まずは適当なディレクトリを作る。
mkdir webapp-api cd webapp-api 次にGoの依存関係を初期化。
GO111MODULE=on go mod init 今回はGo言語のEchoというモジュールでHTTPリクエストを、gowhoisでwhois関連の処理を行う。 必要なモジュールをgo getで取得。
go get github.com/labstack/echo/... go get -u github.com/famasoon/gowhois 下記のmain.goでAPIサーバを書く。
package main import ( &#34;net/http&#34; &#34;github.com/famasoon/gowhois/whois&#34; &#34;github.com/labstack/echo&#34; ) type whoisInfo struct { Domain string `json:&#34;domain&#34;` WhoisResult string `json:&#34;result&#34;` } func main() { e := echo.New() e.GET(&#34;/&#34;, func(c echo.Context) error { return c.String(http.StatusOK, &#34;OK&#34;) }) e.GET(&#34;/api/v1/whois/:domain&#34;, getWhoisResult) e.Logger.Fatal(e.Start(&#34;:8080&#34;)) } func getWhoisResult(c echo."><meta name=author content="FAMASoon"><link rel=canonical href=https://famasoon.github.io/posts/golangnuxtk8s/><link crossorigin=anonymous href=/assets/css/stylesheet.bc1149f4a72aa4858d3a9f71462f75e5884ffe8073ea9d6d5761d5663d651e20.css integrity="sha256-vBFJ9KcqpIWNOp9xRi915YhP/oBz6p1tV2HVZj1lHiA=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://famasoon.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://famasoon.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://famasoon.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://famasoon.github.io/apple-touch-icon.png><link rel=mask-icon href=https://famasoon.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-107195112-2","auto"),ga("send","pageview"))</script><meta property="og:title" content="Golang + Nuxt.js + Kubernetes でWebサービスを作る"><meta property="og:description" content="Golang でAPIサーバを作る Golang + Nuxt.js + Kubernetes でWebサービスを作るシリーズ第一弾。 まずはGolangでシンプルなAPIサーバを作成してみる。
今回はGETリクエストで渡されたドメインのwhois情報を取得するAPIサーバを書く。
APIサーバのソースコードはGitHubにアップロード済み https://github.com/famasoon/webapp-api
まずは適当なディレクトリを作る。
mkdir webapp-api cd webapp-api 次にGoの依存関係を初期化。
GO111MODULE=on go mod init 今回はGo言語のEchoというモジュールでHTTPリクエストを、gowhoisでwhois関連の処理を行う。 必要なモジュールをgo getで取得。
go get github.com/labstack/echo/... go get -u github.com/famasoon/gowhois 下記のmain.goでAPIサーバを書く。
package main import ( &#34;net/http&#34; &#34;github.com/famasoon/gowhois/whois&#34; &#34;github.com/labstack/echo&#34; ) type whoisInfo struct { Domain string `json:&#34;domain&#34;` WhoisResult string `json:&#34;result&#34;` } func main() { e := echo.New() e.GET(&#34;/&#34;, func(c echo.Context) error { return c.String(http.StatusOK, &#34;OK&#34;) }) e.GET(&#34;/api/v1/whois/:domain&#34;, getWhoisResult) e.Logger.Fatal(e.Start(&#34;:8080&#34;)) } func getWhoisResult(c echo."><meta property="og:type" content="article"><meta property="og:url" content="https://famasoon.github.io/posts/golangnuxtk8s/"><meta property="og:image" content="https://famasoon.github.io/static/famasoon.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-10-12T00:00:00+00:00"><meta property="article:modified_time" content="2019-10-12T00:00:00+00:00"><meta property="og:site_name" content="x64.moe"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://famasoon.github.io/static/famasoon.jpg"><meta name=twitter:title content="Golang + Nuxt.js + Kubernetes でWebサービスを作る"><meta name=twitter:description content="Golang でAPIサーバを作る Golang + Nuxt.js + Kubernetes でWebサービスを作るシリーズ第一弾。 まずはGolangでシンプルなAPIサーバを作成してみる。
今回はGETリクエストで渡されたドメインのwhois情報を取得するAPIサーバを書く。
APIサーバのソースコードはGitHubにアップロード済み https://github.com/famasoon/webapp-api
まずは適当なディレクトリを作る。
mkdir webapp-api cd webapp-api 次にGoの依存関係を初期化。
GO111MODULE=on go mod init 今回はGo言語のEchoというモジュールでHTTPリクエストを、gowhoisでwhois関連の処理を行う。 必要なモジュールをgo getで取得。
go get github.com/labstack/echo/... go get -u github.com/famasoon/gowhois 下記のmain.goでAPIサーバを書く。
package main import ( &#34;net/http&#34; &#34;github.com/famasoon/gowhois/whois&#34; &#34;github.com/labstack/echo&#34; ) type whoisInfo struct { Domain string `json:&#34;domain&#34;` WhoisResult string `json:&#34;result&#34;` } func main() { e := echo.New() e.GET(&#34;/&#34;, func(c echo.Context) error { return c.String(http.StatusOK, &#34;OK&#34;) }) e.GET(&#34;/api/v1/whois/:domain&#34;, getWhoisResult) e.Logger.Fatal(e.Start(&#34;:8080&#34;)) } func getWhoisResult(c echo."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://famasoon.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Golang + Nuxt.js + Kubernetes でWebサービスを作る","item":"https://famasoon.github.io/posts/golangnuxtk8s/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Golang + Nuxt.js + Kubernetes でWebサービスを作る","name":"Golang \u002b Nuxt.js \u002b Kubernetes でWebサービスを作る","description":"Golang でAPIサーバを作る Golang + Nuxt.js + Kubernetes でWebサービスを作るシリーズ第一弾。 まずはGolangでシンプルなAPIサーバを作成してみる。\n今回はGETリクエストで渡されたドメインのwhois情報を取得するAPIサーバを書く。\nAPIサーバのソースコードはGitHubにアップロード済み https://github.com/famasoon/webapp-api\nまずは適当なディレクトリを作る。\nmkdir webapp-api cd webapp-api 次にGoの依存関係を初期化。\nGO111MODULE=on go mod init 今回はGo言語のEchoというモジュールでHTTPリクエストを、gowhoisでwhois関連の処理を行う。 必要なモジュールをgo getで取得。\ngo get github.com/labstack/echo/... go get -u github.com/famasoon/gowhois 下記のmain.goでAPIサーバを書く。\npackage main import ( \u0026#34;net/http\u0026#34; \u0026#34;github.com/famasoon/gowhois/whois\u0026#34; \u0026#34;github.com/labstack/echo\u0026#34; ) type whoisInfo struct { Domain string `json:\u0026#34;domain\u0026#34;` WhoisResult string `json:\u0026#34;result\u0026#34;` } func main() { e := echo.New() e.GET(\u0026#34;/\u0026#34;, func(c echo.Context) error { return c.String(http.StatusOK, \u0026#34;OK\u0026#34;) }) e.GET(\u0026#34;/api/v1/whois/:domain\u0026#34;, getWhoisResult) e.Logger.Fatal(e.Start(\u0026#34;:8080\u0026#34;)) } func getWhoisResult(c echo.","keywords":[],"articleBody":"Golang でAPIサーバを作る Golang + Nuxt.js + Kubernetes でWebサービスを作るシリーズ第一弾。 まずはGolangでシンプルなAPIサーバを作成してみる。\n今回はGETリクエストで渡されたドメインのwhois情報を取得するAPIサーバを書く。\nAPIサーバのソースコードはGitHubにアップロード済み https://github.com/famasoon/webapp-api\nまずは適当なディレクトリを作る。\nmkdir webapp-api cd webapp-api 次にGoの依存関係を初期化。\nGO111MODULE=on go mod init 今回はGo言語のEchoというモジュールでHTTPリクエストを、gowhoisでwhois関連の処理を行う。 必要なモジュールをgo getで取得。\ngo get github.com/labstack/echo/... go get -u github.com/famasoon/gowhois 下記のmain.goでAPIサーバを書く。\npackage main import ( \"net/http\" \"github.com/famasoon/gowhois/whois\" \"github.com/labstack/echo\" ) type whoisInfo struct { Domain string `json:\"domain\"` WhoisResult string `json:\"result\"` } func main() { e := echo.New() e.GET(\"/\", func(c echo.Context) error { return c.String(http.StatusOK, \"OK\") }) e.GET(\"/api/v1/whois/:domain\", getWhoisResult) e.Logger.Fatal(e.Start(\":8080\")) } func getWhoisResult(c echo.Context) error { domain := c.Param(\"domain\") result, err := whois.Whois(domain) if err != nil { return err } return c.JSON(http.StatusOK, whoisInfo{ Domain: domain, WhoisResult: result, }) } APIサーバは本番環境と開発環境を一つのDockerfileで書く。 下記記事を参考にマルチステージ対応のDockerfileを書いた https://qiita.com/po3rin/items/8b57e6c22f2b34751333\nまた、開発環境ではファイル更新の度にビルドし直すのが面倒なため、ホットリロードな環境を用意すべくfreshというモジュールを利用している。 freshについては下記記事を参考 https://qiita.com/po3rin/items/9acd41ef428436335c97\nDockerfile\nFROM golang:1.12 as builder WORKDIR /go/api COPY . . ENV GO111MODULE=on RUN CGO_ENABLED=0 GOOS=linux go build -a -installsuffix cgo . FROM alpine:latest as prod EXPOSE 8080 WORKDIR /api COPY --from=builder /go/api/ . RUN pwd CMD [\"./webapp-api\"] FROM golang:1.12 as dev EXPOSE 8080 WORKDIR /go/src/whoisapp COPY . . ENV GO111MODULE=on RUN go get github.com/pilu/fresh CMD [\"fresh\"] docker-compose\nversion: '3' services: app: build: . volumes: - ./:/go/src/whoisapp ports: - \"8080:8080\" 開発環境と本番環境をビルドするためのMakefile\nall: dev prod dev: docker build -t api-dev --target dev . prod: docker build -t api-prod --target prod . docker-composeの設定を書いておいたので実行。\ndocker-compose up とりあえず/api/v1/whois/:domainにアクセスすると当該ドメインのwhois情報を取得するようになっている(使用しているライブラリの性質上、いくつかのドメインのwhois情報を取得できないが、それは一旦無視する)\nhttp://127.0.0.1:8080/api/v1/whois/example.com へアクセス。 example.comのwhois情報が取得できていればAPIサーバの完成。 次はこのDockerイメージをデプロイするためのKubernetesクラスタを作成する。\nGKEでKubernetesクラスタを作る Golang + Nuxt.js + Kubernetes でWebサービスを作るシリーズ第二弾。 ❶で作成したAPIサーバをGKEのKubernetesクラスタにデプロイする。\nまずは安くGKEクラスタを作成しなくてはならない。 しかし安すぎると今度は却ってメモリ量が少なく、これからデプロイしようと思っているNuxt.jsのアプリケーションがデプロイできなくなる。 なのでメモリをたくさん積んだn1-standard-1インスタンスで作成しようと思う。 まぁ、実際のサービスを作成するとなるとこの辺はもっと検討しないといけないところなのだが、そこは趣味ということで。 参考にしたのは下記リンク https://blog.a-know.me/entry/2018/06/17/220222 わかりやすくGKEクラスタを作成する方法が書かれているので要参照。\nまずはGKEクラスタを構築するためのインスタンス群を作成する\ngcloud container clusters create webapp --preemptible -- machine-type n1-standard-1 --num-nodes=3 --disk-size=10 前回の記事で作成した本番環境用のイメージをGoogle Container Registryにアップロードするためにタグ付けを行う\ndocker tag api-prod gcr.io/[プロジェクト名]/[イメージ名] :[バージョン名] docker tag api-prod gcr.io/[プロジェクトID]/apiprod:1.0.0 gcloud auth configure-docker docker push gcr.io/impactful-study-219313/apiprod:1.0.0 次に下記ymlファイルを用意してデプロイする\napiVersion: v1 kind: Service metadata: name: webappapi labels: run: webappapi spec: selector: run: webappapi ports: - name: http port: 8080 type: NodePort --- apiVersion: extensions/v1beta1 kind: Deployment metadata: name: webappapi labels: run: webappapi spec: replicas: 3 template: metadata: labels: run: webappapi spec: containers: - name: webappapi image: gcr.io/[プロジェクトID]/apiprod:1.0.0 ports: - containerPort: 8080 dnsPolicy: \"None\" dnsConfig: nameservers: - 1.1.1.1 ちなみにDockerコンテナからはDNSの名前解決ができないがdnsConfigのnameserversで名前解決の問い合わせ先を指定させることで名前解決を可能にしている。\nグローバルIPを割与え、Ingressを使ってAPIサーバをインターネット越しに呼ぶようにする。 ingress.yml\napiVersion: extensions/v1beta1 kind: Ingress metadata: name: ingress spec: rules: - http: paths: - path: /api/* backend: serviceName: webappapi servicePort: 8080 kubectl apply -f ingress.yml これでグローバルIPが割り振られる。 なおIPアドレスが割り振られたあと、しばらく(數十分ほど)待たないとアクセスできないので注意。 Ingressで取得されたグローバルIPアドレスを表示するには下記コマンドを打つこと。\nkubectl get ingress http://[Ingressで割り当てられたIPアドレス]/api/v1/whois/google.com にアクセスしてWhois情報が表示されれば成功。\ncurl http://[IPアドレス]/api/v1/whois/example.com {\"domain\":\"example.com\",\"result\":\" Domain Name: EXAMPLE.COM\\r\\n Registry Domain ID: 2336799_DOMAIN_COM-VRSN\\r\\n Registrar WHOIS Server: whois.iana.org\\r\\n Registrar URL: http://res-dom.iana.org\\r\\n Updated Date: 2018-08-14T07:14:12Z\\r\\n Creation Date: 1995-08-14T04:00:00Z\\r\\n Registry Expiry Date: 2019-08-13T04:00:00Z\\r\\n Registrar: RESERVED-Internet Assigned Numbers Authority\\r\\n Registrar IANA ID: 376\\r\\n Registrar Abuse Contact Email:\\r\\n Registrar Abuse Contact Phone:\\r\\n Domain Status: clientDeleteProhibited https://icann.org/epp#clientDeleteProhibited\\r\\n Domain Status: clientTransferProhibited https://icann.org/epp#clientTransferProhibited\\r\\n Domain Status: clientUpdateProhibited https://icann.org/epp#clientUpdateProhibited\\r\\n Name Server: A.IANA-SERVERS.NET\\r\\n Name Server: B.IANA-SERVERS.NET\\r\\n DNSSEC: signedDelegation\\r\\n DNSSEC DS Data: 31589 8 1 3490A6806D47F17A34C29E2CE80E8A999FFBE4BE\\r\\n DNSSEC DS Data: 31589 8 2 CDE0D742D6998AA554A92D890F8184C698CFAC8A26FA59875A990C03E576343C\\r\\n DNSSEC DS Data: 43547 8 1 B6225AB2CC613E0DCA7962BDC2342EA4F1B56083\\r\\n DNSSEC DS Data: 43547 8 2 615A64233543F66F44D68933625B17497C89A70E858ED76A2145997EDF96A918\\r\\n DNSSEC DS Data: 31406 8 1 189968811E6EBA862DD6C209F75623D8D9ED9142\\r\\n DNSSEC DS Data: 31406 8 2 F78CF3344F72137235098ECBBD08947C2C9001C7F6A085A17F518B5D8F6B916D\\r\\n URL of the ICANN Whois Inaccuracy Complaint Form: https://www.icann.org/wicf/\\r\\n\\u003e\\u003e\\u003e Last update of whois database: 2019-08-04T01:55:52Z \\u003c\\u003c\\u003c\\r\\n\\r\\nFor more information on Whois status codes, please visit https://icann.org/epp\\r\\n\\r\\nNOTICE: The expiration date displayed in this record is the date the\\r\\nregistrar's sponsorship of the domain name registration in the registry is\\r\\ncurrently set to expire. This date does not necessarily reflect the expiration\\r\\ndate of the domain name registrant's agreement with the sponsoring\\r\\nregistrar. Users may consult the sponsoring registrar's Whois database to\\r\\nview the registrar's reported date of expiration for this registration.\\r\\n\\r\\nTERMS OF USE: You are not authorized to access or query our Whois\\r\\ndatabase through the use of electronic processes that are high-volume and\\r\\nautomated except as reasonably necessary to register domain names or\\r\\nmodify existing registrations; the Data in VeriSign Global Registry\\r\\nServices' (\\\"VeriSign\\\") Whois database is provided by VeriSign for\\r\\ninformation purposes only, and to assist persons in obtaining information\\r\\nabout or related to a domain name registration record. VeriSign does not\\r\\nguarantee its accuracy. By submitting a Whois query, you agree to abide\\r\\nby the following terms of use: You agree that you may use this Data only\\r\\nfor lawful purposes and that under no circumstances will you use this Data\\r\\nto: (1) allow, enable, or otherwise support the transmission of mass\\r\\nunsolicited, commercial advertising or solicitations via e-mail, telephone,\\r\\nor facsimile; or (2) enable high volume, automated, electronic processes\\r\\nthat apply to VeriSign (or its computer systems). The compilation,\\r\\nrepackaging, dissemination or other use of this Data is expressly\\r\\nprohibited without the prior written consent of VeriSign. You agree not to\\r\\nuse electronic processes that are automated and high-volume to access or\\r\\nquery the Whois database except as reasonably necessary to register\\r\\ndomain names or modify existing registrations. VeriSign reserves the right\\r\\nto restrict your access to the Whois database in its sole discretion to ensure\\r\\noperational stability. VeriSign may restrict or terminate your access to the\\r\\nWhois database for failure to abide by these terms of use. VeriSign\\r\\nreserves the right to modify these terms at any time.\\r\\n\\r\\nThe Registry database contains ONLY .COM, .NET, .EDU domains and\\r\\nRegistrars.\\r\\n\"} Nuxt.jsでフロントエンド作ってみる Nuxt.jsでフロントエンドを実装する。\nまずは下記コマンドでNuxtのプロジェクトを作成する。\n$ npx create-nuxt-app webapp-front \u003e Generating Nuxt.js project in /Users/doejohn/work/sandbox/webapp-front ? Project name webapp-front ? Project description My wicked Nuxt.js project ? Use a custom server framework none ? Choose features to install Linter / Formatter, Prettier, Axios ? Use a custom UI framework buefy ? Use a custom test framework none ? Choose rendering mode Universal ? Author name famasoon ? Choose a package manager yarn 作成したプロジェクトのディレクトリに移動して試しにNuxtを動かしてみる。\n$ cd webapp-front $ yarn run dev http://localhost:3000にアクセスするとこんな画面が出ると思う。 これをカスタマイズしていく。\nまずはバナー用のHero.vueをcomponentsに追加する。\n\u003ctemplate\u003e \u003csection id=\"hero-section\" class=\"hero is-medium is-primary is-bold\"\u003e \u003cdiv class=\"hero-body\"\u003e \u003cdiv class=\"container\"\u003e \u003ch1 class=\"title\"\u003e \u003cstrong class=\"has-text-success\"\u003eWelcome\u003c/strong\u003e to Whois Query Web App \u003c/h1\u003e \u003ch2 class=\"subtitle\"\u003e Show WHIOS information \u003c/h2\u003e \u003c/div\u003e \u003c/div\u003e \u003c/section\u003e \u003c/template\u003e 次にNuxtのレイアウトを決めるlayouts/default.vueを下記のように書き換える。\n\u003ctemplate\u003e \u003cdiv\u003e \u003csection class=\"main-content columns\"\u003e \u003cdiv class=\"container column is-10\"\u003e \u003cnuxt /\u003e \u003c/div\u003e \u003c/section\u003e \u003c/div\u003e \u003c/template\u003e pages/index.vueを書き換える。\n\u003ctemplate\u003e \u003csection class=\"section\"\u003e \u003cdiv class=\"columns is-mobile\" /\u003e \u003chero /\u003e \u003cdiv id=\"inputfield\"\u003e \u003cb-field position=\"is-centered\"\u003e \u003cb-input v-model=\"domain\" placeholder=\"Input Domain or IP address...\" type=\"search\" icon=\"magnify\" /\u003e \u003ca :href=\"'/whois/' + domain\"\u003e \u003cp class=\"control\"\u003e \u003cbutton class=\"button is-info\"\u003e Lookup \u003c/button\u003e \u003c/p\u003e \u003c/a\u003e \u003c/b-field\u003e \u003c/div\u003e \u003cdescription /\u003e \u003c/section\u003e \u003c/template\u003e \u003cscript\u003e import Hero from '~/components/Hero.vue' export default { components: { Hero }, data() { return { domain: '' } } } \u003c/script\u003e \u003cstyle\u003e #inputfield { margin: 40px; } \u003c/style\u003e yarn run devを実行し画像のように表示されれば問題なし。 次にAPIサーバの呼び出し先を本番環境と開発環境で変えるように設定する。 Nuxt.jsは環境変数で変数の内容を変えることができる。 参照: env プロパティ nuxt.config.jsのmodule.exportsに下記項目を追加\nenv: { apiServer: process.env.API_SERVER || 'http://localhost:8080' }, これでAPI_SERVERという環境変数が設定されている時はそちらをAPIサーバとして利用。 環境変数が設定されていない時はhttp://localhost:8080をAPIサーバとして利用するようにする。 後でDockerを使用し本番イメージを作る際にAPI_SERVERという環境変数をセットしておくと本番環境のAPIサーバを向くようになる。\n次にWHOIS情報を表示するためのページを作成する。 http://[webアプリ]/whois/[WHOISを表示したいドメイン]といったURLで表示したい。 Nuxt.jsはpages配下のvueファイルを見て自動的にルーティングの設定をしてくれる。 動的なルーティングをする際はpages配下に_を先頭に付けたvueファイルを置けば良い。 参照: Nuxt.js - 動的なルーティング pages/whois/_domain.vueというファイルを下の内容で作成する。\n\u003ctemplate\u003e \u003cdiv\u003e \u003ch1 class=\"title\"\u003e {{ $route.params.domain }} \u003c/h1\u003e \u003ch2 class=\"subtitle\"\u003e Related information \u003c/h2\u003e \u003cdiv class=\"card\"\u003e \u003cheader class=\"card-header\"\u003e \u003cp class=\"card-header-title\"\u003e Whois Result \u003c/p\u003e \u003ca href=\"#\" class=\"card-header-icon\" aria-label=\"more options\"\u003e \u003cspan class=\"icon\"\u003e \u003ci class=\"fas fa-angle-down\" aria-hidden=\"true\" /\u003e \u003c/span\u003e \u003c/a\u003e \u003c/header\u003e \u003cdiv class=\"card-content\"\u003e \u003cdiv class=\"content\"\u003e \u003ctemplate\u003e \u003cpre\u003e{{ whoisResp.result }}\u003c/pre\u003e \u003c/template\u003e \u003c/div\u003e \u003c/div\u003e \u003c/div\u003e \u003c/div\u003e \u003c/template\u003e \u003cscript\u003e import axios from 'axios' export default { async asyncData(context) { const DOMAIN_NAME = context.params.domain const API_SERVER = process.env.apiServer const { data } = await axios.get( API_SERVER + '/api/v1/whois/' + DOMAIN_NAME ) return { whoisResp: data } } } \u003c/script\u003e ❶参照をしてローカルでAPIサーバを起動したら、 http://127.0.0.1:3000のフォームでexample.comと入力しLookupボタンを押してみましょう。 http://127.0.0.1:3000/whois/example.comにルーティングされて下の画像のように表示されれば成功です。 これでWHOIS情報をAPIサーバから取得して表示するWebアプリのフロントエンドが出来上がりました。 今回はここまで。 次回はフロントエンド部分をDockerイメージ化してGKEにデプロイしてみます。\nNuxt.jsをGKEにデプロイ フロントエンドのディレクトリに下記Dockerfileを追加\nFROM node:lts-alpine WORKDIR /app COPY . /app ENV NODE_ENV=production ENV API_SERVER 'http://[IPアドレス]' ENV HOST 0.0.0.0 RUN yarn install RUN yarn run build EXPOSE 3000 CMD [\"yarn\", \"run\", \"start\"] 下記コマンドでlocalhostからアクセスできる\ndocker run -it -p 3000:3000 --network host --name dockerized-nuxt webappfront:latest 次にこのコンテナイメージをGoogle Container Registryにアップロードするためにタグ付けを行う\ndocker tag api-prod gcr.io/[プロジェクト名]/[イメージ名] :[バージョン名] アップロード\ndocker tag api-prod gcr.io/[プロジェクトID]/apiprod:1.0.0 gcloud auth configure-docker docker push gcr.io/プロジェクト名]/[イメージ名] :[バージョン名] GKEにデプロイするためのymlファイル\napiVersion: v1 kind: Service metadata: name: webappfront labels: run: webappfront spec: selector: run: webappfront ports: - name: http port: 3000 type: NodePort --- apiVersion: extensions/v1beta1 kind: Deployment metadata: name: webappfront labels: run: webappfront spec: replicas: 3 template: metadata: labels: run: webappfront spec: containers: - name: webappfront image: gcr.io//apiprod:1.0.0 ports: - containerPort: 3000 下記コマンドでGKEに設定を反映\nkubectl create -f webappfront.yml ingress.ymlの中身を下記のように変更しルーティングを指せる\napiVersion: extensions/v1beta1 kind: Ingress metadata: name: ingress spec: rules: - http: paths: - path: /api/* backend: serviceName: webappapi servicePort: 8080 - path: /* backend: serviceName: webappfront servicePort: 3000 たぶんこれでうまくいく。 以上、Golang + Nuxt.js + KubernetesでWebサービスを作るでした。\n","wordCount":"1250","inLanguage":"en","datePublished":"2019-10-12T00:00:00Z","dateModified":"2019-10-12T00:00:00Z","author":{"@type":"Person","name":"FAMASoon"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://famasoon.github.io/posts/golangnuxtk8s/"},"publisher":{"@type":"Organization","name":"x64.moe","logo":{"@type":"ImageObject","url":"https://famasoon.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://famasoon.github.io/ accesskey=h title="Home (Alt + H)">Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://famasoon.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://famasoon.github.io/tags/ title=tags><span>tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://famasoon.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://famasoon.github.io/posts/>Posts</a></div><h1 class=post-title>Golang + Nuxt.js + Kubernetes でWebサービスを作る</h1><div class=post-meta><span title='2019-10-12 00:00:00 +0000 UTC'>October 12, 2019</span>&nbsp;·&nbsp;6 min&nbsp;·&nbsp;1250 words&nbsp;·&nbsp;FAMASoon&nbsp;|&nbsp;<a href=https://github.com/%3cpath_to_repo%3e/content/posts/golangnuxtk8s.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=post-content><h2 id=golang-でapiサーバを作る>Golang でAPIサーバを作る<a hidden class=anchor aria-hidden=true href=#golang-でapiサーバを作る>#</a></h2><p>Golang + Nuxt.js + Kubernetes でWebサービスを作るシリーズ第一弾。
まずはGolangでシンプルなAPIサーバを作成してみる。</p><p>今回はGETリクエストで渡されたドメインのwhois情報を取得するAPIサーバを書く。</p><p>APIサーバのソースコードはGitHubにアップロード済み
<a href=https://github.com/famasoon/webapp-api>https://github.com/famasoon/webapp-api</a></p><p>まずは適当なディレクトリを作る。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mkdir webapp-api
</span></span><span class=line><span class=cl><span class=nb>cd</span> webapp-api
</span></span></code></pre></div><p>次にGoの依存関係を初期化。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>GO111MODULE</span><span class=o>=</span>on go mod init
</span></span></code></pre></div><p>今回はGo言語のEchoというモジュールでHTTPリクエストを、gowhoisでwhois関連の処理を行う。
必要なモジュールを<code>go get</code>で取得。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>go get github.com/labstack/echo/...
</span></span><span class=line><span class=cl>go get -u github.com/famasoon/gowhois
</span></span></code></pre></div><p>下記の<code>main.go</code>でAPIサーバを書く。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;net/http&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=s>&#34;github.com/famasoon/gowhois/whois&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;github.com/labstack/echo&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>whoisInfo</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>Domain</span>      <span class=kt>string</span> <span class=s>`json:&#34;domain&#34;`</span>
</span></span><span class=line><span class=cl>	<span class=nx>WhoisResult</span> <span class=kt>string</span> <span class=s>`json:&#34;result&#34;`</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>e</span> <span class=o>:=</span> <span class=nx>echo</span><span class=p>.</span><span class=nf>New</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=nx>e</span><span class=p>.</span><span class=nf>GET</span><span class=p>(</span><span class=s>&#34;/&#34;</span><span class=p>,</span> <span class=kd>func</span><span class=p>(</span><span class=nx>c</span> <span class=nx>echo</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span> <span class=kt>error</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=nx>c</span><span class=p>.</span><span class=nf>String</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span> <span class=s>&#34;OK&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>e</span><span class=p>.</span><span class=nf>GET</span><span class=p>(</span><span class=s>&#34;/api/v1/whois/:domain&#34;</span><span class=p>,</span> <span class=nx>getWhoisResult</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>e</span><span class=p>.</span><span class=nx>Logger</span><span class=p>.</span><span class=nf>Fatal</span><span class=p>(</span><span class=nx>e</span><span class=p>.</span><span class=nf>Start</span><span class=p>(</span><span class=s>&#34;:8080&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>getWhoisResult</span><span class=p>(</span><span class=nx>c</span> <span class=nx>echo</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span> <span class=kt>error</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>domain</span> <span class=o>:=</span> <span class=nx>c</span><span class=p>.</span><span class=nf>Param</span><span class=p>(</span><span class=s>&#34;domain&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>result</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>whois</span><span class=p>.</span><span class=nf>Whois</span><span class=p>(</span><span class=nx>domain</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>c</span><span class=p>.</span><span class=nf>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span> <span class=nx>whoisInfo</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>Domain</span><span class=p>:</span>      <span class=nx>domain</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>WhoisResult</span><span class=p>:</span> <span class=nx>result</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>APIサーバは本番環境と開発環境を一つのDockerfileで書く。
下記記事を参考にマルチステージ対応のDockerfileを書いた
<a href=https://qiita.com/po3rin/items/8b57e6c22f2b34751333>https://qiita.com/po3rin/items/8b57e6c22f2b34751333</a></p><p>また、開発環境ではファイル更新の度にビルドし直すのが面倒なため、ホットリロードな環境を用意すべく<code>fresh</code>というモジュールを利用している。
<code>fresh</code>については下記記事を参考
<a href=https://qiita.com/po3rin/items/9acd41ef428436335c97>https://qiita.com/po3rin/items/9acd41ef428436335c97</a></p><p><code>Dockerfile</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=cl><span class=k>FROM</span><span class=s> golang:1.12 as builder</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> /go/api</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> . .<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ENV</span> <span class=nv>GO111MODULE</span><span class=o>=</span>on
</span></span><span class=line><span class=cl><span class=k>RUN</span> <span class=nv>CGO_ENABLED</span><span class=o>=</span><span class=m>0</span> <span class=nv>GOOS</span><span class=o>=</span>linux go build -a -installsuffix cgo .<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>FROM</span><span class=s> alpine:latest as prod</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>EXPOSE</span><span class=s> 8080</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> /api</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> --from<span class=o>=</span>builder /go/api/ .<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> pwd<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>CMD</span> <span class=p>[</span><span class=s2>&#34;./webapp-api&#34;</span><span class=p>]</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>FROM</span><span class=s> golang:1.12 as dev</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>EXPOSE</span><span class=s> 8080</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> /go/src/whoisapp</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> . .<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ENV</span> <span class=nv>GO111MODULE</span><span class=o>=</span>on
</span></span><span class=line><span class=cl><span class=k>RUN</span> go get github.com/pilu/fresh<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>CMD</span> <span class=p>[</span><span class=s2>&#34;fresh&#34;</span><span class=p>]</span><span class=err>
</span></span></span></code></pre></div><p><code>docker-compose</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;3&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>app</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>build</span><span class=p>:</span><span class=w> </span><span class=l>.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>./:/go/src/whoisapp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;8080:8080&#34;</span><span class=w>
</span></span></span></code></pre></div><p>開発環境と本番環境をビルドするための<code>Makefile</code></p><pre tabindex=0><code>all: dev prod

dev:
    docker build -t api-dev --target dev .

prod:
    docker build -t api-prod --target prod .
</code></pre><p>docker-composeの設定を書いておいたので実行。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker-compose up
</span></span></code></pre></div><p>とりあえず<code>/api/v1/whois/:domain</code>にアクセスすると当該ドメインのwhois情報を取得するようになっている(使用しているライブラリの性質上、いくつかのドメインのwhois情報を取得できないが、それは一旦無視する)</p><p><a href=http://127.0.0.1:8080/api/v1/whois/example.com>http://127.0.0.1:8080/api/v1/whois/example.com</a> へアクセス。
<code>example.com</code>のwhois情報が取得できていればAPIサーバの完成。
次はこのDockerイメージをデプロイするためのKubernetesクラスタを作成する。</p><h2 id=gkeでkubernetesクラスタを作る>GKEでKubernetesクラスタを作る<a hidden class=anchor aria-hidden=true href=#gkeでkubernetesクラスタを作る>#</a></h2><p>Golang + Nuxt.js + Kubernetes でWebサービスを作るシリーズ第二弾。
❶で作成したAPIサーバをGKEのKubernetesクラスタにデプロイする。</p><hr><p>まずは安くGKEクラスタを作成しなくてはならない。
しかし安すぎると今度は却ってメモリ量が少なく、これからデプロイしようと思っているNuxt.jsのアプリケーションがデプロイできなくなる。
なのでメモリをたくさん積んだ<code>n1-standard-1</code>インスタンスで作成しようと思う。
まぁ、実際のサービスを作成するとなるとこの辺はもっと検討しないといけないところなのだが、そこは趣味ということで。
参考にしたのは下記リンク
<a href=https://blog.a-know.me/entry/2018/06/17/220222>https://blog.a-know.me/entry/2018/06/17/220222</a>
わかりやすくGKEクラスタを作成する方法が書かれているので要参照。</p><p>まずはGKEクラスタを構築するためのインスタンス群を作成する</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>gcloud container clusters create webapp --preemptible --
</span></span><span class=line><span class=cl>machine-type n1-standard-1 --num-nodes<span class=o>=</span><span class=m>3</span> --disk-size<span class=o>=</span><span class=m>10</span>
</span></span></code></pre></div><p>前回の記事で作成した本番環境用のイメージをGoogle Container Registryにアップロードするためにタグ付けを行う</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>docker tag api-prod gcr.io/<span class=o>[</span>プロジェクト名<span class=o>]</span>/<span class=o>[</span>イメージ名<span class=o>]</span>
</span></span><span class=line><span class=cl>:<span class=o>[</span>バージョン名<span class=o>]</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker tag api-prod gcr.io/<span class=o>[</span>プロジェクトID<span class=o>]</span>/apiprod:1.0.0
</span></span><span class=line><span class=cl>gcloud auth configure-docker
</span></span><span class=line><span class=cl>docker push gcr.io/impactful-study-219313/apiprod:1.0.0
</span></span></code></pre></div><p>次に下記ymlファイルを用意してデプロイする</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>webappapi</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>webappapi</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>webappapi</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>http</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>8080</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>NodePort</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>extensions/v1beta1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>webappapi</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>webappapi</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>webappapi</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>webappapi</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>gcr.io/[プロジェクトID]/apiprod:1.0.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class=m>8080</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>dnsPolicy</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;None&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>dnsConfig</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>nameservers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=m>1.1.1.1</span><span class=w>
</span></span></span></code></pre></div><p>ちなみにDockerコンテナからはDNSの名前解決ができないが<code>dnsConfig</code>の<code>nameservers</code>で名前解決の問い合わせ先を指定させることで名前解決を可能にしている。</p><p>グローバルIPを割与え、Ingressを使ってAPIサーバをインターネット越しに呼ぶようにする。
<code>ingress.yml</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>extensions/v1beta1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Ingress</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>ingress</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>paths</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>/api/*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>backend</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>serviceName</span><span class=p>:</span><span class=w> </span><span class=l>webappapi</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>servicePort</span><span class=p>:</span><span class=w> </span><span class=m>8080</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl apply -f ingress.yml
</span></span></code></pre></div><p>これでグローバルIPが割り振られる。
なおIPアドレスが割り振られたあと、しばらく(數十分ほど)待たないとアクセスできないので注意。
Ingressで取得されたグローバルIPアドレスを表示するには下記コマンドを打つこと。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl get ingress
</span></span></code></pre></div><p>http://[Ingressで割り当てられたIPアドレス]/api/v1/whois/google.com
にアクセスしてWhois情報が表示されれば成功。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl http://<span class=o>[</span>IPアドレス<span class=o>]</span>/api/v1/whois/example.com
</span></span><span class=line><span class=cl><span class=o>{</span><span class=s2>&#34;domain&#34;</span>:<span class=s2>&#34;example.com&#34;</span>,<span class=s2>&#34;result&#34;</span>:<span class=s2>&#34;   Domain Name: EXAMPLE.COM\r\n   Registry Domain ID: 2336799_DOMAIN_COM-VRSN\r\n   Registrar WHOIS Server: whois.iana.org\r\n   Registrar URL: http://res-dom.iana.org\r\n   Updated Date: 2018-08-14T07:14:12Z\r\n   Creation Date: 1995-08-14T04:00:00Z\r\n   Registry Expiry Date: 2019-08-13T04:00:00Z\r\n   Registrar: RESERVED-Internet Assigned Numbers Authority\r\n   Registrar IANA ID: 376\r\n   Registrar Abuse Contact Email:\r\n   Registrar Abuse Contact Phone:\r\n   Domain Status: clientDeleteProhibited https://icann.org/epp#clientDeleteProhibited\r\n   Domain Status: clientTransferProhibited https://icann.org/epp#clientTransferProhibited\r\n   Domain Status: clientUpdateProhibited https://icann.org/epp#clientUpdateProhibited\r\n   Name Server: A.IANA-SERVERS.NET\r\n   Name Server: B.IANA-SERVERS.NET\r\n   DNSSEC: signedDelegation\r\n   DNSSEC DS Data: 31589 8 1 3490A6806D47F17A34C29E2CE80E8A999FFBE4BE\r\n   DNSSEC DS Data: 31589 8 2 CDE0D742D6998AA554A92D890F8184C698CFAC8A26FA59875A990C03E576343C\r\n   DNSSEC DS Data: 43547 8 1 B6225AB2CC613E0DCA7962BDC2342EA4F1B56083\r\n   DNSSEC DS Data: 43547 8 2 615A64233543F66F44D68933625B17497C89A70E858ED76A2145997EDF96A918\r\n   DNSSEC DS Data: 31406 8 1 189968811E6EBA862DD6C209F75623D8D9ED9142\r\n   DNSSEC DS Data: 31406 8 2 F78CF3344F72137235098ECBBD08947C2C9001C7F6A085A17F518B5D8F6B916D\r\n   URL of the ICANN Whois Inaccuracy Complaint Form: https://www.icann.org/wicf/\r\n\u003e\u003e\u003e Last update of whois database: 2019-08-04T01:55:52Z \u003c\u003c\u003c\r\n\r\nFor more information on Whois status codes, please visit https://icann.org/epp\r\n\r\nNOTICE: The expiration date displayed in this record is the date the\r\nregistrar&#39;s sponsorship of the domain name registration in the registry is\r\ncurrently set to expire. This date does not necessarily reflect the expiration\r\ndate of the domain name registrant&#39;s agreement with the sponsoring\r\nregistrar.  Users may consult the sponsoring registrar&#39;s Whois database to\r\nview the registrar&#39;s reported date of expiration for this registration.\r\n\r\nTERMS OF USE: You are not authorized to access or query our Whois\r\ndatabase through the use of electronic processes that are high-volume and\r\nautomated except as reasonably necessary to register domain names or\r\nmodify existing registrations; the Data in VeriSign Global Registry\r\nServices&#39; (\&#34;VeriSign\&#34;) Whois database is provided by VeriSign for\r\ninformation purposes only, and to assist persons in obtaining information\r\nabout or related to a domain name registration record. VeriSign does not\r\nguarantee its accuracy. By submitting a Whois query, you agree to abide\r\nby the following terms of use: You agree that you may use this Data only\r\nfor lawful purposes and that under no circumstances will you use this Data\r\nto: (1) allow, enable, or otherwise support the transmission of mass\r\nunsolicited, commercial advertising or solicitations via e-mail, telephone,\r\nor facsimile; or (2) enable high volume, automated, electronic processes\r\nthat apply to VeriSign (or its computer systems). The compilation,\r\nrepackaging, dissemination or other use of this Data is expressly\r\nprohibited without the prior written consent of VeriSign. You agree not to\r\nuse electronic processes that are automated and high-volume to access or\r\nquery the Whois database except as reasonably necessary to register\r\ndomain names or modify existing registrations. VeriSign reserves the right\r\nto restrict your access to the Whois database in its sole discretion to ensure\r\noperational stability.  VeriSign may restrict or terminate your access to the\r\nWhois database for failure to abide by these terms of use. VeriSign\r\nreserves the right to modify these terms at any time.\r\n\r\nThe Registry database contains ONLY .COM, .NET, .EDU domains and\r\nRegistrars.\r\n&#34;</span><span class=o>}</span>
</span></span></code></pre></div><h2 id=nuxtjsでフロントエンド作ってみる>Nuxt.jsでフロントエンド作ってみる<a hidden class=anchor aria-hidden=true href=#nuxtjsでフロントエンド作ってみる>#</a></h2><p>Nuxt.jsでフロントエンドを実装する。</p><p>まずは下記コマンドでNuxtのプロジェクトを作成する。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ npx create-nuxt-app webapp-front
</span></span><span class=line><span class=cl>&gt; Generating Nuxt.js project in /Users/doejohn/work/sandbox/webapp-front
</span></span><span class=line><span class=cl>? Project name webapp-front
</span></span><span class=line><span class=cl>? Project description My wicked Nuxt.js project
</span></span><span class=line><span class=cl>? Use a custom server framework none
</span></span><span class=line><span class=cl>? Choose features to install Linter / Formatter, Prettier, Axios
</span></span><span class=line><span class=cl>? Use a custom UI framework buefy
</span></span><span class=line><span class=cl>? Use a custom <span class=nb>test</span> framework none
</span></span><span class=line><span class=cl>? Choose rendering mode Universal
</span></span><span class=line><span class=cl>? Author name famasoon
</span></span><span class=line><span class=cl>? Choose a package manager yarn
</span></span></code></pre></div><p>作成したプロジェクトのディレクトリに移動して試しにNuxtを動かしてみる。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ <span class=nb>cd</span> webapp-front
</span></span><span class=line><span class=cl>$ yarn run dev
</span></span></code></pre></div><p><code>http://localhost:3000</code>にアクセスするとこんな画面が出ると思う。
これをカスタマイズしていく。</p><p><img loading=lazy src=https://i.imgur.com/EpQWx3B.png alt></p><p>まずはバナー用の<code>Hero.vue</code>を<code>components</code>に追加する。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>section</span> <span class=na>id</span><span class=o>=</span><span class=s>&#34;hero-section&#34;</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;hero is-medium is-primary is-bold&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;hero-body&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;container&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>h1</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;title&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>&lt;</span><span class=nt>strong</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;has-text-success&#34;</span><span class=p>&gt;</span>Welcome<span class=p>&lt;/</span><span class=nt>strong</span><span class=p>&gt;</span> to Whois Query Web App
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>h2</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;subtitle&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          Show WHIOS information
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=nt>h2</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>section</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span></code></pre></div><p>次にNuxtのレイアウトを決める<code>layouts/default.vue</code>を下記のように書き換える。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>section</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;main-content columns&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;container column is-10&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>nuxt</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>section</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span></code></pre></div><p><code>pages/index.vue</code>を書き換える。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>section</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;section&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;columns is-mobile&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>hero</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>id</span><span class=o>=</span><span class=s>&#34;inputfield&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>b-field</span> <span class=na>position</span><span class=o>=</span><span class=s>&#34;is-centered&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>b-input</span> <span class=na>v-model</span><span class=o>=</span><span class=s>&#34;domain&#34;</span> <span class=na>placeholder</span><span class=o>=</span><span class=s>&#34;Input Domain or IP address...&#34;</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;search&#34;</span> <span class=na>icon</span><span class=o>=</span><span class=s>&#34;magnify&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>a</span> <span class=na>:href</span><span class=o>=</span><span class=s>&#34;&#39;/whois/&#39; + domain&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;control&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>button</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;button is-info&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>              Lookup
</span></span><span class=line><span class=cl>            <span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=nt>a</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;/</span><span class=nt>b-field</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>description</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>section</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>Hero</span> <span class=nx>from</span> <span class=s1>&#39;~/components/Hero.vue&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>components</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>Hero</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>data</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>domain</span><span class=o>:</span> <span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>style</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>#</span><span class=nn>inputfield</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>margin</span><span class=p>:</span> <span class=mi>40</span><span class=kt>px</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>style</span><span class=p>&gt;</span>
</span></span></code></pre></div><p><code>yarn run dev</code>を実行し画像のように表示されれば問題なし。
<img loading=lazy src=https://i.imgur.com/1VjK8Oo.png alt></p><p>次にAPIサーバの呼び出し先を本番環境と開発環境で変えるように設定する。
Nuxt.jsは環境変数で変数の内容を変えることができる。
参照: <a href=https://ja.nuxtjs.org/api/configuration-env/>env プロパティ</a>
<code>nuxt.config.js</code>の<code>module.exports</code>に下記項目を追加</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>env</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>apiServer</span><span class=o>:</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>API_SERVER</span> <span class=o>||</span> <span class=s1>&#39;http://localhost:8080&#39;</span>
</span></span><span class=line><span class=cl><span class=p>},</span>
</span></span></code></pre></div><p>これで<code>API_SERVER</code>という環境変数が設定されている時はそちらをAPIサーバとして利用。
環境変数が設定されていない時は<code>http://localhost:8080</code>をAPIサーバとして利用するようにする。
後でDockerを使用し本番イメージを作る際に<code>API_SERVER</code>という環境変数をセットしておくと本番環境のAPIサーバを向くようになる。</p><p>次にWHOIS情報を表示するためのページを作成する。
<code>http://[webアプリ]/whois/[WHOISを表示したいドメイン]</code>といったURLで表示したい。
Nuxt.jsはpages配下のvueファイルを見て自動的にルーティングの設定をしてくれる。
動的なルーティングをする際はpages配下に<code>_</code>を先頭に付けたvueファイルを置けば良い。
参照: <a href=https://ja.nuxtjs.org/guide/routing/#%E5%8B%95%E7%9A%84%E3%81%AA%E3%83%AB%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0>Nuxt.js - 動的なルーティング</a>
<code>pages/whois/_domain.vue</code>というファイルを下の内容で作成する。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>h1</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;title&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      {{ $route.params.domain }}
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>h2</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;subtitle&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      Related information
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>h2</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;card&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>header</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;card-header&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;card-header-title&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          Whois Result
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>a</span> <span class=na>href</span><span class=o>=</span><span class=s>&#34;#&#34;</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;card-header-icon&#34;</span> <span class=na>aria-label</span><span class=o>=</span><span class=s>&#34;more options&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>&lt;</span><span class=nt>span</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;icon&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>i</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;fas fa-angle-down&#34;</span> <span class=na>aria-hidden</span><span class=o>=</span><span class=s>&#34;true&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>&lt;/</span><span class=nt>span</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=nt>a</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;/</span><span class=nt>header</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;card-content&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;content&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>pre</span><span class=p>&gt;</span>{{ whoisResp.result }}<span class=p>&lt;/</span><span class=nt>pre</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>axios</span> <span class=nx>from</span> <span class=s1>&#39;axios&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=nx>asyncData</span><span class=p>(</span><span class=nx>context</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>DOMAIN_NAME</span> <span class=o>=</span> <span class=nx>context</span><span class=p>.</span><span class=nx>params</span><span class=p>.</span><span class=nx>domain</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>API_SERVER</span> <span class=o>=</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>apiServer</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=p>{</span> <span class=nx>data</span> <span class=p>}</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>axios</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=nx>API_SERVER</span> <span class=o>+</span> <span class=s1>&#39;/api/v1/whois/&#39;</span> <span class=o>+</span> <span class=nx>DOMAIN_NAME</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>whoisResp</span><span class=o>:</span> <span class=nx>data</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><p><a href=https://famasoon.hatenablog.com/entry/2019/08/03/163641>❶参照</a>をしてローカルでAPIサーバを起動したら、
<code>http://127.0.0.1:3000</code>のフォームで<code>example.com</code>と入力し<code>Lookup</code>ボタンを押してみましょう。
<code>http://127.0.0.1:3000/whois/example.com</code>にルーティングされて下の画像のように表示されれば成功です。
<img loading=lazy src=https://i.imgur.com/WHSmlsK.png alt></p><p>これでWHOIS情報をAPIサーバから取得して表示するWebアプリのフロントエンドが出来上がりました。
今回はここまで。
次回はフロントエンド部分をDockerイメージ化してGKEにデプロイしてみます。</p><h2 id=nuxtjsをgkeにデプロイ>Nuxt.jsをGKEにデプロイ<a hidden class=anchor aria-hidden=true href=#nuxtjsをgkeにデプロイ>#</a></h2><p>フロントエンドのディレクトリに下記Dockerfileを追加</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=cl><span class=k>FROM</span><span class=s> node:lts-alpine</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> /app</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> . /app<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ENV</span> <span class=nv>NODE_ENV</span><span class=o>=</span>production
</span></span><span class=line><span class=cl><span class=k>ENV</span> API_SERVER <span class=s1>&#39;http://[IPアドレス]&#39;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ENV</span> HOST 0.0.0.0<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> yarn install<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> yarn run build<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>EXPOSE</span><span class=s> 3000</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>CMD</span> <span class=p>[</span><span class=s2>&#34;yarn&#34;</span><span class=p>,</span> <span class=s2>&#34;run&#34;</span><span class=p>,</span> <span class=s2>&#34;start&#34;</span><span class=p>]</span><span class=err>
</span></span></span></code></pre></div><p>下記コマンドでlocalhostからアクセスできる</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>docker run -it -p 3000:3000 --network host --name dockerized-nuxt webappfront:latest
</span></span></code></pre></div><p>次にこのコンテナイメージをGoogle Container Registryにアップロードするためにタグ付けを行う</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>docker tag api-prod gcr.io/<span class=o>[</span>プロジェクト名<span class=o>]</span>/<span class=o>[</span>イメージ名<span class=o>]</span>
</span></span><span class=line><span class=cl>:<span class=o>[</span>バージョン名<span class=o>]</span>
</span></span></code></pre></div><p>アップロード</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>docker tag api-prod gcr.io/<span class=o>[</span>プロジェクトID<span class=o>]</span>/apiprod:1.0.0
</span></span><span class=line><span class=cl>gcloud auth configure-docker
</span></span><span class=line><span class=cl>docker push gcr.io/プロジェクト名<span class=o>]</span>/<span class=o>[</span>イメージ名<span class=o>]</span>
</span></span><span class=line><span class=cl>:<span class=o>[</span>バージョン名<span class=o>]</span>
</span></span></code></pre></div><p>GKEにデプロイするためのymlファイル</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>webappfront</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>webappfront</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>webappfront</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>http</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>3000</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>NodePort</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>extensions/v1beta1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>webappfront</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>webappfront</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>webappfront</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>webappfront</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>gcr.io//apiprod:1.0.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class=m>3000</span><span class=w>
</span></span></span></code></pre></div><p>下記コマンドでGKEに設定を反映</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>kubectl create -f webappfront.yml
</span></span></code></pre></div><p>ingress.ymlの中身を下記のように変更しルーティングを指せる</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>extensions/v1beta1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Ingress</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>ingress</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>paths</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>/api/*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>backend</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>serviceName</span><span class=p>:</span><span class=w> </span><span class=l>webappapi</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>servicePort</span><span class=p>:</span><span class=w> </span><span class=m>8080</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>/*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>backend</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>serviceName</span><span class=p>:</span><span class=w> </span><span class=l>webappfront</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>servicePort</span><span class=p>:</span><span class=w> </span><span class=m>3000</span><span class=w>
</span></span></span></code></pre></div><p>たぶんこれでうまくいく。
以上、Golang + Nuxt.js + KubernetesでWebサービスを作るでした。</p></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=https://famasoon.github.io/posts/findingirpdispatch/><span class=title>« Prev</span><br><span>Finding IRP dispatch routine</span></a>
<a class=next href=https://famasoon.github.io/posts/ingress/><span class=title>Next »</span><br><span>Ingressのヘルスチェックに対応する</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Golang + Nuxt.js + Kubernetes でWebサービスを作る on twitter" href="https://twitter.com/intent/tweet/?text=Golang%20%2b%20Nuxt.js%20%2b%20Kubernetes%20%e3%81%a7Web%e3%82%b5%e3%83%bc%e3%83%93%e3%82%b9%e3%82%92%e4%bd%9c%e3%82%8b&url=https%3a%2f%2ffamasoon.github.io%2fposts%2fgolangnuxtk8s%2f&hashtags="><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Golang + Nuxt.js + Kubernetes でWebサービスを作る on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2ffamasoon.github.io%2fposts%2fgolangnuxtk8s%2f&title=Golang%20%2b%20Nuxt.js%20%2b%20Kubernetes%20%e3%81%a7Web%e3%82%b5%e3%83%bc%e3%83%93%e3%82%b9%e3%82%92%e4%bd%9c%e3%82%8b&summary=Golang%20%2b%20Nuxt.js%20%2b%20Kubernetes%20%e3%81%a7Web%e3%82%b5%e3%83%bc%e3%83%93%e3%82%b9%e3%82%92%e4%bd%9c%e3%82%8b&source=https%3a%2f%2ffamasoon.github.io%2fposts%2fgolangnuxtk8s%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Golang + Nuxt.js + Kubernetes でWebサービスを作る on reddit" href="https://reddit.com/submit?url=https%3a%2f%2ffamasoon.github.io%2fposts%2fgolangnuxtk8s%2f&title=Golang%20%2b%20Nuxt.js%20%2b%20Kubernetes%20%e3%81%a7Web%e3%82%b5%e3%83%bc%e3%83%93%e3%82%b9%e3%82%92%e4%bd%9c%e3%82%8b"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Golang + Nuxt.js + Kubernetes でWebサービスを作る on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2ffamasoon.github.io%2fposts%2fgolangnuxtk8s%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Golang + Nuxt.js + Kubernetes でWebサービスを作る on whatsapp" href="https://api.whatsapp.com/send?text=Golang%20%2b%20Nuxt.js%20%2b%20Kubernetes%20%e3%81%a7Web%e3%82%b5%e3%83%bc%e3%83%93%e3%82%b9%e3%82%92%e4%bd%9c%e3%82%8b%20-%20https%3a%2f%2ffamasoon.github.io%2fposts%2fgolangnuxtk8s%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Golang + Nuxt.js + Kubernetes でWebサービスを作る on telegram" href="https://telegram.me/share/url?text=Golang%20%2b%20Nuxt.js%20%2b%20Kubernetes%20%e3%81%a7Web%e3%82%b5%e3%83%bc%e3%83%93%e3%82%b9%e3%82%92%e4%bd%9c%e3%82%8b&url=https%3a%2f%2ffamasoon.github.io%2fposts%2fgolangnuxtk8s%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://famasoon.github.io/>x64.moe</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>